MobileFrontend.opensearch=(function(){var b="/api.php",k=-1,c=500,y=15,p,i=document.getElementById("search"),a=document.getElementById("searchbox"),q=document.getElementById("content"),n=document.getElementById("footer"),w=document.getElementById("clearsearch"),h=false,v,t,l=MobileFrontend.utils;b=MobileFrontend.setting("scriptPath")+b;i.onfocus=function(){var u,A;a=document.getElementById("searchbox");header=document.getElementById("header");q=document.getElementById("content");n=document.getElementById("footer");if(!h){MobileFrontend.utils(document.body).addClass("full-screen-search");u=document.getElementById("remove-results");if(!u){u=document.createElement("a");u.setAttribute("href","#");u.setAttribute("id","remove-results");l(u).bind("click",x);A=document.createElement("div");A.setAttribute("id","left-arrow");u.appendChild(A);header.insertBefore(u,header.firstChild)}h=true}};function x(){MobileFrontend.utils(document.body).removeClass("full-screen-search");if(h){h=false}}var j=function(u){if(u){u.preventDefault()}clearTimeout(k);p=i.value;if(p.length>1){p=encodeURIComponent(p);k=setTimeout(function(){g(p)},c)}};var m;window.setInterval(function(){var u=i.value;if(u.length>1&&u!==m){m=u;j()}},c);l(document.getElementById("searchForm")).bind("submit",j);function z(u){if(i.value.length===0){x()}else{j(u)}}l(i).bind("blur",z);function g(u){l(i).addClass("searching");url=b+"?action=opensearch&limit="+y+"&namespace=0&format=xml&search="+u;l.ajax({url:url,success:function(A){if(l(document.body).hasClass("full-screen-search")){o(f(A));l(i).removeClass("searching")}}})}function f(D){var E=[],A,B,C,u=D.getElementsByTagName("Item");for(A=0;A<u.length;A++){B=u[A];C={label:B.getElementsByTagName("Text")[0].textContent,value:B.getElementsByTagName("Url")[0].textContent};E.push(C)}return E}function d(B){var A=document.createTextNode(B),u=document.createElement("div");u.appendChild(A);return u.innerHTML}function s(u){return u.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function o(I){var C=document.getElementById("results"),E,D,B=d(document.getElementById("search").value),H,A,u,F,G;if(i){i.focus()}if(!I||I.length<1){C.innerHTML='<ul class="suggestions-results" title="No Results"><li class="suggestions-result">No Results</li></div>'}else{if(C.firstChild){C.removeChild(C.firstChild)}E=document.createElement("ul");E.className="suggestions-results";C.appendChild(E);for(D=0;D<I.length;D++){H=I[D];u=document.createElement("li");u.setAttribute("title",H.label);u.className="suggestions-result";F=document.createElement("a");F.setAttribute("href",H.value.replace(/^(?:\/\/|[^\/]+)*\//,"/"));F.className="search-result-item";G=document.createTextNode(H.label);F.appendChild(G);u.appendChild(F);E.appendChild(u);A=s(B);F.innerHTML=F.innerHTML.replace(new RegExp("("+A+")","ig"),"<strong>$1</strong>")}}}function e(){var C=document.getElementById("clearsearch"),u=document.getElementById("search");function A(D){u.value="";results.innerHTML="";D.preventDefault()}function B(){u.select()}l(C).bind("mousedown",A);l(u).bind("click",B)}function r(){}r();e();return{init:r,initClearSearch:e,writeResults:o,createObjectArray:f,removeResults:x}}());