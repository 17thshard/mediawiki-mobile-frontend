MobileFrontend.opensearch=(function(){var c="/api.php",m=-1,d=500,z=15,r,k=document.getElementById("search"),b=document.getElementById("searchbox"),s=document.getElementById("content"),p=document.getElementById("footer"),y=MobileFrontend.setting("scriptPath")+"/extensions/MobileFrontend/stylesheets/images/blank.gif",w=document.getElementById("clearsearch"),j=false,e,n=MobileFrontend.utils;c=MobileFrontend.setting("scriptPath")+c;function A(){var u;b=document.getElementById("searchbox");header=document.getElementById("header");s=document.getElementById("content");p=document.getElementById("footer");if(!j){MobileFrontend.utils(document.body).addClass("full-screen-search");u=document.getElementById("remove-results");if(!u){u=document.createElement("img");u.setAttribute("id","remove-results");n(u).bind("click",x);u.setAttribute("src",y);u.setAttribute("alt",MobileFrontend.message("remove-results"));header.insertBefore(u,header.firstChild)}j=true}}function x(){MobileFrontend.utils(document.body).removeClass("full-screen-search");if(j){j=false}}var l=function(u){if(u){u.preventDefault()}clearTimeout(m);r=k.value;if(r.length>1){r=encodeURIComponent(r);m=setTimeout(function(){i(r)},d)}};var o;window.setInterval(function(){var u=k.value;if(u.length>1&&u!==o){o=u;n(b).addClass("notEmpty");l()}else{if(!u){n(b).removeClass("notEmpty")}}},d);n(document.getElementById("searchForm")).bind("submit",function(D){var u,E,C=n(".suggestions-result a")[0];if(C){window.location.href=C.getAttribute("href");D.preventDefault()}else{l(D)}});function B(u){if(k.value.length===0){x()}else{l(u)}}function a(C,u){window.clearTimeout(e);e=window.setTimeout(function(){u(C)},500)}n(k).bind("focus",function(u){a(u,A)});n(k).bind("blur",function(u){a(u,B)});function i(u){n(k).addClass("searching");url=c+"?action=opensearch&limit="+z+"&namespace=0&format=xml&search="+u;n.ajax({url:url,success:function(C){if(n(document.body).hasClass("full-screen-search")){q(h(C));n(k).removeClass("searching")}}})}function h(F){var G=[],C,D,E,u=F.getElementsByTagName("Item");for(C=0;C<u.length;C++){D=u[C];E={label:D.getElementsByTagName("Text")[0].textContent,value:D.getElementsByTagName("Url")[0].textContent};G.push(E)}return G}function f(D){var C=document.createTextNode(D),u=document.createElement("div");u.appendChild(C);return u.innerHTML}function v(u){return u.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function q(K){var E=document.getElementById("results"),G,F,D=f(document.getElementById("search").value),J,C,u,H,I;if(!K||K.length<1){E.innerHTML='<ul class="suggestions-results" title="No Results"><li class="suggestions-result">No Results</li></div>'}else{if(E.firstChild){E.removeChild(E.firstChild)}G=document.createElement("ul");G.className="suggestions-results";E.appendChild(G);for(F=0;F<K.length;F++){J=K[F];u=document.createElement("li");u.setAttribute("title",J.label);u.className="suggestions-result";H=document.createElement("a");H.setAttribute("href",J.value.replace(/^(?:\/\/|[^\/]+)*\//,"/"));H.className="search-result-item";I=document.createTextNode(J.label);H.appendChild(I);u.appendChild(H);G.appendChild(u);C=v(D);H.innerHTML=H.innerHTML.replace(new RegExp("("+C+")","ig"),"<strong>$1</strong>")}}}function g(){var F=document.getElementById("clearsearch"),C=document.getElementById("results"),u=document.getElementById("search");function D(G){window.setTimeout(function(){u.value=""},100);C.innerHTML="";G.preventDefault()}function E(){u.select()}n(F).bind("mousedown",D);n(u).bind("click",E)}function t(){if(document.activeElement&&document.activeElement.id==="search"){A()}function u(){document.getElementById("search").blur()}document.getElementById("results").ontouchstart=u;g()}MobileFrontend.registerModule("opensearch");return{init:t,initClearSearch:g,writeResults:q,createObjectArray:h,removeResults:x}}());