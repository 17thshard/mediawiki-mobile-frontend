MobileFrontend.opensearch=(function(){var c="/api.php",m=-1,d=500,z=15,r,k=document.getElementById("search"),o,b=document.getElementById("searchbox"),s=document.getElementById("content"),p=document.getElementById("footer"),y=MobileFrontend.setting("scriptPath")+"/extensions/MobileFrontend/stylesheets/images/blank.gif",w=document.getElementById("clearsearch"),j=false,e,n=MobileFrontend.utils;c=MobileFrontend.setting("scriptPath")+c;function A(){var u;b=document.getElementById("searchbox");header=document.getElementById("header");s=document.getElementById("content");p=document.getElementById("footer");if(!j){MobileFrontend.utils(document.body).addClass("full-screen-search");u=document.getElementById("remove-results");if(!u){u=document.createElement("img");u.setAttribute("id","remove-results");n(u).bind("click",x);u.setAttribute("src",y);u.setAttribute("alt",MobileFrontend.message("remove-results"));header.insertBefore(u,header.firstChild)}j=true}}function x(){MobileFrontend.utils(document.body).removeClass("full-screen-search");if(j){j=false}}var l=function(u){if(u){u.preventDefault()}clearTimeout(m);r=k.value;if(r.length>1){r=encodeURIComponent(r);m=setTimeout(function(){i(r)},d)}};function C(u){if(k.value.length===0){x()}else{l(u)}}function a(D,u){window.clearTimeout(e);e=window.setTimeout(function(){u(D)},500)}function B(){window.setInterval(function(){var u=k.value;if(u.length>1&&u!==o){o=u;n(b).addClass("notEmpty");l()}else{if(!u){n(b).removeClass("notEmpty")}}},d);n(document.getElementById("searchForm")).bind("submit",function(E){var u,F,D=n(".suggestions-result a")[0];if(D){window.location.href=D.getAttribute("href");E.preventDefault()}else{l(E)}});n(k).bind("focus",function(u){a(u,A)});n(k).bind("blur",function(u){a(u,C)})}function i(u){n(k).addClass("searching");url=c+"?action=opensearch&limit="+z+"&namespace=0&format=xml&search="+u;n.ajax({url:url,success:function(D){if(n(document.body).hasClass("full-screen-search")){q(h(D));n(k).removeClass("searching")}}})}function h(G){var H=[],D,E,F,u=G.getElementsByTagName("Item");for(D=0;D<u.length;D++){E=u[D];F={label:E.getElementsByTagName("Text")[0].textContent,value:E.getElementsByTagName("Url")[0].textContent};H.push(F)}return H}function f(E){var D=document.createTextNode(E),u=document.createElement("div");u.appendChild(D);return u.innerHTML}function v(u){return u.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function q(L){var F=document.getElementById("results"),H,G,E=f(document.getElementById("search").value),K,D,u,I,J;if(!L||L.length<1){F.innerHTML='<ul class="suggestions-results" title="No Results"><li class="suggestions-result">No Results</li></div>'}else{if(F.firstChild){F.removeChild(F.firstChild)}H=document.createElement("ul");H.className="suggestions-results";F.appendChild(H);for(G=0;G<L.length;G++){K=L[G];u=document.createElement("li");u.setAttribute("title",K.label);u.className="suggestions-result";I=document.createElement("a");I.setAttribute("href",K.value.replace(/^(?:\/\/|[^\/]+)*\//,"/"));I.className="search-result-item";J=document.createTextNode(K.label);I.appendChild(J);u.appendChild(I);H.appendChild(u);D=v(E);I.innerHTML=I.innerHTML.replace(new RegExp("("+D+")","ig"),"<strong>$1</strong>")}}}function g(){var G=document.getElementById("clearsearch"),D=document.getElementById("results"),u=document.getElementById("search");function E(H){window.setTimeout(function(){u.value=""},100);D.innerHTML="";H.preventDefault()}function F(){u.select()}n(G).bind("mousedown",E);n(u).bind("click",F)}function t(){B();if(document.activeElement&&document.activeElement.id==="search"){A()}function u(){document.getElementById("search").blur()}document.getElementById("results").ontouchstart=u;g()}MobileFrontend.registerModule("opensearch");return{init:t,initClearSearch:g,writeResults:q,createObjectArray:h,removeResults:x}}());