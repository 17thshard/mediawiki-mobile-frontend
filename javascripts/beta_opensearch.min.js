MobileFrontend.opensearch=(function(){var b="/api.php",k=-1,c=500,x=15,p,i=document.getElementById("search"),a=document.getElementById("searchbox"),q=document.getElementById("content"),n=document.getElementById("footer"),w=MobileFrontend.setting("scriptPath")+"/extensions/MobileFrontend/stylesheets/images/blank.gif",t=document.getElementById("clearsearch"),h=false,l=MobileFrontend.utils;b=MobileFrontend.setting("scriptPath")+b;function y(){var u;a=document.getElementById("searchbox");header=document.getElementById("header");q=document.getElementById("content");n=document.getElementById("footer");if(!h){MobileFrontend.utils(document.body).addClass("full-screen-search");u=document.getElementById("remove-results");if(!u){u=document.createElement("img");u.setAttribute("id","remove-results");l(u).bind("click",v);u.setAttribute("src",w);u.setAttribute("alt",MobileFrontend.message("remove-results"));header.insertBefore(u,header.firstChild)}h=true}}l(i).bind("focus",y);function v(){MobileFrontend.utils(document.body).removeClass("full-screen-search");if(h){h=false}}var j=function(u){if(u){u.preventDefault()}clearTimeout(k);p=i.value;if(p.length>1){p=encodeURIComponent(p);k=setTimeout(function(){g(p)},c)}};var m;window.setInterval(function(){var u=i.value;if(u.length>1&&u!==m){m=u;l(a).addClass("notEmpty");j()}else{if(!u){l(a).removeClass("notEmpty")}}},c);l(document.getElementById("searchForm")).bind("submit",function(B){var u,C,A=l(".suggestions-result a")[0];if(A){window.location.href=A.getAttribute("href");B.preventDefault()}else{j(B)}});function z(u){if(i.value.length===0){v()}else{j(u)}}l(i).bind("blur",z);function g(u){l(i).addClass("searching");url=b+"?action=opensearch&limit="+x+"&namespace=0&format=xml&search="+u;l.ajax({url:url,success:function(A){if(l(document.body).hasClass("full-screen-search")){o(f(A));l(i).removeClass("searching")}}})}function f(D){var E=[],A,B,C,u=D.getElementsByTagName("Item");for(A=0;A<u.length;A++){B=u[A];C={label:B.getElementsByTagName("Text")[0].textContent,value:B.getElementsByTagName("Url")[0].textContent};E.push(C)}return E}function d(B){var A=document.createTextNode(B),u=document.createElement("div");u.appendChild(A);return u.innerHTML}function s(u){return u.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function o(I){var C=document.getElementById("results"),E,D,B=d(document.getElementById("search").value),H,A,u,F,G;if(!I||I.length<1){C.innerHTML='<ul class="suggestions-results" title="No Results"><li class="suggestions-result">No Results</li></div>'}else{if(C.firstChild){C.removeChild(C.firstChild)}E=document.createElement("ul");E.className="suggestions-results";C.appendChild(E);for(D=0;D<I.length;D++){H=I[D];u=document.createElement("li");u.setAttribute("title",H.label);u.className="suggestions-result";F=document.createElement("a");F.setAttribute("href",H.value.replace(/^(?:\/\/|[^\/]+)*\//,"/"));F.className="search-result-item";G=document.createTextNode(H.label);F.appendChild(G);u.appendChild(F);E.appendChild(u);A=s(B);F.innerHTML=F.innerHTML.replace(new RegExp("("+A+")","ig"),"<strong>$1</strong>")}}}function e(){var D=document.getElementById("clearsearch"),A=document.getElementById("results"),u=document.getElementById("search");function B(E){window.setTimeout(function(){u.value=""},100);A.innerHTML="";E.preventDefault()}function C(){u.select()}l(D).bind("mousedown",B);l(u).bind("click",C)}function r(){if(document.activeElement&&document.activeElement.id==="search"){y()}}r();e();return{init:r,initClearSearch:e,writeResults:o,createObjectArray:f,removeResults:v}}());