this.mfModules=this.mfModules||{},this.mfModules["tests.mobilefrontend"]=(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"./node_modules/hogan.js/lib/compiler.js":function(t,e,n){!function(t){var e=/\S/,n=/\"/g,i=/\n/g,s=/\r/g,a=/\\/g,o={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};function r(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function l(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function c(t,e,n){if(e.charAt(n)!=t.charAt(0))return!1;for(var i=1,s=t.length;i<s;i++)if(e.charAt(n+i)!=t.charAt(i))return!1;return!0}function u(t,e){for(var n=0,i=e.length;n<i;n++)if(e[n].o==t.n)return t.tag="#",!0}function d(t,e,n){for(var i=0,s=n.length;i<s;i++)if(n[i].c==t&&n[i].o==e)return!0}function h(t){return t.replace(a,"\\\\").replace(n,'\\"').replace(i,"\\n").replace(s,"\\r")}function p(t){return~t.indexOf(".")?"d":"f"}function g(t){for(var e="",n=0,i=t.length;n<i;n++){var s=t[n].tag;"#"==s?e+=m(t[n].nodes,t[n].n,p(t[n].n),t[n].i,t[n].end,t[n].otag+" "+t[n].ctag):"^"==s?e+=f(t[n].nodes,t[n].n,p(t[n].n)):"<"==s||">"==s?e+=b(t[n]):"{"==s||"&"==s?e+=w(t[n].n,p(t[n].n)):"\n"==s?e+=y('"\\n"'+(t.length-1==n?"":" + i")):"_v"==s?e+=v(t[n].n,p(t[n].n)):void 0===s&&(e+=y('"'+h(t[n])+'"'))}return e}function m(t,e,n,i,s,a){return"if(_.s(_."+n+'("'+h(e)+'",c,p,1),c,p,0,'+i+","+s+',"'+a+'")){_.rs(c,p,function(c,p,_){'+g(t)+"});c.pop();}"}function f(t,e,n){return"if(!_.s(_."+n+'("'+h(e)+'",c,p,1),c,p,1,0,0,"")){'+g(t)+"};"}function b(t){return'_.b(_.rp("'+h(t.n)+'",c,p,"'+(t.indent||"")+'"));'}function w(t,e){return"_.b(_.t(_."+e+'("'+h(t)+'",c,p,0)));'}function v(t,e){return"_.b(_.v(_."+e+'("'+h(t)+'",c,p,0)));'}function y(t){return"_.b("+t+");"}t.scan=function(t,n){var i=t.length,s=0,a=null,u=null,d="",h=[],p=!1,g=0,m=0,f="{{",b="}}";function w(){d.length>0&&(h.push(new String(d)),d="")}function v(t,n){if(w(),t&&function(){for(var t=!0,n=m;n<h.length;n++)if(!(t=h[n].tag&&o[h[n].tag]<o._v||!h[n].tag&&null===h[n].match(e)))return!1;return t}())for(var i,s=m;s<h.length;s++)h[s].tag||((i=h[s+1])&&">"==i.tag&&(i.indent=h[s].toString()),h.splice(s,1));else n||h.push({tag:"\n"});p=!1,m=h.length}function y(t,e){var n="="+b,i=t.indexOf(n,e),s=l(t.substring(t.indexOf("=",e)+1,i)).split(" ");return f=s[0],b=s[1],i+n.length-1}for(n&&(n=n.split(" "),f=n[0],b=n[1]),g=0;g<i;g++)0==s?c(f,t,g)?(--g,w(),s=1):"\n"==t.charAt(g)?v(p):d+=t.charAt(g):1==s?(g+=f.length-1,"="==(a=(u=o[t.charAt(g+1)])?t.charAt(g+1):"_v")?(g=y(t,g),s=0):(u&&g++,s=2),p=g):c(b,t,g)?(h.push({tag:a,n:l(d),otag:f,ctag:b,i:"/"==a?p-b.length:g+f.length}),d="",g+=b.length-1,s=0,"{"==a&&("}}"==b?g++:r(h[h.length-1]))):d+=t.charAt(g);return v(p,!0),h},t.generate=function(e,n,i){var s='var _=this;_.b(i=i||"");'+g(e)+"return _.fl();";return i.asString?"function(c,p,i){"+s+";}":new t.Template(new Function("c","p","i",s),n,t,i)},t.parse=function(t,e,n){return function t(e,n,i,s){for(var a=[],o=null,r=null;e.length>0;)if("#"==(r=e.shift()).tag||"^"==r.tag||u(r,s))i.push(r),r.nodes=t(e,r.tag,i,s),a.push(r);else{if("/"==r.tag){if(0===i.length)throw new Error("Closing tag without opener: /"+r.n);if(o=i.pop(),r.n!=o.n&&!d(r.n,o.n,s))throw new Error("Nesting error: "+o.n+" vs. "+r.n);return o.end=r.i,a}a.push(r)}if(i.length>0)throw new Error("missing closing tag: "+i.pop().n);return a}(t,0,[],(n=n||{}).sectionTags||[])},t.cache={},t.compile=function(t,e){var n=t+"||"+!!(e=e||{}).asString,i=this.cache[n];return i||(i=this.generate(this.parse(this.scan(t,e.delimiters),t,e),t,e),this.cache[n]=i)}}(e)},"./node_modules/hogan.js/lib/hogan.js":function(t,e,n){var i=n("./node_modules/hogan.js/lib/compiler.js");i.Template=n("./node_modules/hogan.js/lib/template.js").Template,t.exports=i},"./node_modules/hogan.js/lib/template.js":function(t,e,n){!function(t,e){t.Template=function(t,e,n,i){this.r=t||this.r,this.c=n,this.options=i,this.text=e||"",this.buf=""},t.Template.prototype={r:function(t,e,n){return""},v:function(t){return t=l(t),r.test(t)?t.replace(n,"&amp;").replace(i,"&lt;").replace(s,"&gt;").replace(a,"&#39;").replace(o,"&quot;"):t},t:l,render:function(t,e,n){return this.ri([t],e||{},n)},ri:function(t,e,n){return this.r(t,e,n)},rp:function(t,e,n,i){var s=n[t];return s?(this.c&&"string"==typeof s&&(s=this.c.compile(s,this.options)),s.ri(e,n,i)):""},rs:function(t,e,n){var i=t[t.length-1];if(c(i))for(var s=0;s<i.length;s++)t.push(i[s]),n(t,e,this),t.pop();else n(t,e,this)},s:function(t,e,n,i,s,a,o){var r;return(!c(t)||0!==t.length)&&("function"==typeof t&&(t=this.ls(t,e,n,i,s,a,o)),r=""===t||!!t,!i&&r&&e&&e.push("object"==typeof t?t:e[e.length-1]),r)},d:function(t,e,n,i){var s=t.split("."),a=this.f(s[0],e,n,i),o=null;if("."===t&&c(e[e.length-2]))return e[e.length-1];for(var r=1;r<s.length;r++)a&&"object"==typeof a&&s[r]in a?(o=a,a=a[s[r]]):a="";return!(i&&!a)&&(i||"function"!=typeof a||(e.push(o),a=this.lv(a,e,n),e.pop()),a)},f:function(t,e,n,i){for(var s=!1,a=null,o=!1,r=e.length-1;r>=0;r--)if((a=e[r])&&"object"==typeof a&&t in a){s=a[t],o=!0;break}return o?(i||"function"!=typeof s||(s=this.lv(s,e,n)),s):!i&&""},ho:function(t,e,n,i,s){var a=this.c,o=this.options;return o.delimiters=s,i=null==(i=t.call(e,i))?String(i):i.toString(),this.b(a.compile(i,o).render(e,n)),!1},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ls:function(t,e,n,i,s,a,o){var r,l=e[e.length-1];if(!i&&this.c&&t.length>0)return this.ho(t,l,n,this.text.substring(s,a),o);if("function"==typeof(r=t.call(l))){if(i)return!0;if(this.c)return this.ho(r,l,n,this.text.substring(s,a),o)}return r},lv:function(t,e,n){var i=e[e.length-1],s=t.call(i);return"function"==typeof s&&(s=l(s.call(i)),this.c&&~s.indexOf("{{"))?this.c.compile(s,this.options).render(i,n):l(s)}};var n=/&/g,i=/</g,s=/>/g,a=/\'/g,o=/\"/g,r=/[&<>\"\']/;function l(t){return String(null===t||void 0===t?"":t)}var c=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}(e)},"./node_modules/webpack/buildin/global.js":function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},"./src/mobile.languages.structured/LanguageOverlay.js":function(t,e,n){var i=n("./src/mobile.startup/Overlay.js"),s=n("./src/mobile.startup/util.js"),a=n("./src/mobile.languages.structured/util.js");function o(t){var e;e=a.getStructuredLanguages(t.languages,t.variants,a.getFrequentlyUsedLanguages(),t.deviceLanguage),t.allLanguages=e.all,t.allLanguagesCount=e.all.length,t.suggestedLanguages=e.suggested,t.suggestedLanguagesCount=e.suggested.length,i.call(this,s.extend(t,{className:"overlay language-overlay"}))}n("./src/mobile.startup/mfExtend.js")(o,i,{defaults:s.extend({},i.prototype.defaults,{heading:mw.msg("mobile-frontend-language-heading"),inputPlaceholder:mw.msg("mobile-frontend-languages-structured-overlay-search-input-placeholder"),allLanguagesHeader:mw.msg("mobile-frontend-languages-structured-overlay-all-languages-header").toLocaleUpperCase(),suggestedLanguagesHeader:mw.msg("mobile-frontend-languages-structured-overlay-suggested-languages-header").toLocaleUpperCase()}),templatePartials:s.extend({},i.prototype.templatePartials,{content:mw.template.get("mobile.languages.structured","LanguageOverlay.hogan")}),events:s.extend({},i.prototype.events,{"click a":"onLinkClick","input .search":"onSearchInput"}),postRender:function(){i.prototype.postRender.apply(this),this.$siteLinksList=this.$(".site-link-list"),this.$languageItems=this.$siteLinksList.find("a"),this.$subheaders=this.$("h3")},onLinkClick:function(t){var e=this.$(t.currentTarget).attr("lang"),n=this,i=this.$languageItems.filter(":visible");a.saveLanguageUsageCount(e,a.getFrequentlyUsedLanguages()),i.each(function(t,i){if(n.$(i).hasClass(e))return!1})},onSearchInput:function(t){this.filterLanguages(this.$(t.target).val().toLowerCase())},filterLanguages:function(t){var e=[];t?(this.options.languages.forEach(function(n){var i=n.langname;(n.autonym.toLowerCase().indexOf(t)>-1||i&&i.toLowerCase().indexOf(t)>-1||n.lang.toLowerCase().indexOf(t)>-1)&&e.push(n.lang)}),this.options.variants&&this.options.variants.forEach(function(n){(n.autonym.toLowerCase().indexOf(t)>-1||n.lang.toLowerCase().indexOf(t)>-1)&&e.push(n.lang)}),this.$languageItems.addClass("hidden"),e.length&&this.$siteLinksList.find("."+e.join(",.")).removeClass("hidden"),this.$siteLinksList.addClass("filtered"),this.$subheaders.addClass("hidden")):(this.$languageItems.removeClass("hidden"),this.$siteLinksList.removeClass("filtered"),this.$subheaders.removeClass("hidden"))}}),t.exports=o},"./src/mobile.languages.structured/rtlLanguages.js":function(t,e){t.exports=["aeb","aeb-arab","ar","arc","arq","arz","azb","bcc","bgn","bqi","ckb","dv","fa","glk","he","khw","kk-arab","kk-cn","ks","ks-arab","ku-arab","lki","lrc","luz","mzn","pnb","ps","sd","sdh","skr","skr-arab","ug","ug-arab","ur","yi"]},"./src/mobile.languages.structured/util.js":function(t,e,n){var i=mw.log,s=n("./src/mobile.startup/util.js"),a=n("./src/mobile.languages.structured/rtlLanguages.js");t.exports={getDir:function(t){var e=a.indexOf(t.lang)>-1?"rtl":"ltr";return s.extend({},t,{dir:e})},getStructuredLanguages:function(t,e,n,s){var a=Object.prototype.hasOwnProperty,o=0,r=0,l=0,c=[],u=[],d=this;function h(t){return t.dir?t:(l++,d.getDir(t))}return(s=function(t,e){var n,i,s=Object.prototype.hasOwnProperty,a={};if(e)return-1!==(i=e.indexOf("-"))&&(n=e.slice(0,i)),t.forEach(function(t){t.lang!==n&&t.lang!==e||(a[t.lang]=!0)}),s.call(a,e)?e:s.call(a,n)?n:void 0}(t,s))&&(Object.keys(n).forEach(function(t){var e=n[t];o=o<e?e:o,r=r>e?e:r}),n[s]=o+1),t.map(h).forEach(function(t){a.call(n,t.lang)?(t.frequency=n[t.lang],c.push(t)):u.push(t)}),e&&e.map(h).forEach(function(t){a.call(n,t.lang)?t.frequency=n[t.lang]:t.frequency=r-1,c.push(t)}),c=c.sort(function(t,e){return e.frequency-t.frequency}),u=u.sort(function(t,e){return t.autonym.toLocaleLowerCase()<e.autonym.toLocaleLowerCase()?-1:1}),i.warn(0===l?"Direction is provided. Please remove handling in getStructuredLanguages":"`dir` attribute was missing from languages. Is T74153 resolved?"),{suggested:c,all:u}},getFrequentlyUsedLanguages:function(){var t=mw.storage.get("langMap");return t?JSON.parse(t):{}},saveFrequentlyUsedLanguages:function(t){mw.storage.set("langMap",JSON.stringify(t))},saveLanguageUsageCount:function(t,e){var n=e[t]||0;n+=1,e[t]=n>100?100:n,this.saveFrequentlyUsedLanguages(e)}}},"./src/mobile.mediaViewer/ImageGateway.js":function(t,e,n){var i=[320,640,800,1024,1280,1920,2560,2880],s=n("./src/mobile.startup/actionParams.js"),a=n("./src/mobile.startup/util.js");function o(t){for(var e=0;t>i[e]&&e<i.length-1;)++e;return i[e]}function r(t){this._cache={},this.api=t.api}r.prototype.getThumb=function(t){var e=this._cache[t],n=a.getWindow(),i=window.devicePixelRatio&&window.devicePixelRatio>1?window.devicePixelRatio:1;return e||(this._cache[t]=this.api.get(s({prop:"imageinfo",titles:t,iiprop:["url","extmetadata"],iiurlwidth:o(n.width()*i),iiurlheight:o(n.height()*i)})).then(function(t){if(t.query&&t.query.pages&&t.query.pages[0]&&t.query.pages[0].imageinfo)return t.query.pages[0].imageinfo[0];throw new Error("The API failed to return any pages matching the titles.")})),this._cache[t]},r._findSizeBucket=o,t.exports=r},"./src/mobile.mediaViewer/ImageOverlay.js":function(t,e,n){var i=n("./src/mobile.startup/Overlay.js"),s=n("./src/mobile.startup/util.js"),a=n("./src/mobile.startup/mfExtend.js"),o=n("./src/mobile.startup/Icon.js"),r=n("./src/mobile.startup/icons.js"),l=n("./src/mobile.startup/Button.js"),c=n("./src/mobile.mediaViewer/LoadErrorMessage.js"),u=n("./src/mobile.mediaViewer/ImageGateway.js"),d=mw.loader.require("mediawiki.router");function h(t){this.gateway=t.gateway||new u({api:t.api}),this.router=t.router||d,this.eventBus=t.eventBus,i.call(this,s.extend({className:"overlay media-viewer"},t))}a(h,i,{hasFixedHeader:!1,hideOnExitClick:!1,template:mw.template.get("mobile.mediaViewer","Overlay.hogan"),defaults:s.extend({},i.prototype.defaults,{cancelButton:r.cancel("gray").toHtmlString(),detailsButton:new l({label:mw.msg("mobile-frontend-media-details"),additionalClassNames:"button",progressive:!0}).options,licenseLinkMsg:mw.msg("mobile-frontend-media-license-link"),thumbnails:[],slideLeftButton:new o({rotation:90,name:"arrow-invert"}).toHtmlString(),slideRightButton:new o({rotation:-90,name:"arrow-invert"}).toHtmlString()}),events:s.extend({},i.prototype.events,{"click .image-wrapper":"onToggleDetails","click .slider-button":"onSlide"}),onSlide:function(t){var e=this.$(t.target).closest(".slider-button").data("thumbnail");this.emit(h.EVENT_SLIDE,e)},preRender:function(){var t=this;this.options.thumbnails.forEach(function(e,n){e.getFileName()===t.options.title&&(t.options.caption=e.getDescription(),t.galleryOffset=n)})},_enableArrowImages:function(t){var e,n,i=this.galleryOffset;void 0===this.galleryOffset?(e=t[t.length-1],n=t[0]):(e=t[0===i?t.length-1:i-1],n=t[i===t.length-1?0:i+1]),this.$(".prev").data("thumbnail",e),this.$(".next").data("thumbnail",n)},_disableArrowImages:function(){this.$(".prev, .next").remove()},_handleRetry:function(){this.router.emit("hashchange")},postRender:function(){var t,e=this.options.thumbnails||[],n=this;function s(){n.hideSpinner()}function a(){n.hasLoadError=!0,s(),n.$(".image img").hide(),0===n.$(".load-fail-msg").length&&new c({retryPath:n.router.getPath()}).on("retry",n._handleRetry.bind(n)).prependTo(n.$(".image"))}function o(){t.addClass("image-loaded")}e.length<2?this._disableArrowImages():this._enableArrowImages(e),this.$details=this.$(".details"),i.prototype.postRender.apply(this),this.gateway.getThumb(n.options.title).then(function(e){var i,r=e.descriptionurl+"#mw-jump-to-license";s(),n.thumbWidth=e.thumbwidth,n.thumbHeight=e.thumbheight,n.imgRatio=e.thumbwidth/e.thumbheight,(t=n.parseHTML("<img>",document)).on("load",o).on("error",a),t.attr("src",e.thumburl).attr("alt",n.options.caption),n.$(".image").append(t),n.$details.addClass("is-visible"),n._positionImage(),n.$(".details a").attr("href",r),e.extmetadata&&(e.extmetadata.LicenseShortName&&n.$(".license a").text(e.extmetadata.LicenseShortName.value).attr("href",r),e.extmetadata.Artist&&(i=e.extmetadata.Artist.value.replace(/<.*?>/g,""),n.$(".license").prepend(i+" &bull; "))),n.adjustDetails()},function(){a()}),this.eventBus.on("resize:throttled",this._positionImage.bind(this))},onToggleDetails:function(){this.hasLoadError||(this.$(".cancel, .slider-button").toggle(),this.$details.toggle(),this._positionImage())},onExitClick:function(t){i.prototype.onExitClick.apply(this,arguments),this.emit(h.EVENT_EXIT,t)},show:function(){i.prototype.show.apply(this,arguments),this._positionImage()},_positionImage:function(){var t,e,n,i,a,o=s.getWindow();this.adjustDetails(),t=this.$details.is(":visible")?this.$details.outerHeight():0,i=(e=o.width())/(n=o.height()-t),a=this.$("img"),this.imgRatio>i?e<this.thumbWidth&&a.css({width:e,height:"auto"}):n<this.thumbHeight&&a.css({width:"auto",height:n}),this.$(".image-wrapper").css("bottom",t)},adjustDetails:function(){var t=s.getWindow().height();this.$(".details").height()>.5*t&&this.$(".details").css("max-height",.5*t)}}),h.EVENT_EXIT="ImageOverlay-exit",h.EVENT_SLIDE="ImageOverlay-slide",t.exports=h},"./src/mobile.mediaViewer/LoadErrorMessage.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/mfExtend.js"),a=n("./src/mobile.startup/Icon.js"),o=n("./src/mobile.startup/View.js");function r(t){if(!t.retryPath)throw new Error("'retryPath' must be set in options param. Received: "+t.retryPath);o.apply(this,arguments)}s(r,o,{template:mw.template.get("mobile.mediaViewer","LoadErrorMessage.hogan"),isTemplateMode:!0,defaults:i.extend({},r.prototype.defaults,{icon:new a({name:"alert-invert",additionalClassNames:"load-fail-msg-icon"}).toHtmlString(),msgToUser:mw.msg("mobile-frontend-media-load-fail-message"),retryTxt:mw.msg("mobile-frontend-media-load-fail-retry")}),events:{"click .load-fail-msg-link a":"onRetry"},postRender:function(){this.$(".load-fail-msg-link a").attr("href","#"+this.options.retryPath)},onRetry:function(){return this.emit("retry"),!1}}),t.exports=r},"./src/mobile.special.watchlist.scripts/WatchList.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/PageList.js"),a=n("./src/mobile.startup/watchstar/WatchstarPageList.js"),o=n("./src/mobile.startup/ScrollEndEventEmitter.js"),r=n("./src/mobile.startup/util.js"),l=n("./src/mobile.special.watchlist.scripts/WatchListGateway.js");function c(t){var e,n=r.extend({},{isBorderBox:!1},t);this.scrollEndEventEmitter=new o(n.eventBus),this.scrollEndEventEmitter.on(o.EVENT_SCROLL_END,this._loadPages.bind(this)),n.el&&(e=this.getLastTitle(n.el)),this.gateway=new l(n.api,e),a.call(this,n)}i(c,a,{preRender:function(){this.scrollEndEventEmitter.disable(),this.scrollEndEventEmitter.setElement(this.$el)},postRender:function(){var t,e;s.prototype.postRender.apply(this),t=this.queryUnitializedItems(),e=Object.keys(this.parsePagesFromItems(t)).reduce(function(t,e){return t[e]=!0,t},{}),this.renderItems(t,e),this.scrollEndEventEmitter.enable()},_loadPages:function(){this.gateway.loadWatchlist().then(function(t){t.forEach(function(t){this.appendPage(t)}.bind(this)),this.render()}.bind(this))},appendPage:function(t){var e=r.extend({},t.options,{wikidataDescription:void 0});this.$el.append(this.templatePartials.item.render(e))},getLastTitle:function(t){return t.find("li:last").attr("title")}}),t.exports=c},"./src/mobile.special.watchlist.scripts/WatchListGateway.js":function(t,e,n){var i=n("./src/mobile.startup/Page.js"),s=n("./src/mobile.startup/util.js"),a=n("./src/mobile.startup/extendSearchParams.js");function o(t,e){this.api=t,this.limit=50,e?(this.continueParams={continue:"gwrcontinue||",gwrcontinue:"0|"+e.replace(/ /g,"_")},this.shouldSkipFirstTitle=!0):(this.continueParams={continue:""},this.shouldSkipFirstTitle=!1),this.canContinue=!0}o.prototype={loadWatchlist:function(){var t=this,e=a("watchlist",{prop:["info","revisions"],rvprop:"timestamp|user",generator:"watchlistraw",gwrnamespace:"0",gwrlimit:this.limit},this.continueParams);return!1===this.canContinue?s.Deferred().resolve([]):this.api.get(e,{url:this.apiUrl}).then(function(e){return void 0!==e.continue?t.continueParams=e.continue:t.canContinue=!1,t.parseData(e)})},parseData:function(t){var e;return t.query&&t.query.pages?((e=t.query.pages).sort(function(t,e){return t.title===e.title?0:t.title<e.title?-1:1}),this.shouldSkipFirstTitle&&(e=e.slice(1),this.shouldSkipFirstTitle=!1),e.map(i.newFromJSON)):[]}},t.exports=o},"./src/mobile.startup/Anchor.js":function(t,e,n){var i=n("./src/mobile.startup/View.js");function s(){i.apply(this,arguments)}n("./src/mobile.startup/mfExtend.js")(s,i,{isTemplateMode:!0,defaults:{progressive:void 0,destructive:void 0,additionalClassNames:"",href:void 0,label:void 0},template:mw.template.get("mobile.startup","anchor.hogan")}),t.exports=s},"./src/mobile.startup/Browser.js":function(t,e,n){var i,s=n("./src/mobile.startup/util.js");function a(t){var e=function(){var n=this["__cache"+e.cacheId]||(this["__cache"+e.cacheId]={}),i=[].join.call(arguments,"|");return Object.prototype.hasOwnProperty.call(n,i)?n[i]:n[i]=t.apply(this,arguments)};return e.cacheId=Date.now().toString()+Math.random().toString(),e}function o(t,e){this.userAgent=t,this.$el=e,this._fixIosLandscapeBug()}o.prototype={_fixIosLandscapeBug:function(){var t=this;this.$el.find('meta[name="viewport"]')[0]&&(this.isIos(4)||this.isIos(5))&&(this.lockViewport(),document.addEventListener("gesturestart",function(){t.lockViewport()},!1))},isIos:a(function(t){var e=this.userAgent,n=/ipad|iphone|ipod/i.test(e);if(!n||!t)return n;switch(t){case 8:return/OS 8_/.test(e)||/Version\/8/.test(e);case 4:return/OS 4_/.test(e);case 5:return/OS 5_/.test(e);default:return!1}}),lockViewport:function(){this.$el&&this.$el.find('meta[name="viewport"]').attr("content","initial-scale=1.0, maximum-scale=1.0, user-scalable=no")},isWideScreen:a(function(){var t=parseInt(mw.config.get("wgMFDeviceWidthTablet"),10);return window.innerWidth>=t||window.innerHeight>=t}),supportsAnimations:a(function(){var t=document.createElement("foo").style;function e(e){return e in t||"webkit"+e[0].toUpperCase()+e.slice(1)in t}return e("animationName")&&e("transform")&&e("transition")}),supportsTouchEvents:a(function(){return"ontouchstart"in window}),supportsGeoLocation:a(function(){return"geolocation"in window.navigator})},o.getSingleton=function(){var t;return i||(t=s.getDocument(),i=new o(window.navigator.userAgent,t)),i},t.exports=o},"./src/mobile.startup/Button.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/View.js");function a(t){t.href&&(t.tagName="a"),s.call(this,t)}i(a,s,{isTemplateMode:!0,defaults:{tagName:"a",block:void 0,progressive:void 0,destructive:void 0,quiet:void 0,additionalClassNames:"",href:void 0,label:void 0},template:mw.template.get("mobile.startup","button.hogan")}),t.exports=a},"./src/mobile.startup/CtaDrawer.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/Drawer.js"),a=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/Button.js"),r=n("./src/mobile.startup/Anchor.js");function l(t){s.call(this,a.extend({},s.prototype.defaults,{progressiveButton:new o({progressive:!0,label:mw.msg("mobile-frontend-watchlist-cta-button-login")}).options,actionAnchor:new r({progressive:!0,label:mw.msg("mobile-frontend-watchlist-cta-button-signup")}).options},t))}function c(t,e){return a.extend({returnto:e||mw.config.get("wgPageName")},t)}function u(){return[].push.call(arguments,{type:"signup"}),a.extend.apply(a,arguments)}i(l,s,{templatePartials:a.extend({},s.prototype.templatePartials,{button:o.prototype.template,anchor:r.prototype.template}),template:mw.template.get("mobile.startup","CtaDrawer.hogan"),preRender:function(){var t=c(this.options.queryParams,this.options.returnTo);this.options.progressiveButton.href||(this.options.progressiveButton.href=mw.util.getUrl("Special:UserLogin",t)),this.options.actionAnchor.href||(this.options.actionAnchor.href=mw.util.getUrl("Special:UserLogin",u(t,this.options.signupQueryParams)))}}),l.prototype.test={redirectParams:c,signUpParams:u},t.exports=l},"./src/mobile.startup/Drawer.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/Panel.js"),a=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/Icon.js");function r(t){s.call(this,a.extend({className:"drawer position-fixed"},t))}i(r,s,{defaults:a.extend({},s.prototype.defaults,{collapseIcon:new o({name:"arrow",additionalClassNames:"cancel"}).options}),templatePartials:a.extend({},s.prototype.templatePartials,{icon:o.prototype.template}),appendToElement:"body",closeOnScroll:!0,events:a.extend({},s.prototype.events,{click:"stopPropagation"}),postRender:function(){var t=this;a.docReady(function(){t.appendTo(t.appendToElement),t.$el.parent().addClass("has-drawer")}),this.on("show",this.onShowDrawer.bind(this)),this.on("hide",this.onHideDrawer.bind(this))},stopPropagation:function(t){t.stopPropagation()},onShowDrawer:function(){var t=this;this.$el.parent().addClass("drawer-visible"),setTimeout(function(){var e=a.getWindow();e.one("click.drawer",t.hide.bind(t)),t.closeOnScroll&&e.one("scroll.drawer",t.hide.bind(t))},t.minHideDelay)},onHideDrawer:function(){this.$el.parent().removeClass("drawer-visible"),a.getWindow().off(".drawer")}}),t.exports=r},"./src/mobile.startup/Icon.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/View.js");function a(t){t.hasText&&(t.modifier="mw-ui-icon-before"),t.href&&(t.tagName="a"),s.call(this,t)}i(a,s,{preRender:function(){this.setRotationClass()},setRotationClass:function(){var t=this.options;if(t.rotation)switch(t.rotation){case-180:case 180:t._rotationClass="mf-mw-ui-icon-rotate-flip";break;case-90:t._rotationClass="mf-mw-ui-icon-rotate-anti-clockwise";break;case 90:t._rotationClass="mf-mw-ui-icon-rotate-clockwise";break;case 0:break;default:throw new Error("Bad value for rotation given. Must be ±90, 0 or ±180.")}},isTemplateMode:!0,defaults:{rotation:0,hasText:!1,href:void 0,glyphPrefix:"mf",tagName:"div",isSmall:!1,base:"mw-ui-icon",name:"",modifier:"mw-ui-icon-element",title:""},getClassName:function(){return this.$el.attr("class")},getGlyphClassName:function(){return this.options.base+"-"+this.options.glyphPrefix+"-"+this.options.name},toHtmlString:function(){return this.parseHTML("<div>").append(this.$el).html()},template:mw.template.get("mobile.startup","icon.hogan")}),t.exports=a},"./src/mobile.startup/Overlay.js":function(t,e,n){var i=n("./src/mobile.startup/View.js"),s=n("./src/mobile.startup/Icon.js"),a=n("./src/mobile.startup/Button.js"),o=n("./src/mobile.startup/Anchor.js"),r=n("./src/mobile.startup/icons.js"),l=n("./src/mobile.startup/util.js"),c=n("./src/mobile.startup/Browser.js").getSingleton();function u(t){this.isIos=c.isIos(),this.useVirtualKeyboardHack=c.isIos(4)||c.isIos(5),this.hasLoadError=!1,i.call(this,l.extend({className:"overlay"},t))}n("./src/mobile.startup/mfExtend.js")(u,i,{hasFixedHeader:!0,fullScreen:!0,hideOnExitClick:!0,templatePartials:{header:mw.template.get("mobile.startup","header.hogan"),anchor:o.prototype.template,button:a.prototype.template},template:mw.template.get("mobile.startup","Overlay.hogan"),defaults:{saveMsg:mw.msg("mobile-frontend-editor-save"),cancelButton:r.cancel().toHtmlString(),backButton:new s({tagName:"button",name:"back",additionalClassNames:"back",label:mw.msg("mobile-frontend-overlay-close")}).toHtmlString(),headerButtonsListClassName:"",headerChrome:!1,spinner:r.spinner().toHtmlString()},events:{"click .cancel, .confirm, .initial-header .back":"onExitClick",click:"stopPropagation"},closeOnContentTap:!1,showSpinner:function(){this.$spinner.removeClass("hidden")},hideSpinner:function(){this.$spinner.addClass("hidden")},postRender:function(){this.$overlayContent=this.$(".overlay-content"),this.$spinner=this.$(".spinner"),this.isIos&&this.$el.addClass("overlay-ios"),this.$(".overlay-header h2 span").addClass("truncated-text"),this.setupEmulatedIosOverlayScrolling()},setupEmulatedIosOverlayScrolling:function(){var t=this;this.isIos&&this.hasFixedHeader&&(this.$(".overlay-content").on("touchstart",this.onTouchStart.bind(this)).on("touchmove",this.onTouchMove.bind(this)),setTimeout(function(){t._fixIosHeader(t.$("textarea, input"))},0))},onExitClick:function(t){t.preventDefault(),t.stopPropagation(),this.hideOnExitClick&&this.hide(),this.emit(u.EVENT_EXIT)},onTouchStart:function(t){this.startY=t.originalEvent.touches[0].pageY},onTouchMove:function(t){var e=t.originalEvent.touches[0].pageY,n=this.$overlayContent.outerHeight(),i=this.$overlayContent.prop("scrollHeight")-n;t.stopPropagation(),(0===this.$overlayContent.scrollTop()&&this.startY<e||this.$overlayContent.scrollTop()===i&&this.startY>e)&&t.preventDefault()},stopPropagation:function(t){t.stopPropagation()},show:function(){var t=this,e=l.getDocument(),n=l.getWindow();this.scrollTop=window.pageYOffset,this.fullScreen&&(e.addClass("overlay-enabled"),window.scrollTo(0,1)),this.closeOnContentTap&&e.find("#mw-mf-page-center").one("click",this.hide.bind(this)),this.isIos&&this.hasFixedHeader&&n.on("touchmove.ios",function(t){t.preventDefault()}).on("resize.ios",function(){t._resizeContent(n.height())}),this.$el.addClass("visible")},hide:function(){var t=l.getWindow(),e=l.getDocument();return this.fullScreen&&(e.removeClass("overlay-enabled"),window.scrollTo(window.pageXOffset,this.scrollTop)),this.$el.detach(),this.isIos&&t.off(".ios"),this.emit("hide"),!0},_resizeContent:function(t){this.$overlayContent.height(t-this.$(".overlay-header-container").outerHeight()-this.$(".overlay-footer-container").outerHeight())},_fixIosHeader:function(t){var e=this,n=l.getWindow();this.isIos&&(this._resizeContent(n.height()),t.on("focus",function(){setTimeout(function(){var t=0;e.useVirtualKeyboardHack&&(n.scrollTop(999),t=n.scrollTop(),n.scrollTop(0)),n.height()>t&&e._resizeContent(n.height()-t)},0)}).on("blur",function(){e._resizeContent(n.height()),n.scrollTop(0)}))},showHidden:function(t){this.$(".hideable").addClass("hidden"),this.$(t).removeClass("hidden")}}),u.EVENT_EXIT="Overlay-exit",t.exports=u},"./src/mobile.startup/OverlayManager.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s=null;function a(t,e){t.on("route",this._checkRoute.bind(this)),this.router=t,this.entries={},this.stack=[],this.hideCurrent=!0,e||mw.log.warn("appendToSelector will soon be a required parameter to OverlayManager"),this.appendToSelector=e||"body"}n("./src/mobile.startup/mfExtend.js")(a,{_onHideOverlay:function(){this.hideCurrent=!1,this.router.back()},_attachOverlay:function(t){t.$el.parents().length||$(this.appendToSelector).append(t.$el)},_show:function(t){t.once("_om_hide",this._onHideOverlay.bind(this)),this._attachOverlay(t),t.show()},_hideOverlay:function(t){var e;return t.off("_om_hide"),(e=t.hide(this.stack.length>1))||t.once("_om_hide",this._onHideOverlay.bind(this)),e},_processMatch:function(t){var e,n=this;function i(t){t.on("hide",function(){t.emit("_om_hide")})}t&&(t.overlay?n._show(t.overlay):"function"==typeof(e=t.factoryResult).promise?e.then(function(e){t.overlay=e,i(e),n._show(e)}):(t.overlay=e,i(t.overlay),n._show(e)))},_checkRoute:function(t){var e,n=this.stack[0];n||(this.scrollTop=window.pageYOffset),e=Object.keys(this.entries).reduce(function(e,n){return e||this._matchRoute(t.path,this.entries[n])}.bind(this),null),n&&void 0!==n.overlay&&this.hideCurrent&&!this._hideOverlay(n.overlay)?t.preventDefault():e||(this.stack=[],window.scrollTo(window.pageXOffset,this.scrollTop)),this.hideCurrent=!0,this._processMatch(e)},_matchRoute:function(t,e){var n,i=t.match(e.route),s=this.stack[1],a=this;function o(){return{path:t,factoryResult:e.factory.apply(a,i.slice(1))}}return i?s&&s.path===t?s.overlay&&s.overlay.hasLoadError?(a.stack.shift(),a.stack[0]=o(),a.stack[0]):(a.stack.shift(),s):(n=o(),this.stack[0]&&n.path===this.stack[0].path?a.stack[0]=n:a.stack.unshift(n),n):null},add:function(t,e){var n=this,s={route:t,factory:e};this.entries[t]=s,i.docReady(function(){n._processMatch(n._matchRoute(n.router.getPath(),s))})},replaceCurrent:function(t){if(0===this.stack.length)throw new Error("Trying to replace OverlayManager's current overlay, but stack is empty");this._hideOverlay(this.stack[0].overlay),this.stack[0].overlay=t,this._show(t)}}),a.getSingleton=function(){return s||(s=new a(mw.loader.require("mediawiki.router"),"body")),s},t.exports=a},"./src/mobile.startup/Page.js":function(t,e,n){var i=mw.html,s=n("./src/mobile.startup/mfExtend.js"),a=n("./src/mobile.startup/time.js"),o=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/Section.js"),l=n("./src/mobile.startup/Thumbnail.js"),c=n("./src/mobile.startup/View.js"),u=mw.config.get("wgMFMobileFormatterHeadings",["h1","h2","h3","h4","h5"]).join(","),d=["noviewer","metadata"];function h(t){o.extend(this,{options:t,title:t.title,displayTitle:t.displayTitle,url:t.url||mw.util.getUrl(t.title),id:t.id,wikidataDescription:t.wikidataDescription,thumbnail:!!Object.prototype.hasOwnProperty.call(t,"thumbnail")&&t.thumbnail,isMissing:void 0!==t.isMissing?t.isMissing:0===t.id}),this.options.isBorderBox=!1,this.options.languageUrl=mw.util.getUrl("Special:MobileLanguages/"+this.title),c.call(this,this.options),this.displayTitle||(this.displayTitle=this.getDisplayTitle()),this.thumbnail&&this.thumbnail.width&&(this.thumbnail.isLandscape=this.thumbnail.width>this.thumbnail.height)}s(h,c,{defaults:{id:0,title:"",displayTitle:"",namespaceNumber:0,protection:{edit:["*"]},sections:[],isMissing:!1,isMainPage:!1,url:void 0,thumbnail:{isLandscape:void 0,source:void 0,width:void 0,height:void 0}},getDisplayTitle:function(){return this.options.displayTitle||i.escape(this.options.title)},inNamespace:function(t){return this.options.namespaceNumber===mw.config.get("wgNamespaceIds")[t]},findSectionHeadingByIndex:function(t){return t<1?this.$():this.$(u).filter('.mw-parser-output > *, [class^="mf-section-"] > *').eq(t-1)},findChildInSectionLead:function(t,e){var n,i,s,a,o=u;function r(t){return t.find(e).addBack()}return 0===t?(a=this.getLeadSectionElement())&&a.length?r(a.children(e)):(n=this.findSectionHeadingByIndex(1)).length?r(n.prevAll(e)):this.$(e):(n=this.findSectionHeadingByIndex(t)).hasClass("section-heading")?(i=(s=n.next()).find(o).eq(0)).length?r(i.prevAll(e)):r(s.children(e)):(i=n.eq(0).nextAll(o).eq(0),n.nextUntil(i,e))},getLeadSectionElement:function(){return this.$(".mf-section-0").length?this.$(".mf-section-0"):null},isWikiText:function(){return"wikitext"===mw.config.get("wgPageContentModel")},isMainPage:function(){return this.options.isMainPage},isWatched:function(){return this.options.isWatched},getRevisionId:function(){return this.options.revId},getTitle:function(){return this.options.title},getId:function(){return this.options.id},getNamespaceId:function(){var t=this.options.title.split(":");return t[1]&&mw.config.get("wgNamespaceIds")[t[0].toLowerCase().replace(" ","_")]||0},isTalkPage:function(){var t=this.getNamespaceId();return t>0&&t%2==1},preRender:function(){this.sections=[],this._sectionLookup={},this.title=this.options.title,this.options.sections.forEach(function(t){var e=new r(t);this.sections.push(e),this._sectionLookup[e.id]=e}.bind(this))},getThumbnails:function(){var t=this.$el,e="."+d.join(",."),n=[];return this._thumbs||(t.find("a.image, a.thumbimage").not(e).each(function(){var i=t.find(this),s=i.find(".lazy-image-placeholder"),a=0===i.parents(e).length&&0===i.find(e).length,o=i.attr("href").match(/title=([^/&]+)/),r=i.attr("href").match(/[^/]+$/);s.length&&a&&(a=!new RegExp("\\b("+d.join("|")+")\\b").test(s.data("class"))),a&&(o||r)&&n.push(new l({el:i,filename:decodeURIComponent(o?o[1]:r[0])}))}),this._thumbs=n),this._thumbs},getSection:function(t){return this._sectionLookup[t]},getSections:function(){return this.sections},getRedLinks:function(){return this.$(".new")}}),h.newFromJSON=function(t){var e,n,s=t.thumbnail,r=t.pageprops||{displaytitle:i.escape(t.title)},l=t.terms;return(r||l)&&(n=l&&l.label?i.escape(l.label[0]):r.displaytitle),t.wikidataDescription=t.description||void 0,s&&(t.thumbnail.isLandscape=s.width>s.height),t.revisions&&t.revisions[0]&&(e=t.revisions[0],t.lastModified=a.getLastModifiedMessage(new Date(e.timestamp).getTime()/1e3,e.user)),new h(o.extend(t,{id:t.pageid,isMissing:!!t.missing,url:mw.util.getUrl(t.title),displayTitle:n}))},h.HEADING_SELECTOR=u,t.exports=h},"./src/mobile.startup/PageGateway.js":function(t,e,n){var i=mw.template.get("mobile.startup","Section.hogan"),s=n("./src/mobile.startup/util.js"),a=n("./src/mobile.startup/actionParams.js"),o={};function r(t){var e,n=t.map(function(t){return t.level}).filter(function(t){return!!t}),s=Math.min.apply(this,n).toString(),a=[];return t.forEach(function(t){void 0!==t.line&&(t.line=t.line.replace(/<\/?a\b[^>]*>/g,"")),t.subsections=[],!e||!t.level||t.level===s||e.subsections.length&&e.subsections[0].level>t.level||e.level&&e.level>=t.level?(a.push(t),e=t):(!function t(e,n){var i;0===e.length?e.push(n):(i=e[e.length-1],parseInt(i.level,10)===parseInt(n.level,10)?e.push(n):t(i.subsections,n))}(e.subsections,t),e.text+=i.render(t))}),a}function l(t){this.api=t}l.prototype={getPage:function(t,e,n){var i,l=s.Deferred(),c=e?{url:e,dataType:"jsonp"}:{},u={edit:["*"]};return s.extend(c,a({action:"mobileview",page:t,variant:mw.config.get("wgPageContentLanguage"),redirect:"yes",prop:"id|sections|text|lastmodified|lastmodifiedby|languagecount|hasvariants|protection|displaytitle|revision",noheadings:"yes",sectionprop:"level|line|anchor",sections:n?0:"all"})),o[t]||(o[t]=this.api.get(c).then(function(e){var n,a,o,c;return e.error?l.reject(e.error):e.mobileview.sections?(n=r((c=e.mobileview).sections),i=new Date(c.lastmodified).getTime()/1e3,a=c.lastmodifiedby,u=Array.isArray(c.protection)?u:s.extend(u,c.protection),o={title:t,id:c.id,revId:c.revId,protection:u,lead:n[0].text,sections:n.slice(1),isMainPage:void 0!==c.mainpage,historyUrl:mw.util.getUrl(t,{action:"history"}),lastModifiedTimestamp:i,languageCount:c.languagecount,hasVariants:void 0!==c.hasvariants,displayTitle:c.displaytitle},a&&s.extend(o,{lastModifiedUserName:a.name,lastModifiedUserGender:a.gender}),o):l.reject("No sections")},function(t){return l.reject(t)})),o[t]},invalidatePage:function(t){delete o[t]},_getLanguageVariantsFromApiResponse:function(t,e){var n=e.query.general,i=n.variantarticlepath,s=[];return!!n.variants&&(Object.keys(n.variants).forEach(function(e){var a=n.variants[e],o={autonym:a.name,lang:a.code};o.url=i?i.replace("$1",t).replace("$2",a.code):mw.util.getUrl(t,{variant:a.code}),s.push(o)}),s)},getPageLanguages:function(t,e){var n=this,i=a({meta:"siteinfo",siprop:"general",prop:"langlinks",lllimit:"max",titles:t});return e?(i.llprop="url|autonym|langname",i.llinlanguagecode=e):i.llprop="url|autonym",this.api.get(i).then(function(e){return{languages:e.query.pages[0].langlinks||[],variants:n._getLanguageVariantsFromApiResponse(t,e)}},function(){return s.Deferred().reject()})},_getAPIResponseFromHTML:function(t){var e=[];return t.find("h1,h2,h3,h4,h5,h6").each(function(){var n=this.tagName.substr(1),i=t.find(this).find(".mw-headline");i.length&&e.push({level:n,line:i.html(),anchor:i.attr("id")||"",text:""})}),e},getSectionsFromHTML:function(t){return r(this._getAPIResponseFromHTML(t))}},t.exports=l},"./src/mobile.startup/PageList.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/View.js"),a=n("./src/mobile.startup/Browser.js").getSingleton();function o(){s.apply(this,arguments)}i(o,s,{defaults:{pages:[]},renderPageImages:function(){var t=this;setTimeout(function(){t.$(".list-thumb").each(function(){var e=t.$(this).data("style");t.$(this).attr("style",e)})},a.isWideScreen()?0:1e3)},postRender:function(){this.renderPageImages()},template:mw.template.get("mobile.startup","PageList.hogan"),templatePartials:{item:mw.template.get("mobile.startup","PageListItem.hogan")}}),t.exports=o},"./src/mobile.startup/Panel.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/util.js"),a=n("./src/mobile.startup/View.js");function o(t){var e=s.extend({},{className:"panel"},t);a.call(this,e)}i(o,a,{minHideDelay:10,events:{"click .cancel":"onCancel"},onCancel:function(t){t.preventDefault(),this.hide()},show:function(){var t=this;t.isVisible()||setTimeout(function(){t.$el.addClass("visible animated"),t.emit("show")},t.minHideDelay)},hide:function(){var t=this;setTimeout(function(){t.$el.removeClass("visible"),t.emit("hide")},t.minHideDelay)},isVisible:function(){return this.$el.hasClass("visible")},toggle:function(){this.isVisible()?this.hide():this.show()}}),t.exports=o},"./src/mobile.startup/ScrollEndEventEmitter.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/mfExtend.js");function a(t,e){this.threshold=e||100,this.eventBus=t,this.enable(),OO.EventEmitter.call(this)}OO.mixinClass(a,OO.EventEmitter),a.EVENT_SCROLL_END="ScrollEndEventEmitter-scrollEnd",s(a,{_bindScroll:function(){this._scrollHandler||(this._scrollHandler=this._onScroll.bind(this),this.eventBus.on("scroll:throttled",this._scrollHandler))},_unbindScroll:function(){this._scrollHandler&&(this.eventBus.off("scroll:throttled",this._scrollHandler),this._scrollHandler=null)},_onScroll:function(){this.$el&&this.enabled&&this.scrollNearEnd()&&(this.disable(),this.emit(a.EVENT_SCROLL_END))},scrollNearEnd:function(){var t=i.getWindow(),e=t.scrollTop()+t.height(),n=this.$el.offset().top+this.$el.outerHeight();return e+this.threshold>n},enable:function(){this.enabled=!0,this._bindScroll()},disable:function(){this.enabled=!1,this._unbindScroll()},setElement:function(t){this.$el=t}}),t.exports=a},"./src/mobile.startup/Section.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/icons.js"),a=n("./src/mobile.startup/View.js");function o(t){var e=this;t.tag="h"+t.level,this.line=t.line,this.text=t.text,this.hasReferences=t.hasReferences||!1,this.id=t.id||null,this.anchor=t.anchor,this.subsections=[],(t.subsections||[]).forEach(function(t){e.subsections.push(new o(t))}),a.call(this,t)}i(o,a,{template:mw.template.get("mobile.startup","Section.hogan"),defaults:{line:void 0,text:"",spinner:s.spinner().toHtmlString()}}),t.exports=o},"./src/mobile.startup/Skin.js":function(t,e,n){var i=n("./src/mobile.startup/Browser.js").getSingleton(),s=n("./src/mobile.startup/lazyImages/lazyImageLoader.js"),a=n("./src/mobile.startup/View.js"),o=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/Page.js"),l=o.Deferred,c=n("./src/mobile.startup/icons.js"),u=mw.viewport,d=c.spinner();function h(t){var e,n=r.HEADING_SELECTOR,i=t.parent(),s=t.prevAll(n).eq(0);return s.length&&(e=s.find(".mw-headline").attr("id"))?e:i.length?h(i):null}function p(t){var e=this,n=o.extend({},t);this.page=n.page,this.name=n.name,n.mainMenu&&(this.mainMenu=n.mainMenu,mw.log.warn("Skin: Use of mainMenu is deprecated.")),this.eventBus=n.eventBus,n.isBorderBox=!1,a.call(this,n),this.referencesGateway=n.referencesGateway,mw.config.get("wgMFLazyLoadImages")&&o.docReady(function(){e.setupImageLoading()}),mw.config.get("wgMFLazyLoadReferences")&&this.eventBus.on("before-section-toggled",this.lazyLoadReferences.bind(this))}n("./src/mobile.startup/mfExtend.js")(p,a,{defaults:{page:void 0},events:{},postRender:function(){var t=this.$el;i.supportsAnimations()&&t.addClass("animations"),i.supportsTouchEvents()&&t.addClass("touch-events"),o.parseHTML('<div class="transparent-shield cloaked-element">').appendTo(t.find("#mw-mf-page-center")),this.emit("changed"),this.$("#mw-mf-page-center").on("click",this.emit.bind(this,"click"))},getUnloadedImages:function(t){return(t=t||this.$("#content")).find(".lazy-image-placeholder").toArray()},setupImageLoading:function(t){var e=this,n=1.5*o.getWindow().height(),i=this.getUnloadedImages(t);function a(){var t=[];return(i=o.grep(i,function(i){var s=e.$(i);return!s.length||!function(t){return u.isElementCloseToViewport(t[0],n)&&(t.is(":visible")||0===t.height())}(s)||(t.push(i),!1)})).length||(e.eventBus.off("scroll:throttled",a),e.eventBus.off("resize:throttled",a),e.eventBus.off("section-toggled",a),e.off("changed",a)),s.loadImages(e.$.bind(e),t)}return this.eventBus.on("scroll:throttled",a),this.eventBus.on("resize:throttled",a),this.eventBus.on("section-toggled",a),this.on("changed",a),a()},loadImagesList:function(t){return s.loadImages(this.$.bind(this),t||this.getUnloadedImages())},lazyLoadReferences:function(t){var e,n,i=this.referencesGateway,a=this.getUnloadedImages.bind(this),o=this;if(!t.wasExpanded&&t.isReferenceSection)return(e=t.$heading.next()).data("are-references-loaded")?l().reject().promise():(e.children().addClass("hidden"),n=d.$el.prependTo(e),i.getReferencesLists(t.page).then(function(){var s;e.find(".mf-lazy-references-placeholder").each(function(){var n=0,a=e.find(this),o=h(a);s!==o?(n=0,s=o):n++,o&&i.getReferencesList(t.page,o).then(function(t){t&&t[n]&&a.replaceWith(t[n])})}),n.remove(),e.children().removeClass("hidden"),o.emit("references-loaded",o.page),r()},function(){n.remove(),e.children().removeClass("hidden"),r()}));function r(){s.loadImages(o.$.bind(o),a(e)),e.data("are-references-loaded",1)}},getLicenseMsg:function(){var t,e=mw.config.get("wgMFLicense"),n=mw.language.convertNumber(e.plural);return e.link&&(t=this.$("#footer-places-terms-use").length>0?mw.msg("mobile-frontend-editor-licensing-with-terms",mw.message("mobile-frontend-editor-terms-link",this.$("#footer-places-terms-use a").attr("href")).parse(),e.link,n):mw.msg("mobile-frontend-editor-licensing",e.link,n)),t}}),p.getSectionId=h,t.exports=p},"./src/mobile.startup/Thumbnail.js":function(t,e,n){var i=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/util.js"),a=n("./src/mobile.startup/View.js");function o(t){a.call(this,s.extend({isBorderBox:!1},t))}i(o,a,{defaults:{filename:void 0},postRender:function(){this.options.description=this.$el.siblings(".thumbcaption").text()},getDescription:function(){return this.options.description},getFileName:function(){return this.options.filename}}),t.exports=o},"./src/mobile.startup/Toggler.js":function(t,e,n){var i=n("./src/mobile.startup/Browser.js").getSingleton(),s=n("./src/mobile.startup/util.js"),a=s.escapeHash,o={name:"arrow",additionalClassNames:"indicator"},r=n("./src/mobile.startup/Icon.js");function l(t){this.eventBus=t.eventBus,this._enable(t.$container,t.prefix,t.page,t.isClosed)}function c(t){var e=JSON.parse(mw.storage.get("expandedSections")||"{}");return e[t.title]=e[t.title]||{},e}function u(t){mw.storage.set("expandedSections",JSON.stringify(t))}function d(t,e,n){var i,s,a=c(n);e.find(".section-heading span").each(function(){s=e.find(this),i=s.parents(".section-heading"),a[n.title][s.attr("id")]&&!i.hasClass("open-block")&&t.toggle(i,n)})}function h(t){var e=(new Date).getTime(),n=c(t);Object.keys(n).forEach(function(t){var i=n[t];Object.keys(i).forEach(function(s){var a=i[s];Math.floor((e-a)/1e3/60/60/24)>=1&&delete n[t][s]})}),u(n)}l.prototype.toggle=function(t){var e,n=t.is(".open-block"),s=t.data("page"),a=t.data("section-number"),l=t.next();t.toggleClass("open-block"),t.data("indicator").remove(),o.rotation=n?0:180,e=new r(o).prependTo(t),t.data("indicator",e),this.eventBus.emit("before-section-toggled",{page:s,wasExpanded:n,$heading:t,isReferenceSection:Boolean(l.attr("data-is-reference-section"))}),l.toggleClass("open-block").attr({"aria-pressed":!n,"aria-expanded":!n}),this.eventBus.emit("section-toggled",n,a),i.isWideScreen()||function(t,e){var n=t.find("span").attr("id"),i=t.hasClass("open-block"),s=c(e);n&&(i?s[e.title][n]=(new Date).getTime():delete s[e.title][n],u(s))}(t,s)},l.prototype.reveal=function(t,e){var n,i;try{(i=(n=e.find(a(t))).parents(".collapsible-heading")).length||(i=n.parents(".collapsible-block").prev(".collapsible-heading")),i.length&&!i.hasClass("open-block")&&this.toggle(i),i.length&&window.scrollTo(0,n.offset().top)}catch(t){}},l.prototype._enable=function(t,e,n,a){var l,c,u,p,g,m=this,f=mw.config.get("wgMFCollapseSectionsByDefault");function b(){var e=window.location.hash;0===e.indexOf("#")&&m.reveal(e,t)}l=t.find("> h1,> h2,> h3,> h4,> h5,> h6,.section-heading").eq(0).prop("tagName")||"H1",void 0===f&&(f=!0),c=!f||mw.config.get("wgMFExpandAllSectionsUserOption")&&"true"===mw.storage.get("expandSections"),t.children(l).each(function(s){var l,d=t.find(this),h=d.find(".indicator"),g=e+"collapsible-block-"+s;d.next().is("div")&&(p=d.next("div"),l=Boolean(p.attr("data-is-reference-section")),d.addClass("collapsible-heading ").data("section-number",s).data("page",n).attr({tabindex:0,"aria-haspopup":"true","aria-controls":g}).on("click",function(t){t.target.href||(t.preventDefault(),m.toggle(d))}),o.rotation=c?180:0,u=new r(o),h.length?h.replaceWith(u.$el):u.prependTo(d),d.data("indicator",u.$el),p.addClass("collapsible-block").eq(0).attr({id:g,"aria-pressed":"false","aria-expanded":"false"}),function(t,e){e.on("keypress",function(n){13!==n.which&&32!==n.which||t.toggle(e)}).find("a").on("keypress mouseup",function(t){t.stopPropagation()})}(m,d),!l&&(!a&&i.isWideScreen()||c)&&m.toggle(d))}),function(){var e=mw.config.get("wgInternalRedirectTargetUrl"),n=!!e&&e.split("#")[1];n&&(window.location.hash=n,m.reveal(n,t))}(),b(),(g=t.find("a:not(.reference a)")).on("click",function(){void 0!==g.attr("href")&&g.attr("href").indexOf("#")>-1&&b()}),s.getWindow().on("hashchange",function(){b()}),!i.isWideScreen()&&n&&(d(this,t,n),h(n))},l._getExpandedSections=c,l._expandStoredSections=d,l._cleanObsoleteStoredSections=h,t.exports=l},"./src/mobile.startup/View.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/mfExtend.js"),a=["events"],o=/^(\S+)\s*(.*)$/,r=0;function l(){var t=this;a.forEach(function(e){void 0!==t[e]&&mw.log.deprecate(t,e,t[e],"Setting `"+e+"` on the View is deprecated. Please use options.")}),this.initialize.apply(this,arguments)}OO.mixinClass(l,OO.EventEmitter),s(l,{tagName:"div",isTemplateMode:!1,template:void 0,templatePartials:{},defaults:{},initialize:function(t){var e=this;OO.EventEmitter.call(this),t=i.extend({},this.defaults,t),this.options=t,this.cid=function(t){var e=(++r).toString();return t?t+e:e}("view"),"string"==typeof this.template&&(this.template=mw.template.compile(this.template)),t.el?this.$el=$(t.el):this.$el=this.parseHTML("<"+this.tagName+">"),this.$el.length?this._postInitialize(t):i.docReady(function(){e.$el=$(t.el),e._postInitialize(t)})},_postInitialize:function(t){var e=t.className;this.$el.addClass(e),!1!==t.isBorderBox&&this.$el.addClass("view-border-box"),this.render({})},preRender:function(){},postRender:function(){},render:function(t){var e,n;return i.extend(this.options,t),this.preRender(),this.undelegateEvents(),this.template&&!this.options.skipTemplateRender&&(n=this.template.render(this.options,this.templatePartials),this.isTemplateMode?(e=$(n),this.$el.replaceWith(e),this.$el=e):this.$el.html(n)),this.postRender(),this.delegateEvents(),this},$:function(t){return this.$el.find(t)},delegateEvents:function(t){var e,n,i;if(t=t||this.options.events||this.events)for(n in this.undelegateEvents(),t)"function"!=typeof(i=t[n])&&(i=this[t[n]]),i&&(e=n.match(o),this.delegate(e[1],e[2],i.bind(this)))},delegate:function(t,e,n){this.$el.on(t+".delegateEvents"+this.cid,e,n)},undelegateEvents:function(){this.$el&&this.$el.off(".delegateEvents"+this.cid)},undelegate:function(t,e,n){this.$el.off(t+".delegateEvents"+this.cid,e,n)},parseHTML:i.parseHTML}),["append","prepend","appendTo","prependTo","after","before","insertAfter","insertBefore","remove","detach"].forEach(function(t){l.prototype[t]=function(){return this.$el[t].apply(this.$el,arguments),this}}),t.exports=l},"./src/mobile.startup/actionParams.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s={action:"query",formatversion:2};t.exports=function(t){var e=mw.config.get("wgMFContentProviderScriptPath");return i.extend({},s,{origin:e?"*":void 0},t)}},"./src/mobile.startup/cache.js":function(t,e){function n(){this._cache={}}function i(){}n.prototype.get=function(t){return this._cache[t]},n.prototype.set=function(t,e){this._cache[t]=e},i.prototype.get=function(){},i.prototype.set=function(){},t.exports={MemoryCache:n,NoCache:i}},"./src/mobile.startup/context.js":function(t,e){t.exports={getMode:function(){return mw.config.get("wgMFMode")}}},"./src/mobile.startup/extendSearchParams.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/actionParams.js");t.exports=function(t){var e,n,a=mw.config.get("wgMFDisplayWikibaseDescriptions",{}),o=mw.config.get("wgMFContentProviderScriptPath");if(!Object.prototype.hasOwnProperty.call(a,t))throw new Error('"'+t+"\" isn't a feature that shows Wikibase descriptions.");return(e=Array.prototype.slice.call(arguments,1)).unshift({prop:[]}),e.push(mw.config.get("wgMFSearchAPIParams")),(n=i.extend.apply({},e)).prop=n.prop.concat(mw.config.get("wgMFQueryPropModules")),a[t]&&-1===n.prop.indexOf("description")&&n.prop.push("description"),o&&(n.origin="*"),s(n)}},"./src/mobile.startup/icons.js":function(t,e,n){var i=n("./src/mobile.startup/Icon.js"),s=n("./src/mobile.startup/util.js");t.exports={CANCEL_GLYPH:"overlay-close",Icon:i,cancel:function(t){var e=t?"overlay-close-"+t:"overlay-close";return new this.Icon({tagName:"button",name:e,additionalClassNames:"cancel",label:mw.msg("mobile-frontend-overlay-close")})},spinner:function(t){return t=t||{},new this.Icon(s.extend(t,{name:"spinner",label:mw.msg("mobile-frontend-loading-message"),additionalClassNames:"spinner loading"}))},watchIcon:function(){return new this.Icon({name:"watch",additionalClassNames:"watch-this-article"})},watchedIcon:function(){return new this.Icon({name:"watched",additionalClassNames:"watch-this-article watched"})}}},"./src/mobile.startup/lazyImages/lazyImageLoader.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s=i.Deferred,a=i.when;t.exports.loadImages=function(e,n){var i=n.map(function(n){return t.exports.loadImage(e(n))});return a.apply(null,i)},t.exports.loadImage=function(t){var e=s(),n=t.attr("data-width"),a=t.attr("data-height"),o=i.parseHTML("<img>",t[0].ownerDocument);return o.on("load",function(){o.addClass("image-lazy-loaded"),t.replaceWith(o),e.resolve()}),o.on("error",function(){e.reject()}),o.attr({class:t.attr("data-class"),width:n,height:a,src:t.attr("data-src"),alt:t.attr("data-alt"),style:t.attr("style"),srcset:t.attr("data-srcset")}),e}},"./src/mobile.startup/loadingOverlay.js":function(t,e,n){var i=n("./src/mobile.startup/icons.js"),s=n("./src/mobile.startup/Overlay.js");t.exports=function(){var t=new s({className:"overlay overlay-loading",noHeader:!0});return i.spinner().$el.appendTo(t.$(".overlay-content")),t}},"./src/mobile.startup/mfExtend.js":function(t,e){t.exports=function(t,e,n){var i;for(i in n?OO.inheritClass(t,e):(OO.initClass(t),n=e),n)t.prototype[i]=n[i]}},"./src/mobile.startup/moduleLoader.js":function(t,e){function n(){this._register={}}n.prototype={require:function(t){var e,n,i=this._register;function s(){if(!Object.hasOwnProperty.call(i,t))throw new Error("MobileFrontend Module not found: "+t);return i[t]}n=t.split("/");try{return(e=mw.loader.require(n[0]))[n[1]]?e[n[1]]:s()}catch(t){return s()}},define:function(t,e){var n=this;if(Object.hasOwnProperty.call(this._register,t))throw new Error("Module already exists: "+t);return this._register[t]=e,{deprecate:function(i){n.deprecate(i,e,t)}}},deprecate:function(t,e,n){var i;n&&(i="Use "+n+" instead."),mw.log.deprecate(this._register,t,e,i)}},t.exports=n},"./src/mobile.startup/rlModuleLoader.js":function(t,e,n){var i=n("./src/mobile.startup/loadingOverlay.js"),s=n("./src/mobile.startup/util.js");t.exports={newLoadingOverlay:function(){return i()},loadModule:function(t,e,n){var i=this.newLoadingOverlay();function a(){!e&&n&&i.hide()}return(n=void 0===n||n)&&(i.appendTo(document.body),i.show()),mw.loader.using(t).then(function(){return a(),i},function(){return a(),s.Deferred().reject().promise()})}}},"./src/mobile.startup/time.js":function(t,e,n){var i=["seconds","minutes","hours","days","months","years"],s=n("./src/mobile.startup/util.js"),a=[1,60,3600,86400,2592e3,31536e3];function o(t){for(var e=0;e<a.length&&t>a[e+1];)++e;return{value:Math.round(t/a[e]),unit:i[e]}}function r(t){return o(Math.round((new Date).getTime()/1e3)-t)}function l(t){return"seconds"===t.unit&&t.value<10}t.exports={getLastModifiedMessage:function(t,e,n,i){var a,o,c=[];return n=n||"unknown",l(a=r(t))?c.push("mobile-frontend-last-modified-with-user-just-now",n,e):c.push({seconds:"mobile-frontend-last-modified-with-user-seconds",minutes:"mobile-frontend-last-modified-with-user-minutes",hours:"mobile-frontend-last-modified-with-user-hours",days:"mobile-frontend-last-modified-with-user-days",months:"mobile-frontend-last-modified-with-user-months",years:"mobile-frontend-last-modified-with-user-years"}[a.unit],n,e,mw.language.convertNumber(a.value)),c.push(i||"#",mw.language.convertNumber(e?1:0),e?mw.util.getUrl("User:"+e):""),o=mw.message.apply(this,c).parse(),i?o:s.parseHTML("<div>").html(o).text()},getRegistrationMessage:function(t,e){var n,i=[];return e=e||"unknown",l(n=r(parseInt(t,10)))?i.push("mobile-frontend-joined-just-now",e):i.push({seconds:"mobile-frontend-joined-seconds",minutes:"mobile-frontend-joined-minutes",hours:"mobile-frontend-joined-hours",days:"mobile-frontend-joined-days",months:"mobile-frontend-joined-months",years:"mobile-frontend-joined-years"}[n.unit],e,mw.language.convertNumber(n.value)),mw.message.apply(this,i).parse()},timeAgo:o,getTimeAgoDelta:r,isNow:l,isRecent:function(t){return["seconds","minutes","hours"].indexOf(t.unit)>-1}}},"./src/mobile.startup/toast.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s="mobileFrontend/toast";function a(){mw.requestIdleCallback(this._showPending.bind(this))}a.prototype.show=function(t,e){"string"==typeof e&&(mw.log.warn("The use of the cssClass parameter of Toast.show is deprecated, please convert it to an options object."),e={type:e}),e=i.extend({tag:"toast"},e),this.notification=mw.notify(t,e)},a.prototype.hide=function(){void 0!==this.notification&&this.notification.then(function(t){t.close()})},a.prototype.showOnPageReload=function(t,e){mw.storage.get(s)?mw.log.warn("A pending toast message already exits. The page should have been reloaded by now."):mw.storage.set(s,JSON.stringify({content:t,className:e}))},a.prototype._showPending=function(){var t=mw.storage.get(s);t&&(t=JSON.parse(t),this.show(t.content,t.className),mw.storage.remove(s))},t.exports=new a},"./src/mobile.startup/util.js":function(t,e){t.exports={escapeSelector:function(t){return $.escapeSelector(t)},grep:function(){return $.grep.apply($,arguments)},docReady:function(t){return $(t)},when:function(){return $.when.apply($,arguments)},Deferred:function(){var t=$.Deferred(),e="Use Promise compatible methods `then` and `catch` instead.";return mw.log.deprecate(t,"fail",t.fail,e),mw.log.deprecate(t,"always",t.always,e),mw.log.deprecate(t,"done",t.done,e),t},getDocument:function(){return $(document.documentElement)},getWindow:function(){return $(window)},parseHTML:function(t,e){return $($.parseHTML(t,e))},isNumeric:function(){return $.isNumeric.apply($,arguments)},extend:function(){return $.extend.apply($,arguments)},escapeHash:function(t){return t.replace(/(:|\.)/g,"\\$1")},isModifiedEvent:function(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey},repeatEvent:function(t,e,n,i){return t.on(n,function(t){return e.emit(n,t)},i)}}},"./src/mobile.startup/watchstar/Watchstar.js":function(t,e,n){var i=n("./src/mobile.startup/View.js"),s=n("./src/mobile.startup/watchstar/WatchstarGateway.js"),a=n("./src/mobile.startup/icons.js"),o=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/mfExtend.js"),l=n("./src/mobile.startup/toast.js"),c=n("./src/mobile.startup/CtaDrawer.js");function u(t){i.call(this,o.extend({className:a.watchIcon().getClassName()},t))}r(u,i,{events:{"click a":"onLinksClick",click:"onStatusToggle"},defaults:{page:void 0,funnel:"unknown"},ctaDrawerOptions:{content:mw.msg("mobile-frontend-watchlist-cta"),queryParams:{warning:"mobile-frontend-watchlist-purpose",campaign:"mobile_watchPageActionCta",returntoquery:"article_action=watch"},signupQueryParams:{warning:"mobile-frontend-watchlist-signup-action"}},template:mw.template.compile('<a role="button">{{tooltip}}</a>',"hogan"),initialize:function(t){var e=i.prototype.initialize;this._watched=t.isWatched,this.gateway=new s(t.api),e.call(this,t)},preRender:function(){this.options.tooltip=this._watched?mw.msg("unwatchthispage"):mw.msg("watchthispage")},postRender:function(){var t=a.watchIcon().getGlyphClassName(),e=a.watchedIcon().getGlyphClassName()+" watched";this.$el.attr("title",this.options.tooltip),!mw.user.isAnon()&&this._watched?this.$el.addClass(e).removeClass(t):this.$el.addClass(t).removeClass(e),this.$el.removeClass("hidden")},onLinksClick:function(t){t.preventDefault()},onStatusToggleAnon:function(){this.drawer||(this.drawer=new c(this.ctaDrawerOptions)),this.drawer.show()},onStatusToggleUser:function(){var t,e=this,n=this.gateway,i=this.options.page,s=!this._watched;function a(){clearInterval(t)}t=setInterval(function(){l.show(mw.msg("mobile-frontend-watchlist-please-wait"))},1e3),n.postStatusesByTitle([i.getTitle()],s).then(function(){a(),e._watched=s,s?(e.render(),e.emit("watch"),l.show(mw.msg("mobile-frontend-watchlist-add",i.title))):(e.emit("unwatch"),e.render(),l.show(mw.msg("mobile-frontend-watchlist-removed",i.title)))},function(){a(),l.show(mw.msg("mobile-frontend-watchlist-error"),"error")})},onStatusToggle:function(){mw.user.isAnon()?this.onStatusToggleAnon.apply(this,arguments):this.onStatusToggleUser.apply(this,arguments)}}),t.exports=u},"./src/mobile.startup/watchstar/WatchstarGateway.js":function(t,e,n){var i=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/actionParams.js");function a(t){this.api=t}a.prototype={getStatuses:function(t,e){return i.when(this.getStatusesByID(t),this.getStatusesByTitle(e)).then(function(){return i.extend.apply(i,arguments)})},getStatusesByID:function(t){var e=this;return t.length?this.api.get({formatversion:2,action:"query",prop:"info",inprop:"watched",pageids:t}).then(function(t){return e._unmarshalGetResponse(t)}):i.Deferred().resolve({})},getStatusesByTitle:function(t){var e=this;return t.length?this.api.get(s({prop:"info",inprop:"watched",titles:t})).then(function(t){return e._unmarshalGetResponse(t)}):i.Deferred().resolve({})},postStatusesByTitle:function(t,e){var n={action:"watch",titles:t};return e||(n.unwatch=!e),this.api.postWithToken("watch",n)},_unmarshalGetResponse:function(t){return(t&&t.query&&t.query.pages||[]).reduce(function(t,e){return t[e.title]=e.watched,t},{})}},t.exports=a},"./src/mobile.startup/watchstar/WatchstarPageList.js":function(t,e,n){var i=n("./src/mobile.startup/PageList.js"),s=n("./src/mobile.startup/watchstar/Watchstar.js"),a=mw.user,o=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/Page.js"),l=n("./src/mobile.startup/mfExtend.js"),c=n("./src/mobile.startup/watchstar/WatchstarGateway.js");function u(t){this.wsGateway=new c(t.api),i.apply(this,arguments)}l(u,i,{postRender:function(){var t,e,n=this,s=[],a=[];return i.prototype.postRender.apply(this),t=this.queryUnitializedItems(),e=this.parsePagesFromItems(t),Object.keys(e).forEach(function(t){var n=e[t];n&&"0"!==n?s.push(n):a.push(t)}),this.getPages(s,a).then(function(e){n.renderItems(t,e)})},queryUnitializedItems:function(){return this.$("li:not(.with-watchstar)")},getPages:function(t,e){return a.isAnon()?o.Deferred().resolve({}):this.wsGateway.getStatuses(t,e)},parsePagesFromItems:function(t){var e=this,n={};return t.each(function(t,i){var s=e.$(i);n[s.attr("title")]=s.data("id")}),n},renderItems:function(t,e){var n=this;a.isAnon()||t.each(function(t,i){var s=n.$(i),a=new r({sections:[],title:s.attr("title"),id:s.data("id")}),o=n.parseHTML("<div>").appendTo(s),l=e[a.getTitle()];n._appendWatchstar(o,a,l),s.addClass("with-watchstar")})},_appendWatchstar:function(t,e,n){var i=new s({api:this.options.api,funnel:this.options.funnel,isAnon:a.isAnon(),isWatched:n,page:e,el:t});return o.repeatEvent(i,this,"watch"),o.repeatEvent(i,this,"unwatch"),i}}),t.exports=u},"./tests/node-qunit/mobile.languages.structured/LanguageOverlay.test.js":function(t,e,n){(function(t){var e,i,s=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),r=n("./tests/node-qunit/utils/oo.js"),l=n("sinon"),c=[{lang:"ar",url:"https://ar.wikipedia.org/wiki/%D8%A8%D8%A7%D8%B1%D8%A7%D9%83_%D8%A3%D9%88%D8%A8%D8%A7%D9%85%D8%A7",title:"باراك أوباما",autonym:"العربية"},{lang:"be",url:"https://be.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",autonym:"беларуская"},{lang:"be-x-old",url:"https://be-x-old.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",autonym:"беларуская (тарашкевіца)"},{lang:"ko",url:"https://ko.wikipedia.org/wiki/%EB%B2%84%EB%9D%BD_%EC%98%A4%EB%B0%94%EB%A7%88",title:"버락 오바마",autonym:"한국어"},{lang:"ru",url:"https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D0%B0%D0%BC%D0%B0,_%D0%91%D0%B0%D1%80%D0%B0%D0%BA",title:"Обама, Барак",autonym:"русский"},{lang:"uz",url:"https://uz.wikipedia.org/wiki/Barak_Obama",title:"Barak Obama",autonym:"oʻzbekcha/ўзбекча"},{lang:"zh",url:"https://zh.wikipedia.org/wiki/%E8%B4%9D%E6%8B%89%E5%85%8B%C2%B7%E5%A5%A5%E5%B7%B4%E9%A9%AC",title:"贝拉克·奥巴马",autonym:"中文"},{lang:"zh-min-nan",url:"https://zh-min-nan.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",langname:"Chinese",autonym:"Bân-lâm-gú"},{lang:"zh-yue",url:"https://zh-yue.wikipedia.org/wiki/%E5%A5%A7%E5%B7%B4%E9%A6%AC",title:"奧巴馬",autonym:"粵語"},{lang:"zu",url:"https://zu.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",autonym:"isiZulu"}],u={"zh-min-nan":1,zh:2,en:10,ko:1};QUnit.module("MobileFrontend LanguageOverlay.js",{beforeEach:function(){i=l.sandbox.create(),a.setUp(i,t),s.setUp(i,t),r.setUp(i,t),o.setUp(i,t),e=n("./src/mobile.languages.structured/LanguageOverlay.js"),i.stub(mw.storage,"get").withArgs("langMap").returns(JSON.stringify(u)),this.languageOverlay=new e({currentLanguage:"en",languages:c,variants:[],deviceLanguage:"en-us"})},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("render output",function(t){t.strictEqual(this.languageOverlay.$(".site-link-list.suggested-languages a").length,3,"There are 3 suggested languages."),t.strictEqual(this.languageOverlay.$(".site-link-list.all-languages a").length,7,"Seven languages are non-suggested.")}),QUnit.test("filterLanguages()",function(t){this.languageOverlay.filterLanguages("zh"),t.strictEqual(this.languageOverlay.$(".site-link-list a:not(.hidden)").length,3,'Three languages match "zh" and only those languages are visible.'),this.languageOverlay.filterLanguages("ol"),t.ok(1===this.languageOverlay.$(".site-link-list a:not(.hidden)").length&&this.languageOverlay.$(".site-link-list a:not(.hidden)").hasClass("be-x-old"),'One language (be-x-old) matches "ol" and only that language is visible.'),this.languageOverlay.filterLanguages("chin"),t.ok(1===this.languageOverlay.$(".site-link-list a:not(.hidden)").length&&this.languageOverlay.$(".site-link-list a:not(.hidden)").hasClass("zh-min-nan"),'One language (zh-min-nan) matches "Chin" (langname) and only that language is visible.'),this.languageOverlay.filterLanguages(""),t.strictEqual(this.languageOverlay.$(".site-link-list a:not(.hidden)").length,10,"The search filter has been cleared. All 10 languages (including variants) are visible."),this.languageOverlay.filterLanguages("ўз"),t.strictEqual(this.languageOverlay.$(".site-link-list a:not(.hidden)").length,1,'One language matches "ўз" and only that language is visible.')})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.languages.structured/util.test.js":function(t,e,n){(function(t){var e,i,s=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),r=n("sinon");QUnit.module("MobileFrontend mobile.languages.structured/util.test.js",{beforeEach:function(){this.apiLanguages=[{lang:"ar",url:"https://ar.wikipedia.org/wiki/%D8%A8%D8%A7%D8%B1%D8%A7%D9%83_%D8%A3%D9%88%D8%A8%D8%A7%D9%85%D8%A7",title:"باراك أوباما",dir:"rtl",autonym:"العربية"},{lang:"be",url:"https://be.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",dir:"ltr",autonym:"беларуская"},{lang:"be-x-old",url:"https://be-x-old.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",autonym:"беларуская (тарашкевіца)"},{lang:"es",url:"https://en.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",dir:"ltr",autonym:"Spanish"},{lang:"ko",url:"https://ko.wikipedia.org/wiki/%EB%B2%84%EB%9D%BD_%EC%98%A4%EB%B0%94%EB%A7%88",title:"버락 오바마",dir:"ltr",autonym:"한국어"},{lang:"ru",url:"https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D0%B0%D0%BC%D0%B0,_%D0%91%D0%B0%D1%80%D0%B0%D0%BA",title:"Обама, Барак",dir:"ltr",autonym:"русский"},{lang:"uz",url:"https://uz.wikipedia.org/wiki/Barak_Obama",title:"Barak Obama",dir:"ltr",autonym:"oʻzbekcha/ўзбекча"},{lang:"zh",url:"https://zh.wikipedia.org/wiki/%E8%B4%9D%E6%8B%89%E5%85%8B%C2%B7%E5%A5%A5%E5%B7%B4%E9%A9%AC",title:"贝拉克·奥巴马",dir:"ltr",autonym:"中文"},{lang:"zh-min-nan",url:"https://zh-min-nan.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",dir:"ltr",autonym:"Bân-lâm-gú"},{lang:"zh-yue",url:"https://zh-yue.wikipedia.org/wiki/%E5%A5%A7%E5%B7%B4%E9%A6%AC",title:"奧巴馬",dir:"ltr",autonym:"粵語"},{lang:"zu",url:"https://zu.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",dir:"ltr",autonym:"isiZulu"}],this.apiVariants=[{autonym:"不转换",lang:"zh",url:"/~bmansurov/mediawiki/index.php/3?variant=zh"},{autonym:"简体",lang:"zh-hans",url:"/~bmansurov/mediawiki/index.php/3?variant=zh-hans"}],this.deviceLanguage="en-us",this.frequentlyUsedLanguages={zh:2,ko:1},this.structuredLanguages={all:[{lang:"zh-min-nan",autonym:"Bân-lâm-gú",title:"Barack Obama",dir:"ltr",url:"https://zh-min-nan.wikipedia.org/wiki/Barack_Obama"},{lang:"zu",autonym:"isiZulu",title:"Barack Obama",dir:"ltr",url:"https://zu.wikipedia.org/wiki/Barack_Obama"},{lang:"uz",autonym:"oʻzbekcha/ўзбекча",title:"Barak Obama",dir:"ltr",url:"https://uz.wikipedia.org/wiki/Barak_Obama"},{lang:"es",autonym:"Spanish",title:"Barack Obama",dir:"ltr",url:"https://en.wikipedia.org/wiki/Barack_Obama"},{lang:"be",autonym:"беларуская",title:"Барак Абама",dir:"ltr",url:"https://be.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0"},{lang:"be-x-old",autonym:"беларуская (тарашкевіца)",title:"Барак Абама",dir:"ltr",url:"https://be-x-old.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0"},{lang:"ru",autonym:"русский",title:"Обама, Барак",dir:"ltr",url:"https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D0%B0%D0%BC%D0%B0,_%D0%91%D0%B0%D1%80%D0%B0%D0%BA"},{lang:"ar",autonym:"العربية",title:"باراك أوباما",dir:"rtl",url:"https://ar.wikipedia.org/wiki/%D8%A8%D8%A7%D8%B1%D8%A7%D9%83_%D8%A3%D9%88%D8%A8%D8%A7%D9%85%D8%A7"},{lang:"zh-yue",autonym:"粵語",title:"奧巴馬",dir:"ltr",url:"https://zh-yue.wikipedia.org/wiki/%E5%A5%A7%E5%B7%B4%E9%A6%AC"}],suggested:[{frequency:2,lang:"zh",autonym:"中文",title:"贝拉克·奥巴马",dir:"ltr",url:"https://zh.wikipedia.org/wiki/%E8%B4%9D%E6%8B%89%E5%85%8B%C2%B7%E5%A5%A5%E5%B7%B4%E9%A9%AC"},{frequency:1,lang:"ko",autonym:"한국어",title:"버락 오바마",dir:"ltr",url:"https://ko.wikipedia.org/wiki/%EB%B2%84%EB%9D%BD_%EC%98%A4%EB%B0%94%EB%A7%88"}]},i=r.sandbox.create(),a.setUp(i,t),s.setUp(i,t),o.setUp(i,t),i.stub(mw.storage,"get").withArgs("langMap").returns(JSON.stringify(this.frequentlyUsedLanguages)),e=n("./src/mobile.languages.structured/util.js"),this.saveSpy=i.stub(e,"saveFrequentlyUsedLanguages")},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("#getFrequentlyUsedLanguages",function(t){t.deepEqual(e.getFrequentlyUsedLanguages(),this.frequentlyUsedLanguages,"Frequently used languages is correct.")}),QUnit.test("#saveLanguageUsageCount",function(t){e.saveLanguageUsageCount("ko",e.getFrequentlyUsedLanguages()),t.ok(this.saveSpy.calledWith({zh:2,ko:2}),"Frequently used language is correctly saved.")}),QUnit.test("#getStructuredLanguages",function(t){var n=e.getStructuredLanguages(this.apiLanguages,!1,this.frequentlyUsedLanguages,this.deviceLanguage);t.deepEqual(n,this.structuredLanguages,"Structured languages are correct, including sort order.")}),QUnit.test("#getStructuredLanguages device language",function(t){var n=e.getStructuredLanguages(this.apiLanguages,!1,{},"es-lx").suggested[0].lang;t.strictEqual(n,"es",'"es" is correctly selected as a suggested language even though the device language is "es-lx".')}),QUnit.test("#getStructuredLanguages variants",function(t){var n,i={};n=e.getStructuredLanguages(this.apiLanguages,this.apiVariants,{},this.deviceLanguage).suggested,this.apiVariants.forEach(function(t){i[t.lang]=t}),n.forEach(function(e){t.ok(Object.prototype.hasOwnProperty.call(i,e.lang),'Variant "'+e.lang+'" is in the list of suggested languages.')})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.mediaViewer/ImageGateway.test.js":function(t,e,n){(function(t){var e,i,s,a=n("sinon"),o=n("./tests/node-qunit/utils/dom.js"),r=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/jQuery.js"),c=n("./src/mobile.startup/util.js");QUnit.module("MobileFrontend mobile.mediaViewer/ImageGateway",{beforeEach:function(){e=a.sandbox.create(),o.setUp(e,t),l.setUp(e,t),r.setUp(e,t),i=n("./src/mobile.mediaViewer/ImageGateway.js"),s=i._findSizeBucket},afterEach:function(){l.tearDown(),e.restore()}}),QUnit.test("#findSizeBucket",function(t){t.strictEqual(s(300),320,"value lower than bucket"),t.strictEqual(s(800),800,"exact value"),t.strictEqual(s(9999),2880,"value greater than last bucket")}),QUnit.test("ImageGateway#getThumb (missing page)",function(t){var e;e=new i({api:{get:function(){return c.Deferred().resolve({query:{pages:[{title:"Hello",missing:!0}]}})}}}),t.rejects(e.getThumb("Missing"),function(t){return-1!==t.message.indexOf("The API failed")},"A missing page throws an error which the client must handle")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.mediaViewer/ImageOverlay.test.js":function(t,e,n){(function(t){var e,i,s=n("./src/mobile.startup/util.js"),a=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),r=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("sinon");QUnit.module("MobileFrontend mobile.mediaViewer/ImageOverlay",{beforeEach:function(){e=c.sandbox.create(),o.setUp(e,t),a.setUp(e,t),l.setUp(e,t),r.setUp(e,t),i=n("./src/mobile.mediaViewer/ImageOverlay.js"),this.image={descriptionurl:"https://commons.wikimedia.org/wiki/File:The_Montgomery,_San_Francisco.jpg",thumbheight:1024,thumburl:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/The_Montgomery%2C_San_Francisco.jpg/676px-The_Montgomery%2C_San_Francisco.jpg",thumbwidth:676,url:"https://upload.wikimedia.org/wikipedia/commons/b/b1/The_Montgomery%2C_San_Francisco.jpg"},this.imageGateway={getThumb:function(){return s.Deferred().resolve({query:{pages:[{imageinfo:[this.image]}]}})}},this.router={getPath:function(){return"/media/File%3AA_cursiva.gif"}},this.thumbnails=[{filename:"foo",getFileName:function(){return""},getPath:function(){return""},getDescription:function(){return""}},{filename:"bar",getFileName:function(){return""},getPath:function(){return""},getDescription:function(){return""}}]},afterEach:function(){a.tearDown(),e.restore()}}),QUnit.test("Shows details bar and image with successful api response",function(t){var e=new i({gateway:this.imageGateway,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",router:this.router,eventBus:{on:function(){}}});return this.imageGateway.getThumb().then(function(){t.strictEqual(e.$el.find("img").length,1,"Image is present."),t.strictEqual(e.$el.find(".load-fail-msg").length,0,"Load error msg is not visible"),t.strictEqual(e.$el.find(".details.is-visible").length,1,"Details bar present")})}),QUnit.test("Shows error message with failed api response",function(t){var e,n={getThumb:function(){return s.Deferred().reject("Load Error")}};return e=new i({gateway:n,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",router:this.router,eventBus:{on:function(){}}}),n.getThumb().catch(function(){t.strictEqual(e.$el.find(".load-fail-msg").length,1,"Load error msg is visible"),t.strictEqual(e.$el.find(".details.is-visible").length,0,"Details bar is hidden")})}),QUnit.test("Toggling of details is disabled when overlay has load failure",function(t){var e,n={getThumb:function(){return s.Deferred().reject("Load Error")}};return e=new i({gateway:n,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",thumbnails:this.thumbnails,router:this.router,eventBus:{on:function(){}}}),n.getThumb().catch(function(){t.strictEqual(e.$el.find(".details.is-visible").length,0,"Details bar is hidden"),t.notStrictEqual(e.$el.find(".details"),"none","Slider buttons are shown"),t.notStrictEqual(e.$el.find(".cancel"),"none","Cancel button is still shown"),t.notStrictEqual(e.$el.find(".prev"),"none","Slider buttons are still shown"),e.$el.find(".image-wrapper").trigger("click"),t.notStrictEqual(e.$el.find(".details"),"none","Slider buttons are shown"),t.notStrictEqual(e.$el.find(".cancel"),"none","Cancel button is still shown"),t.notStrictEqual(e.$el.find(".prev"),"none","Slider buttons are still shown")})}),QUnit.test("Toggling of details is enabled when overlay loads successfully",function(t){var e=new i({gateway:this.imageGateway,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",thumbnails:this.thumbnails,router:this.router,eventBus:{on:function(){}}});return this.imageGateway.getThumb().then(function(){t.strictEqual(e.$el.find(".details.is-visible").length,1,"Details bar is shown"),t.notStrictEqual(e.$el.find(".details").css("display"),"none","Ensure display none rule is not set"),t.notStrictEqual(e.$el.find(".cancel").css("display"),"none","Cancel button is shown"),t.notStrictEqual(e.$el.find(".prev").css("display"),"none","Slider buttons are shown"),e.$el.find(".image-wrapper").trigger("click"),t.strictEqual(e.$el.find(".details").css("display"),"none","Details bar is hidden"),t.strictEqual(e.$el.find(".cancel").css("display"),"none","Cancel button is hidden"),t.strictEqual(e.$el.find(".slider-button").css("display"),"none","Slider buttons are hidden")})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.special.watchlist.scripts/WatchList.test.js":function(t,e,n){(function(t){var e,i,s,a=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),r=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("sinon");QUnit.module("MobileFrontend WatchList.js",{beforeEach:function(){s=c.sandbox.create(),o.setUp(s,t),a.setUp(s,t),l.setUp(s,t),r.setUp(s,t),this.spy=s.stub(mw.Api.prototype,"get"),s.stub(mw.user,"isAnon").returns(!1),e=n("./src/mobile.special.watchlist.scripts/WatchList.js"),i=n("./src/mobile.startup/Icon.js")},afterEach:function(){a.tearDown(),s.restore()}}),QUnit.test("In watched mode",function(t){var n=t.async(),s=this.spy,a=new e({eventBus:{on:function(){},off:function(){}},api:new mw.Api,pages:[{title:"Title 30"},{title:"Title 50"},{title:"Title 60",watched:!0}]}),o=new i({name:"watched"}).getGlyphClassName();a.scrollEndEventEmitter.disable(),window.setTimeout(function(){t.ok(s.notCalled,"Callback avoided"),t.strictEqual(a.$el.find(".watch-this-article").length,3,"3 articles have watch stars..."),t.strictEqual(a.$el.find("."+o).length,3,"...and all are marked as watched."),n()},2e3)})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.special.watchlist.scripts/WatchListGateway.test.js":function(t,e,n){(function(t){var e,i,s=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),r=n("./tests/node-qunit/utils/oo.js"),l=n("sinon"),c=n("./src/mobile.startup/util.js"),u={continue:{pageimages:{picontinue:9}},warnings:{query:{"*":"Formatting of continuation data will be changing soon. To continue using the current formatting, use the 'rawcontinue' parameter. To begin using the new format, pass an empty string for 'continue' in the initial query."}},query:{pages:[{pageid:2,ns:0,title:"Burrito",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-17T10:06:49Z",lastrevid:552,length:33534},{pageid:3,ns:0,title:"Albert Einstein",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-16T17:33:22Z",lastrevid:4,length:19},{pageid:9,ns:0,title:"Anne Dallas Dudley",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-17T10:00:13Z",lastrevid:18,length:12663},{pageid:10,ns:0,title:"San Francisco",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-17T10:04:55Z",lastrevid:546,length:373791},{pageid:708,ns:0,title:"Functional logic programming",contentmodel:"wikitext",pagelanguage:"en",touched:"2015-01-12T13:04:23Z",lastrevid:1307,length:1392,new:""},{pageid:720,ns:0,title:"Functional programming",contentmodel:"wikitext",pagelanguage:"en",touched:"2015-01-12T13:04:35Z",lastrevid:1319,length:54839,new:""},{ns:0,title:"zzzz",missing:!0,contentmodel:"wikitext",pagelanguage:"en"}]}};QUnit.module("MobileFrontend WatchListGateway.js",{beforeEach:function(){i=l.sandbox.create(),a.setUp(i,t),s.setUp(i,t),r.setUp(i,t),o.setUp(i,t),i.stub(mw.config,"get").withArgs("wgMFDisplayWikibaseDescriptions",{}).returns({watchlist:!0}).withArgs("wgMFMobileFormatterHeadings",["h1","h2","h3","h4","h5"]).returns(["h1","h2","h3","h4","h5"]),i.stub(mw.util,"getUrl",function(){}),e=n("./src/mobile.special.watchlist.scripts/WatchListGateway.js")},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("loadWatchlist() loads results from the first page",function(t){var n=new e(new mw.Api);return i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve(u)),n.loadWatchlist().then(function(e){var n=mw.Api.prototype.get.firstCall.args[0];t.strictEqual(n.continue,"","It should set the continue parameter"),t.strictEqual(e.length,7,"Got all the results"),t.strictEqual(e[0].displayTitle,"Albert Einstein","Sorted alphabetically")})}),QUnit.test("loadWatchlist() loads results from the second page from last item of first",function(t){var n,s=new e(new mw.Api,"Albert Einstein"),a=c.extend({},u,{continue:{watchlistraw:{gwrcontinue:"0|Albert Einstein"}}});return n=i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve(a)),s.loadWatchlist().then(function(e){var i=mw.Api.prototype.get.firstCall.args[0];return t.strictEqual(i.continue,"gwrcontinue||","It should set the continue parameter"),t.strictEqual(i.gwrcontinue,"0|Albert_Einstein","It should set the watchlistraw-specific continue parameter"),t.strictEqual(e.length,6,"Should have Albert removed from the results"),t.strictEqual(e[0].displayTitle,"Anne Dallas Dudley","First item should be Anne"),n.returns(c.Deferred().resolve(u)),s.loadWatchlist().then(function(e){t.strictEqual(e.length,7,"Albert should be in the results"),t.strictEqual(e[0].displayTitle,"Albert Einstein","First item should be Albert")})})}),QUnit.test("loadWatchlist() doesn't throw an error when no pages are returned",function(t){var n=new e(new mw.Api);return i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve({batchcomplete:""})),n.loadWatchlist().then(function(e){t.deepEqual(e,[])})}),QUnit.test("loadWatchlist() marks pages as new if necessary",function(t){var n=new e(new mw.Api);return i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve(u)),n.loadWatchlist().then(function(e){t.strictEqual(e[0].isMissing,!1,"Albert Einstein page isn't marked as new"),t.strictEqual(e[6].isMissing,!0,"zzzz page is marked as new")})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Browser.test.js":function(t,e,n){(function(t){var e,i,s=n("./src/mobile.startup/Browser.js"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("sinon"),l=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend Browser.js",{beforeEach:function(){var n;i=r.sandbox.create(),a.setUp(i,t),o.setUp(i,t),l.setUp(i,t),n=window.document.implementation.createHTMLDocument("Test"),e=$(n)},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("isIos()",function(t){var n=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e),i=new s("Mozilla/5.0 (iPad; CPU OS 4_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e),a=new s("Mozilla/5.0 (iPad; CPU OS 5_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e),o=new s("Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/8.0 Mobile/11A465 Safari/9537.53",e);t.strictEqual(n.isIos(),!0),t.strictEqual(n.isIos(8),!1),t.strictEqual(n.isIos(4),!1),t.strictEqual(n.isIos(5),!1),t.strictEqual(o.isIos(),!0),t.strictEqual(o.isIos(8),!0),t.strictEqual(i.isIos(4),!0),t.strictEqual(a.isIos(5),!0)}),QUnit.test("Methods are cached",function(t){var n=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e),i=new s("Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/8.0 Mobile/11A465 Safari/9537.53",e),a=new s("Android 2",e);function o(t,e){return t["__cache"+t[e].cacheId]}t.strictEqual(n.isIos(),!0),t.strictEqual(n.isIos(8),!1),t.strictEqual(a.isIos(8),!1),t.strictEqual(i.isIos(),!0),t.strictEqual(i.isIos(8),!0),t.strictEqual(Object.keys(o(n,"isIos")).length,2,"isIos on ipad cached as expected"),t.strictEqual(Object.keys(o(a,"isIos")).length,1,"isIos on android cached as expected"),t.strictEqual(Object.keys(o(i,"isIos")).length,2,"isIos on iphone cached as expected")}),QUnit.test("lockViewport()",function(t){var n,i=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e);i.$el.find("head").append('<meta name="viewport"/>'),i.lockViewport(),n=i.$el.find('meta[name="viewport"]').attr("content"),t.strictEqual(n,"initial-scale=1.0, maximum-scale=1.0, user-scalable=no")}),QUnit.test("isWideScreen()",function(t){var n=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e);i.stub(mw.config,"get",function(){return"720px"}),t.strictEqual(n.isWideScreen(),!0)}),QUnit.test("supportsAnimations() - true",function(t){var n,a=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e),o=i.stub(document,"createElement",function(){return{style:{animationName:"",transform:"",transition:""}}});n=a.supportsAnimations(),o.restore(),t.strictEqual(n,!0)}),QUnit.test("supportsAnimations() - false",function(t){var n,a=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e),o=i.stub(document,"createElement",function(){return{style:{}}});n=a.supportsAnimations(),o.restore(),t.strictEqual(n,!1)}),QUnit.test("supportsTouchEvents()",function(t){var n=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e);window.ontouchstart=window.ontouchstart||void 0,t.strictEqual(n.supportsTouchEvents(),!0)}),QUnit.test("supportsGeoLocation()",function(t){var n=new s("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",e);window.navigator.geolocation=window.navigator.geolocation||void 0,t.strictEqual(n.supportsGeoLocation(),!0)})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Button.test.js":function(t,e,n){(function(t){var e,i,s=n("sinon"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/oo.js"),l=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend Button.js",{beforeEach:function(){i=s.sandbox.create(),a.setUp(i,t),o.setUp(i,t),r.setUp(i,t),l.setUp(i,t),e=n("./src/mobile.startup/Button.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("creates a link if passed href option",function(t){var n=new e({href:"https://www.foo.com"});t.strictEqual(n.$el[0].tagName,"A"),t.strictEqual(n.$el[0].getAttribute("href"),"https://www.foo.com")}),QUnit.test("does not add href attribute when not a link",function(t){var n=new e({tagName:"div"});t.strictEqual(n.$el[0].tagName,"DIV"),t.strictEqual(n.$el[0].href,void 0)})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/CtaDrawer.test.html.js":function(t,e){t.exports={defaultURLs:'\n\t\t<div class=" drawer position-fixed view-border-box ">\n\t\t\t<div\n\t\t\t\tclass=" mw-ui-icon mw-ui-icon-mf-arrow mw-ui-icon-element cancel "\n\t\t\t\ttitle=""\n\t\t\t> </div>\n\t\t\t<p> </p>\n\t\t\t<a href=" logIn " class=" mw-ui-button mw-ui-progressive ">\n\t\t\t\tLog in\n\t\t\t</a>\n\t\t\t<div>\n\t\t\t\t<a href=" signUp " class=" mw-ui-anchor mw-ui-progressive ">\n\t\t\t\t\tSign up\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t',overrideURLs:'\n\t\t<div class=" drawer position-fixed view-border-box ">\n\t\t\t<div\n\t\t\t\tclass=" mw-ui-icon mw-ui-icon-mf-arrow mw-ui-icon-element cancel "\n\t\t\t\ttitle=""\n\t\t\t> </div>\n\t\t\t<p> </p>\n\t\t\t<a href=" customLogIn " class=" mw-ui-button mw-ui-progressive ">\n\t\t\t\tcustom log in\n\t\t\t</a>\n\t\t\t<div>\n\t\t\t\t<a href=" customSignUp " class=" mw-ui-anchor mw-ui-progressive ">\n\t\t\t\t\tcustom sign up\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t'}},"./tests/node-qunit/mobile.startup/CtaDrawer.test.js":function(t,e,n){(function(t){var e,i,s,a,o,r,l=n("./tests/node-qunit/utils/dom.js"),c=n("./tests/node-qunit/utils/jQuery.js"),u=n("./tests/node-qunit/utils/mw.js"),d=n("./tests/node-qunit/utils/oo.js"),h=n("sinon");QUnit.module("MobileFrontend CtaDrawer.js",{beforeEach:function(){o=h.sandbox.create(),l.setUp(o,t),c.setUp(o,t),d.setUp(o,t),u.setUp(o,t),o.stub(t.mw,"msg",function(t){switch(t){case"mobile-frontend-watchlist-cta-button-login":return"Log in";case"mobile-frontend-watchlist-cta-button-signup":return"Sign up"}return t}),o.stub(t.mw.util,"getUrl",function(t,e){return e.type?"signUp":"logIn"}),i=n("./src/mobile.startup/Anchor.js"),s=n("./src/mobile.startup/Button.js"),a=n("./src/mobile.startup/Drawer.js"),e=n("./src/mobile.startup/CtaDrawer.js"),o.stub(a.prototype,"appendToElement","#ctaDrawerParent"),(r=document.createElement("div")).id="ctaDrawerParent",document.documentElement.appendChild(r)},afterEach:function(){document.documentElement.removeChild(r),r=void 0,e=void 0,a=void 0,s=void 0,i=void 0,c.tearDown(),o.restore()}},function(){QUnit.module("redirectParams()",function(){QUnit.test("empty props, default URL",function(n){var i=e.prototype.test.redirectParams;o.stub(t.mw.config,"get",function(){return"pageName"}),n.propEqual(i({}),{returnto:"pageName"})}),QUnit.test("empty props, nondefault URL",function(t){var n=e.prototype.test.redirectParams;t.propEqual(n({},"url"),{returnto:"url"})}),QUnit.test("nonempty props",function(t){var n=e.prototype.test.redirectParams;t.propEqual(n({key:"val"},"url"),{key:"val",returnto:"url"})})}),QUnit.module("signUpParams()",function(){QUnit.test("empty props",function(t){var n=e.prototype.test.signUpParams;t.propEqual(n({}),{type:"signup"})}),QUnit.test("nonempty props",function(t){var n=e.prototype.test.signUpParams;t.propEqual(n({key:"val"}),{key:"val",type:"signup"})})}),QUnit.module("HTML",function(){QUnit.test("defaults",function(t){var i=new e,s=new RegExp(n("./tests/node-qunit/mobile.startup/CtaDrawer.test.html.js").defaultURLs.replace(/\s+/g,"\\s*"));h.assert.match(i.$el.get(0).outerHTML,s),t.ok(!0)}),QUnit.test("overrides",function(t){var a=new e({progressiveButton:new s({progressive:!0,label:"custom log in",href:"customLogIn"}).options,actionAnchor:new i({progressive:!0,label:"custom sign up",href:"customSignUp"}).options}),o=new RegExp(n("./tests/node-qunit/mobile.startup/CtaDrawer.test.html.js").overrideURLs.replace(/\s+/g,"\\s*"));h.assert.match(a.$el.get(0).outerHTML,o),t.ok(!0)})})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Drawer.test.js":function(t,e,n){(function(t){var e,i,s,a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("sinon"),u=n("./src/mobile.startup/util.js");function d(t,e){t.on("show",function(){setTimeout(e,t.minHideDelay)})}function h(){c.assert.match(s.className,/^((?!\bdrawer-visible\b).)*$/)}QUnit.module("MobileFrontend Drawer.js",{beforeEach:function(){i=c.sandbox.create(),a.setUp(i,t),o.setUp(i,t),l.setUp(i,t),r.setUp(i,t),e=n("./src/mobile.startup/Drawer.js"),i.stub(e.prototype,"appendToElement","#drawerParent"),(s=document.createElement("div")).id="drawerParent",document.documentElement.appendChild(s)},afterEach:function(){document.documentElement.removeChild(s),s=void 0,e=void 0,o.tearDown(),i.restore()}}),QUnit.test("appends self to parent when DOM is loaded",function(t){var n=t.async(),i=new e;u.docReady(function(){t.strictEqual(i.$el.parent().get(0),s),n()})}),QUnit.test("adds class to parent when DOM is loaded",function(t){var n=t.async();new e,u.docReady(function(){t.strictEqual(s.className,"has-drawer"),n()})}),QUnit.test("consumes clicks",function(t){var n=t.async(),i=new window.Event("click"),s=new e;i.stopPropagation=function(){t.ok(!0),n()},s.$el.get(0).dispatchEvent(i)}),QUnit.test("visible on show()",function(t){var n=t.async(),i=new e;i.on("show",function(){c.assert.match(s.className,/.*\bdrawer-visible\b.*/),t.ok(!0),n()}),i.show()}),QUnit.test("hidden on hide()",function(t){var n=t.async(),i=new e;i.on("hide",function(){h(),t.ok(!0),n()}),i.hide()}),QUnit.test("hidden on click once presented",function(t){var n=t.async(),i=new e;i.on("hide",function(){h(),t.ok(!0),n()}),d(i,function(){s.click()}),i.show()}),QUnit.test("hidden on scroll once presented",function(t){var n=t.async(),i=new e;i.on("hide",function(){h(),t.ok(!0),n()}),d(i,function(){var t=new window.Event("scroll",{bubbles:!0});s.dispatchEvent(t)}),i.show()}),QUnit.test("HTML is valid",function(t){var n=new e;t.strictEqual(n.$el.get(0).outerHTML,'<div class="drawer position-fixed view-border-box"></div>')})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Overlay.test.js":function(t,e,n){(function(t){var e,i,s=n("sinon"),a=n("./tests/node-qunit/utils/jQuery.js"),o=n("./src/mobile.startup/mfExtend.js"),r=n("./tests/node-qunit/utils/dom.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("./src/mobile.startup/util.js"),d=n("./node_modules/hogan.js/lib/hogan.js");QUnit.module("MobileFrontend: Overlay.js",{beforeEach:function(){i=s.sandbox.create(),r.setUp(i,t),a.setUp(i,t),c.setUp(i,t),l.setUp(i,t),e=n("./src/mobile.startup/Overlay.js"),i.stub(t.window,"scrollTo"),u.getDocument().find("#mw-mf-viewport").length||(this.$viewport=u.parseHTML("<div>").attr("id","mw-mf-viewport").appendTo("body"))},afterEach:function(){this.$viewport&&this.$viewport.remove(),a.tearDown(),i.restore()}}),QUnit.test("Simple overlay",function(t){var n;n=new e({heading:"<h2>Overlay Title</h2>"}).$el.find('h2:contains("Overlay Title")'),t.strictEqual(n.length,1)}),QUnit.test("HTML overlay",function(t){var n;function i(){e.apply(this,arguments)}o(i,e,{templatePartials:u.extend(e.prototype.templatePartials,{content:d.compile('<div class="content">YO</div>')})}),n=new i({heading:"Awesome"}),t.strictEqual(n.$el.find("h2").html(),"Awesome"),t.strictEqual(n.$el.find(".content").text(),"YO")}),QUnit.test("Close overlay",function(t){var n=new e({heading:"<h2>Title</h2>",content:"Text"});n.show(),n.hide(),t.strictEqual(n.$el[0].parentNode,null,"No longer in DOM")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/OverlayManager.test.js":function(t,e,n){(function(t){var e,i,s,a,o=n("sinon"),r=n("./tests/node-qunit/utils/dom.js"),l=n("./tests/node-qunit/utils/jQuery.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("./src/mobile.startup/util.js"),d=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend mobile.startup/OverlayManager",{beforeEach:function(){a=o.sandbox.create(),r.setUp(a,t),c.setUp(a,t),l.setUp(a,t),d.setUp(a,t),a.stub(t.window,"scrollTo"),e=n("./src/mobile.startup/OverlayManager.js"),this.createFakeOverlay=function(t){var e=new OO.EventEmitter;return e.hasLoadError=!1,e.show=a.spy(),e.hide=function(){return this.emit("hide"),!0},e.$el=$("div"),a.spy(e,"hide"),u.extend(e,t),e},(i=new OO.EventEmitter).getPath=a.stub().returns(""),i.back=a.spy(),a.stub(mw.loader,"require").withArgs("mediawiki.router").returns(i),s=new e(i,"body")},afterEach:function(){l.tearDown(),a.restore()}}),QUnit.test("#getSingleton",function(t){var n=e.getSingleton();t.ok(n instanceof e,"singleton exists"),t.strictEqual(n,e.getSingleton(),"same object returned each time")}),QUnit.test("#add",function(t){var e=this.createFakeOverlay();s.add(/^test$/,function(){return e}),i.emit("route",{path:"test"}),t.strictEqual(e.show.callCount,1,"show registered overlay")}),QUnit.test("#show",function(t){var e=this.createFakeOverlay(),n=a.spy(s,"_show");s.add(/^showTest$/,function(){return e}),i.emit("route",{path:"showTest"}),t.strictEqual(n.callCount,1,"OverlayManager.show called on route change")}),QUnit.test("#add, with $.Deferred factory",function(t){var e=u.Deferred(),n=this.createFakeOverlay();return e.show=a.spy(),s.add(/^foo$/,function(){return e}),i.emit("route",{path:"foo"}),e.resolve(n),e.then(function(){t.notOk(e.show.called,"don't call show on Deferred"),t.strictEqual(n.show.callCount,1,"show registered overlay")})}),QUnit.test("#add, with current path",function(t){var e=this.createFakeOverlay(),n=u.Deferred();return i.getPath=a.stub().returns("baha"),s.add(/^baha$/,function(){return e}),u.docReady(function(){n.resolve()}),n.then(function(){t.strictEqual(e.show.callCount,1,"show registered overlay")})}),QUnit.test("#replaceCurrent",function(t){var e=this.createFakeOverlay(),n=this.createFakeOverlay();s.add(/^test$/,function(){return e}),i.emit("route",{path:"test"}),s.replaceCurrent(n),t.strictEqual(e.hide.callCount,1,"hide overlay"),t.strictEqual(n.show.callCount,1,"show another overlay"),i.emit("route",{path:""}),t.strictEqual(n.hide.callCount,1,"hide another overlay")}),QUnit.test("route with params",function(t){var e=this.createFakeOverlay(),n=a.stub().returns(e);s.add(/^sam\/(\d+)$/,n),i.emit("route",{path:"sam/123"}),t.ok(n.calledWith("123"),"pass params from the route")}),QUnit.test("hide when route changes",function(t){var e=this.createFakeOverlay(),n=a.stub().returns(e);s.add(/^jon$/,n),i.emit("route",{path:"jon"}),i.emit("route",{path:""}),i.emit("route",{path:"jon"}),i.emit("route",{path:"other"}),t.strictEqual(e.hide.callCount,2,"hide overlay"),t.ok(e.hide.getCall(0).notCalledWith(!0),"don't force hide (first)"),t.ok(e.hide.getCall(1).notCalledWith(!0),"don't force hide (second)")}),QUnit.test("go back (change route) if overlay hidden but not by route change",function(t){var e=this.createFakeOverlay(),n=a.stub().returns(e);s.add(/^joakino$/,n),i.emit("route",{path:"joakino"}),e.hide(),t.strictEqual(i.back.callCount,1,"route back")}),QUnit.test("stacked overlays",function(t){var e=this.createFakeOverlay(),n=a.stub().returns(e),o=this.createFakeOverlay(),r=a.stub().returns(o);s.add(/^parent$/,r),s.add(/^child$/,n),i.emit("route",{path:"parent"}),t.strictEqual(o.show.callCount,1,"show parent"),i.emit("route",{path:"child"}),t.strictEqual(o.hide.callCount,1,"hide parent"),t.ok(o.hide.calledWith(!0),"hide parent forcefully (no confirmation)"),t.strictEqual(e.show.callCount,1,"show child"),i.emit("route",{path:"parent"}),t.strictEqual(e.hide.callCount,1,"hide child"),t.strictEqual(o.show.callCount,2,"show parent again"),t.strictEqual(r.callCount,1,"create parent only once")}),QUnit.test("prevent route change",function(t){var e=this.createFakeOverlay({hide:a.stub().returns(!1)}),n=a.stub().returns(e),o={path:"",preventDefault:a.spy()};s.add(/^rob$/,n),i.emit("route",{path:"rob"}),i.emit("route",o),t.ok(o.preventDefault.calledOnce,"prevent route change")}),QUnit.test("reload failed overlay when navigating to it again from another overlay",function(t){var e,n,o=this.createFakeOverlay(),r=this.createFakeOverlay();o.hasLoadError=!0,(n=a.stub()).onCall(0).returns(o),n.onCall(1).returns(r),e=function(t){return"0"===t?n():r},s.add(/^test\/(\d+)$/,e),i.emit("route",{path:"test/0"}),t.strictEqual(s.stack.length,1,"stack is correct size"),t.ok(s.stack[0].overlay.hasLoadError,"first overlay has load error"),i.emit("route",{path:"test/1"}),t.strictEqual(s.stack.length,2,"stack is correct size"),t.notOk(s.stack[0].overlay.hasLoadError,"second overlay loads successfully"),i.emit("route",{path:"test/0"}),t.strictEqual(s.stack.length,1,"stack decreases when going back to already visited overlay"),t.notOk(s.stack[0].overlay.hasLoadError,"Failed attempt is not cached and new overlay is loaded")}),QUnit.test("replace overlay when route event path is equal to current path",function(t){var e,n=this.createFakeOverlay(),o=this.createFakeOverlay();n.hasLoadError=!0,(e=a.stub()).onCall(0).returns(n),e.onCall(1).returns(o),s.add(/^test\/(\d+)$/,e),i.emit("route",{path:"test/0"}),t.strictEqual(s.stack.length,1,"stack is correct size"),t.ok(s.stack[0].overlay.hasLoadError,"overlay has load error"),i.emit("route",{path:"test/0"}),t.strictEqual(s.stack.length,1,"stack is correct size (did not increase upon reload)"),t.notOk(s.stack[0].overlay.hasLoadError,"overlay retry loads successfully")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Page.test.js":function(t,e,n){(function(t){var e,i,s,a,o,r,l,c=n("./tests/node-qunit/utils/dom.js"),u=n("./tests/node-qunit/utils/jQuery.js"),d=n("./tests/node-qunit/utils/mw.js"),h=n("./tests/node-qunit/utils/oo.js"),p=n("sinon"),g='<div class="mw-parser-output">';QUnit.module("MobileFrontend Page",{beforeEach:function(){var m=function(t){return'<div class="ambox">'+t+"</div>"},f=function(t){return'<h2 class="section-heading">'+t+"</h2>"},b=function(t,e){var n=e||"h3";return"<"+n+">"+t+"</"+n+">"},w=function(t,e){return'<div class="mf-section-'+t+'">'+e+"</div>"};s=p.sandbox.create(),c.setUp(s,t),d.setUp(s,t),u.setUp(s,t),h.setUp(s,t),e=n("./src/mobile.startup/Page.js"),i=n("./src/mobile.startup/util.js"),a=new e({el:i.parseHTML(g).html("<p>lead</p>"+m("a0"))}),o=new e({el:i.parseHTML(g).html(w(0,m("a0")+'<p>lead</p><div class="toc-mobile view-border-box"><h2></h2><div></div></div>')+f("1")+w(1,m("a1")+b("1.1")+m("a1.1")))}),r=new e({el:i.parseHTML(g).html("<p>lead</p>"+m("a0")+b("1","h2")+m("a1")+b("1.1")+m("a1.1"))}),l=new e({el:i.parseHTML(g).html(w(0,"<p>lead</p>"+m("a0"))+f("1")+w(1,m("a1")+b("1.1")+m("a1.1")+b("1.1.1","h4")+m("a1.1.1")+b("1.1.2","h4")+m("a1.1.2")+b("1.2")+m("a1.1"))+f("2")+w(6,m("a2"))+f("3")+w(7,m("a3"))+f("Section with nested Ambox")+w(8,m("<p>nested-ambox-parent,</p>"+m("nested-ambox-1,")+m("nested-ambox-2")))+f("Sub-section with nested Ambox")+w(9,m("<p>nested-ambox-parent,</p>"+m("nested-ambox-1,")+m("nested-ambox-2"))+b("subsection heading")+b("Another subsection heading")))})},afterEach:function(){u.tearDown(),s.restore()}}),QUnit.test("#findInSectionLead",function(t){[[0,"a0","lead section"],[1,"a1","h2"],[2,"a1.1","h3"],[3,"","h4","selector does not match",".foo"],[111,"","Non-existent section"]].forEach(function(e,n){var i=e[0],s=e[1],a=e[2],o=e[3]||".ambox";t.strictEqual(r.findChildInSectionLead(i,o).text(),s,"Found correct text in desktop test "+n+" case: "+a)}),[[0,"a0","lead section"],[3,"","h4","selector does not match",".foo"],[111,"","Non-existent section"]].forEach(function(e){t.strictEqual(a.findChildInSectionLead(e[0],e[3]||".ambox").text(),e[1],"Stub: Found correct text in desktop test case:"+e[2])}),[[0,"a0","lead section"],[1,"a1","h2"],[2,"a1.1","h3"],[3,"a1.1.1","h4"],[3,"","h4","selector does not match",".foo"],[7,"a3","h2 later"],[111,"","Non-existent section"]].forEach(function(e){t.strictEqual(l.findChildInSectionLead(e[0],e[3]||".ambox").text(),e[1],"Mobile: Found correct text in test case:"+e[2])}),[[0,"a0","lead section"],[1,"a1","h2"],[2,"a1.1","h3"],[111,"","Non-existent section"]].forEach(function(e){t.strictEqual(o.findChildInSectionLead(e[0],e[3]||".ambox").text(),e[1],"Mobile with table of contents: Found correct text in test case:"+e[2])}),[[8,".ambox","nested-ambox-parent,nested-ambox-1,nested-ambox-2","Nested elements in section"],[9,".ambox","nested-ambox-parent,nested-ambox-1,nested-ambox-2","Nested elements in subsection"]].forEach(function(e){var n=l.findChildInSectionLead(e[0],e[1]);t.strictEqual(n.not(n.children()).text(),e[2],"Mobile: Found correct text in test case:"+e[3])})}),QUnit.test("#isMainPage",function(t){var n=new e({title:"Main Page",isMainPage:!0}),i=new e({title:"Foo"});t.strictEqual(n.isMainPage(),!0,"check main page flag is updated"),t.strictEqual(i.isMainPage(),!1,"check not marked as main page")}),QUnit.test("#getThumbnails",function(t){var n,s,a,o,r,l,c,u,d,h;n=new e({el:i.parseHTML('<div><a href="/wiki/File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')}),s=new e({el:i.parseHTML("<div></div>")}),a=new e({el:i.parseHTML('<div><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')}),o=n.getThumbnails(),r=new e({el:i.parseHTML('<div><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box noviewer"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')}),l=new e({el:i.parseHTML('<div><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" class="metadata" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')}),h=new e({el:i.parseHTML('<div class="noviewer"><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')}),c=new e({el:i.parseHTML('<div><a href="/wiki/File:Design_portal_logo.jpg" class="image"><span class="lazy-image-placeholder" style="width: 28px;height: 28px;" data-src="//upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Design_portal_logo.jpg/28px-Design_portal_logo.jpg" data-alt="icon" data-width="28" data-height="28" data-class="noviewer">&nbsp;</span></a></div>')}),d=new e({el:i.parseHTML('<div><a href="/wiki/File:Design_portal_logo.jpg" class="image"><span class="lazy-image-placeholder" style="width: 28px;height: 28px;" data-src="//upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Design_portal_logo.jpg/28px-Design_portal_logo.jpg" data-alt="icon" data-width="28" data-height="28" data-class="wot noviewerz bar">&nbsp;</span></a></div>')}),u=new e({el:i.parseHTML('<div><table class="plainlinks metadata ambox ambox-content ambox-Unreferenced" role="presentation"><tr><td class="mbox-image"><div style="width:52px"><a href="/wiki/File:Question_book-new.svg" class="image"><span class="lazy-image-placeholder" style="width: 50px;height: 39px;" data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Question_book-new.svg/50px-Question_book-new.svg.png" data-alt="" data-width="50" data-height="39" data-srcset="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Question_book-new.svg/75px-Question_book-new.svg.png 1.5x, https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Question_book-new.svg/100px-Question_book-new.svg.png 2x"> </span></a></div></td></tr></table>')}),t.strictEqual(o.length,1,"Found expected number of thumbnails."),t.strictEqual(o[0].getFileName(),"File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg","Found expected filename."),o=s.getThumbnails(),t.strictEqual(o.length,0,"This page has no thumbnails."),o=a.getThumbnails(),t.strictEqual(o.length,1,"Found expected number of thumbnails."),t.strictEqual(o[0].getFileName(),"File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg","Found expected filename."),o=r.getThumbnails(),t.strictEqual(o.length,0,"This page has no thumbnails."),o=l.getThumbnails(),t.strictEqual(o.length,0,"This page has no thumbnails."),o=h.getThumbnails(),t.strictEqual(o.length,0,"Images inside a container with the class are not included. Images inside tables for example."),o=c.getThumbnails(),t.strictEqual(o.length,0,"Consider whether the class is on an image which has not been lazy loaded."),o=u.getThumbnails(),t.strictEqual(o.length,0,"Consider whether the lazy loaded image is inside a .metadata container."),o=d.getThumbnails(),t.strictEqual(o.length,1,"Thumbnail found if there is a typo.")}),QUnit.test("#getNamespaceId",function(t){[["Main Page",0],["San Francisco",0],["San Francisco: Talk:2",0],["San Francisco: The Sequel",0],["Talk:Foo",1],["Project:Bar",4],["User talk:Jon",3],["Special:Nearby",-1]].forEach(function(n){var i=new e({title:n[0]});t.strictEqual(i.getNamespaceId(),n[1],"Check namespace is as expected")})}),QUnit.test("#isTalkPage",function(t){[["Main Page",!1],["San Francisco",!1],["San Francisco: Talk:2",!1],["San Francisco: The Sequel",!1],["Talk:Foo",!0],["Project talk:Bar",!0],["User talk:Jon",!0],["Special:Nearby",!1]].forEach(function(n){var i=new e({title:n[0]});t.strictEqual(i.isTalkPage(),n[1],"Check test is as expected")})}),QUnit.test("#isMissing",function(t){var n,i;n=[new e({title:"Hello",id:0}),new e({title:"Hello",id:5,isMissing:!0}),new e({title:"Hello",isMissing:!0})],i=[new e({title:"Hello",id:4}),new e({title:"Hello",id:4,isMissing:!1}),new e({title:"Hello",isMissing:!1}),new e({title:"Hello",id:0,isMissing:!1})],n.forEach(function(e,n){t.strictEqual(e.isMissing,!0,"page "+n+" is missing")}),i.forEach(function(e,n){t.strictEqual(e.isMissing,!1,"page "+n+" is not missing")})}),QUnit.test("#allowsXSS",function(t){var n=new e({title:'<script>alert("oops, XSS possible!");<\/script>'});t.strictEqual(n.getDisplayTitle(),"&lt;script&gt;alert(&quot;oops, XSS possible!&quot;);&lt;/script&gt;","Check against XSS in Page.js constructor displaytitle (when title set)"),[{thumbnail:!1,title:'<script>alert("oops, XSS possible!");<\/script>',terms:!1,testDesc:"Check against XSS in Page.newFromJSON displaytitle (when title set)"},{thumbnail:!1,pageprops:[],terms:{label:['<script>alert("oops, XSS possible!");<\/script>']},testDesc:"Check against XSS in Page.newFromJSON displaytitle (when Wikibase label set)"}].forEach(function(i){n=e.newFromJSON(i),t.strictEqual(n.getDisplayTitle(),"&lt;script&gt;alert(&quot;oops, XSS possible!&quot;);&lt;/script&gt;",i.testDesc)})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/PageGateway.test.js":function(t,e,n){(function(t){var e,i,s,a,o=n("sinon"),r=n("./tests/node-qunit/utils/dom.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/jQuery.js"),u=n("./tests/node-qunit/utils/PageInputs.html.js"),d=u.page,h=u.page2,p=n("./tests/node-qunit/utils/PageGateway.responses.js");QUnit.module("MobileFrontend PageGateway",{beforeEach:function(){a=o.sandbox.create(),r.setUp(a,t),c.setUp(a,t),l.setUp(a,t),e=n("./src/mobile.startup/util.js"),i=n("./src/mobile.startup/PageGateway.js"),this.api=new mw.Api,s=new i(this.api)},afterEach:function(){c.tearDown(),a.restore()}}),QUnit.test("#getPage (h1s)",function(t){return a.stub(this.api,"get").returns(e.Deferred().resolve(p.getPageHeadings.input)),s.invalidatePage("Test"),a.stub(mw.util,"getUrl").returns("Test:History"),s.getPage("Test").then(function(e){t.propEqual(e,p.getPageHeadings.output,"return lead and sections test 1")})}),QUnit.test("#getPage",function(t){var n=a.stub(this.api,"get").returns(e.Deferred().resolve(p.getPage.input));return a.stub(mw.util,"getUrl").returns("Test:History"),s.invalidatePage("Test"),s.getPage("Test").then(function(e){return t.deepEqual(e,p.getPage.output,"return lead and sections test 2"),s.getPage("Test")}).then(function(){t.strictEqual(n.callCount,1,"cache page")})}),QUnit.test("#getPageLanguages (response)",function(t){return a.stub(this.api,"get").returns(e.Deferred().resolve(p.getPageLanguagesResponse.input)),s.getPageLanguages("Test").then(function(e){t.deepEqual(e.languages,p.getPageLanguagesResponse.output.languages,"return augmented language links"),t.deepEqual(e.variants,p.getPageLanguagesResponse.output.variants,"return augmented language variant links")})}),QUnit.test("#getPageLanguages (call)",function(t){var n=a.stub(this.api,"get").returns(e.Deferred().reject());a.stub($,"ajax").returns(e.Deferred().resolve()),s.getPageLanguages("Title","fr"),t.ok(n.calledWith(p.getPageLanguagesCall.output))}),QUnit.test("#_getAPIResponseFromHTML",function(t){var n=s._getAPIResponseFromHTML(e.parseHTML(d));t.deepEqual(p.getAPIResponseFromHTML.input,n)}),QUnit.test("#getSectionsFromHTML malformed (h2 before h1)",function(t){var n=s.getSectionsFromHTML(e.parseHTML(h));t.propEqual(n,[{line:"A1",level:"2",anchor:"1.0",text:'<h3 id="">A2.1</h3>\n\n',subsections:[{line:"A2.1",level:"3",anchor:"",text:"",subsections:[]}]},{line:"A2.2",level:"2",anchor:"",text:"",subsections:[]},{line:"A2",level:"1",anchor:"",text:'<h2 id="">A2.1</h2>\n\n',subsections:[{line:"A2.1",level:"2",anchor:"",text:"",subsections:[]}]}])}),QUnit.test("#getPage (forwards api errors)",function(t){return a.stub(this.api,"get").returns(e.Deferred().reject("missingtitle")),s.getPage("Err").catch(function(e){t.strictEqual(e,"missingtitle")})}),QUnit.test("#getPage (move protected page)",function(t){var n={edit:["*"],move:["sysop"]};return a.stub(this.api,"get").returns(e.Deferred().resolve({mobileview:{id:-1,displaytitle:"Test",revId:42,lastmodifiedby:{name:"bob",gender:"unknown"},protection:{move:["sysop"]},lastmodified:"2013-10-28T18:49:56Z",languagecount:10,sections:[{id:0,text:""}]}})),s.invalidatePage("Test"),s.getPage("Test").then(function(e){t.deepEqual(e.protection,n)})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Panel.test.js":function(t,e,n){(function(t){var e,i,s=n("sinon"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend Panel.js",{beforeEach:function(){i=s.sandbox.create(),a.setUp(i,t),o.setUp(i,t),l.setUp(i,t),r.setUp(i,t),e=n("./src/mobile.startup/Panel.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("show() when not visible",function(t){var n=t.async(),i=new e;i.on("show",function(){t.ok(i.$el.hasClass("visible"),"Visible class is set"),t.ok(i.$el.hasClass("animated"),"Animated class is set"),n()}),i.show()}),QUnit.test("hide() when visible",function(t){var n=t.async(),i=new e;i.on("hide",function(){t.notOk(i.$el.hasClass("visible","Visible class is removed")),n()}),i.show(),i.hide()}),QUnit.test("isVisible() when visible",function(t){var n=t.async(),i=new e;i.on("show",function(){t.ok(i.isVisible(),"Returns true when visible"),n()}),i.show()}),QUnit.test("isVisible() when not visible",function(t){var n=new e;t.notOk(n.isVisible(),"Returns false when not visible")}),QUnit.test("onCancel()",function(t){var n=t.async(),i=new e;i.on("hide",function(){t.notOk(i.$el.hasClass("visible"),"Removes visible class"),n()}),i.show(),i.onCancel({preventDefault:function(){}})}),QUnit.test("toggle()",function(t){var n=t.async(),i=new e;i.on("show",function(){t.ok(i.isVisible(),"Shows panel when not visible"),i.toggle()}),i.on("hide",function(){t.notOk(i.isVisible(),"Hides panel when visible"),n()}),i.toggle()})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/ScrollEndEventEmitter.test.js":function(t,e,n){(function(t){var e,i,s=n("sinon"),a=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend ScrollEndEventEmitter.js",{beforeEach:function(){e=s.sandbox.create(),a.setUp(e,t),i=n("./src/mobile.startup/ScrollEndEventEmitter.js")},afterEach:function(){e.restore()}}),QUnit.test("initializes properly",function(t){var e={on:s.spy()},n=new i(e,500),a=new i(e);t.strictEqual(n.enabled,!0,"Emission is enabled by default"),t.strictEqual(n.threshold,500,"Threshold is saved"),t.strictEqual(a.threshold,100,"Without a threshold we get a default"),t.strictEqual(e.on.withArgs("scroll:throttled",n._scrollHandler).calledOnce,!0,"Scrolling handler is bound")}),QUnit.test("emits scroll end event",function(t){var n={on:function(t,e){this.handler=e},off:function(){}},s=new i(n);e.stub(s,"scrollNearEnd").returns(!0),s.setElement({}),s.on(i.EVENT_SCROLL_END,function(){t.ok(!0,"scroll end event emitted")}),n.handler()}),QUnit.test("doesn't emit when disabled",function(t){var n=e.spy(i.prototype,"emit"),s={on:function(t,e){this.handler=e},off:function(){}},a=new i(s);a.setElement({}),a.disable(),s.handler(),t.strictEqual(n.called,!1,"emit should not be called")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Section.test.js":function(t,e,n){(function(t){var e,i,s=n("sinon"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend Section.js",{beforeEach:function(){i=s.sandbox.create(),a.setUp(i,t),o.setUp(i,t),r.setUp(i,t),e=n("./src/mobile.startup/Section.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("initialize with options",function(t){var n=new e({level:"1",line:"Line",text:"Text",hasReferences:!0,id:"ID",anchor:"Anchor"});t.strictEqual(n.line,"Line","line is set"),t.strictEqual(n.text,"Text","text is set"),t.strictEqual(n.hasReferences,!0,"hasReferences is set"),t.strictEqual(n.id,"ID","id is set"),t.strictEqual(n.anchor,"Anchor","anchor is set"),t.strictEqual(n.subsections.length,0,"Subsections are empty")}),QUnit.test("initialize with subsections",function(t){var n=new e({subsections:[{level:"",line:"Line",text:"Text",hasReferences:!0,id:"ID",anchor:"Anchor"}]}),i=n.subsections[0];t.strictEqual(n.subsections.length,1,"Subsection is added to array"),t.ok(i instanceof e,"Subsections are instances of Section"),t.strictEqual(i.line,"Line","line is set"),t.strictEqual(i.text,"Text","text is set"),t.strictEqual(i.hasReferences,!0,"hasReferences is set"),t.strictEqual(i.id,"ID","id is set"),t.strictEqual(i.anchor,"Anchor","anchor is set"),t.strictEqual(i.subsections.length,0,"Subsection children are empty")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Skin.test.js":function(t,e,n){(function(t){var e,i,s=n("./tests/node-qunit/utils/PageInputs.html.js"),a=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),r=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("sinon"),u=n("./src/mobile.startup/util.js");QUnit.module("MobileFrontend Skin.js",{beforeEach:function(){var s,d={getReferencesLists:function(){},getReferencesList:function(){}};e=c.sandbox.create(),o.setUp(e,t),a.setUp(e,t),l.setUp(e,t),r.setUp(e,t),i=n("./src/mobile.startup/Skin.js"),s=new(n("./src/mobile.startup/Page.js"))({title:"Foo"}),e.stub(mw.loader,"using").returns(u.Deferred().resolve()),e.stub(d,"getReferencesLists").returns(u.Deferred().resolve({})),e.stub(d,"getReferencesList").withArgs(s,"Notes_and_references").returns(u.Deferred().resolve(u.parseHTML("<p>").text("P"))).withArgs(s,"Notes").returns(u.Deferred().resolve(u.parseHTML("<p>").text("A"))).withArgs(s,"Refs").returns(u.Deferred().resolve(u.parseHTML("<p>").text("B"))).withArgs(s,"More_refs").returns(u.Deferred().resolve(u.parseHTML("<p>").html("<p>E</p><p>F</p>").children())),this.skin=new i({referencesGateway:d,page:s,eventBus:{on:function(){},off:function(){}}})},afterEach:function(){a.tearDown(),e.restore()}}),QUnit.test("#lazyLoadReferences",function(t){var e=u.parseHTML("<div>").append(s.skinPage);return this.skin.lazyLoadReferences({wasExpanded:!1,page:this.skin.page,isReferenceSection:!0,$heading:e.find("#Notes_and_references").parent()}).then(function(){t.strictEqual(e.find(".mf-section-2").text().replace(/[\t\n]/g,""),"TextPNotesARefsBno forgetMore refs1E2F3","Check all the references section is populated correctly.")})}),QUnit.test("#getSectionId",function(t){var e=u.parseHTML(["<div>",'<h2><span class="mw-headline" id="heading">H</span></h2>',"<div>",'<h3><span class="mw-headline" id="subheading">Subh</span></h3>','<a class="element"></a>',"</div>","</div>"].join("")),n=u.parseHTML(["<div>",'<h2><span class="mw-headline" id="Notes_and_references">Notes and references</span></h2>',"<div>",'<h3 class="in-block"><span class="mw-headline" id="Notes">Notes</span></h3>','<div class="reflist"><a class="element"></a></div>',"</div>","</div>"].join("")),s=u.parseHTML(['<div id="mw-content-text">','<h2><span class="mw-headline" id="heading">Heading</span></h2>','<div><a class="element"></a></div>',"</div>"].join("")),a=u.parseHTML(['<div id="mw-content-text">','<div><a class="element"></a></div>'].join("")),o=u.parseHTML(['<div id="mw-content-text">','<h2><span class="mw-headline" id="Foo">Foo</span></h2>',"<div>","<p>Foo content.</p>","</div>",'<h2><span class="mw-headline" id="Bar">Bar</span></h2>','<div class="reflist"><a class="element"></a></div>',"</div>","</div>"].join(""));t.strictEqual(i.getSectionId(e.find(".element")),"subheading"),t.strictEqual(i.getSectionId(n.find(".element")),"Notes","https://phabricator.wikimedia.org/T146394"),t.strictEqual(i.getSectionId(s.find(".element")),"heading"),t.strictEqual(i.getSectionId(a.find(".element")),null),t.strictEqual(i.getSectionId(o.find(".element")),"Bar")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Toggler.test.js":function(t,e,n){(function(t){var e,i,s,a=n("sinon"),o=n("./tests/node-qunit/utils/dom.js"),r=n("./tests/node-qunit/utils/jQuery.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend Toggler.js",{beforeEach:function(){e=a.sandbox.create(),o.setUp(e,t),r.setUp(e,t),l.setUp(e,t),c.setUp(e,t),i=n("./src/mobile.startup/Browser.js").getSingleton(),s=n("./src/mobile.startup/Toggler.js"),e.stub(mw.config,"get").withArgs("wgMFCollapseSectionsByDefault").returns(!0),e.stub(i,"isWideScreen").returns(!1),this.page={title:"Toggle test"},this.$container=$("<div>").html('\n\t\t<h2>\n\t\t<span id="First_Section">First Section</span>\n\t\t</h2>\n\t\t<div>\n\t\t\t<p>Text</p>\n\t\t</div>\n\t\t<h2 id="section_1">\n\t\t\t<a href="#foo">Dummy Link</a>\n\t\t</h2>\n\t\t<div></div>\n\t\t<h2>References</h2>\n\t\t<div data-is-reference-section="1">\n\t\t\t<ol class="references">\n\t\t\t\t<li id="cite_note-1">\n\t\t\t\t\t<span class="mw-cite-backlink">\n\t\t\t\t\t\t<a href="#cite_ref-1">↑</a>\n\t\t\t\t\t</span> <span class="reference-text">hello</span>\n\t\t\t\t</li>\n\t\t\t</ol>\n\t\t</div>\n'),this.$section0=this.$container.find("h2").eq(0),this.title=this.page.title,this.headline=this.$section0.find("span").attr("id")},afterEach:function(){mw.storage.remove("expandSections"),mw.storage.remove("expandedSections"),r.tearDown(),e.restore()}}),QUnit.test("Mobile mode - Toggle section",function(t){var e=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),n=this.$section0,i=this.$container.find(".collapsible-block").eq(0);e.toggle(n),t.strictEqual(n.hasClass("open-block"),!0,"open-block class present"),e.toggle(n),t.strictEqual(i.hasClass("open-block"),!1,"check content gets closed on a toggle"),t.strictEqual(n.hasClass("open-block"),!1,"check section is closed"),e.toggle(n),t.strictEqual(i.hasClass("open-block"),!0,"check content reopened"),t.strictEqual(n.hasClass("open-block"),!0,"check section has reopened")}),QUnit.test("Mobile mode - Clicking a hash link to reveal an already open section",function(t){var e=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page});e.toggle(this.$section0),t.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is open"),e.reveal("First_Section",this.$container),t.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is still open")}),QUnit.test("Mobile mode - Reveal element",function(t){var e=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page});e.toggle(this.$section0),e.reveal("First_Section"),t.strictEqual(this.$container.find(".collapsible-block").eq(0).hasClass("open-block"),!0,"check content is visible"),t.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is open")}),QUnit.test("Mobile mode - Clicking hash links",function(t){new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}).toggle(this.$section0),this.$container.find('[href="#First_Section"]').trigger("click"),t.strictEqual(this.$container.find(".collapsible-block").eq(0).hasClass("open-block"),!0,"check content is visible"),t.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is open")}),QUnit.test("Mobile mode - Tap event toggles section",function(t){var e=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),n=this.$container.find(".collapsible-block").eq(1);e.toggle(this.$section0),t.strictEqual(n.hasClass("open-block"),!1,"check content is hidden at start"),this.$container.find("#section_1").trigger("click"),t.strictEqual(n.hasClass("open-block"),!0,"check content is shown on a toggle")}),QUnit.test("Accessibility - Verify aria attributes",function(t){var e=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),n=this.$container.find("#section_1"),i=this.$container.find(".collapsible-block").eq(1);e.toggle(this.$section0),t.strictEqual(i.hasClass("open-block"),!1,"check content is hidden at start"),t.strictEqual(i.attr("aria-pressed"),"false","check aria-pressed is false at start"),t.strictEqual(i.attr("aria-expanded"),"false","check aria-expanded is false at start"),n.trigger("click"),t.strictEqual(i.hasClass("open-block"),!0,"check content is visible after toggling"),t.strictEqual(i.attr("aria-pressed"),"true","check aria-pressed is true after toggling"),t.strictEqual(i.attr("aria-expanded"),"true","check aria-expanded is true after toggling"),n.trigger("click"),t.strictEqual(i.hasClass("open-block"),!1,"check content is hidden after toggling"),t.strictEqual(i.attr("aria-pressed"),"false","check aria-pressed is false after toggling"),t.strictEqual(i.attr("aria-expanded"),"false","check aria-expanded is false after toggling")}),QUnit.test("Tablet mode - Open by default",function(t){i.isWideScreen.returns(!0),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),t.strictEqual(this.$container.find(".collapsible-block").eq(1).hasClass("open-block"),!0,"check section is visible at start"),t.strictEqual(this.$container.find(".collapsible-block").eq(2).hasClass("open-block"),!1,"check reference section is hidden at start")}),QUnit.test("Tablet mode - Open by default 2",function(t){mw.config.get.withArgs("wgMFCollapseSectionsByDefault").returns(!1),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),t.strictEqual(this.$container.find(".collapsible-block").eq(1).hasClass("open-block"),!0,"check section is visible at start")}),QUnit.test("Accessibility - Pressing space/ enter toggles a heading",function(t){var e,n=this.$container.find("#section_1"),a=$.Event("keypress");i.isWideScreen.returns(!1),mw.config.get.withArgs("wgMFCollapseSectionsByDefault").returns(!0),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),e=this.$container.find(".collapsible-block").eq(1),t.strictEqual(e.hasClass("open-block"),!1,"check content is hidden at start"),a.which=32,n.trigger(a),t.strictEqual(e.hasClass("open-block"),!0,"check content is shown after pressing space"),a.which=13,n.trigger(a),t.strictEqual(e.hasClass("open-block"),!1,"check content is hidden after pressing enter")}),QUnit.test("Clicking a link within a heading isn't triggering a toggle",function(t){var e=$("#section_1"),n=$(".collapsible-block").eq(1);new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),t.strictEqual(n.hasClass("open-block"),!1,"check content is hidden at start"),e.find("> a").eq(0).trigger("mouseup"),t.strictEqual(n.hasClass("open-block"),!1,"check content is still being hidden after clicking on the link")}),QUnit.test("Toggling a section stores its state.",function(t){var n,i,a=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),o=this.$container.find("h2"),r=s._getExpandedSections(this.page),l=e.spy(mw.storage,"set");t.strictEqual($.isEmptyObject(r[this.title]),!0,"no user setting about an expanded section exists already"),a.toggle(o),n=JSON.parse(l.getCall(0).args[1]),t.strictEqual(typeof n[this.title][this.headline],"number","the just toggled section state has been saved"),a.toggle(o),i=JSON.parse(l.getCall(1).args[1]),t.strictEqual(i[this.title][this.headline],void 0,"the just toggled section state has been removed")}),QUnit.test("Check for and remove obsolete stored sections.",function(t){var n,i,a,o;(a={})[this.title]={},a[this.title][this.headline]=new Date(1990,1,1).getTime(),e.stub(mw.storage,"get",function(){return JSON.stringify(a)}),n=s._getExpandedSections(this.page),t.strictEqual(typeof n[this.title][this.headline],"number","manually created section state has been saved correctly"),i=e.spy(mw.storage,"set"),s._cleanObsoleteStoredSections(this.page),o=JSON.stringify(["expandedSections",'{"Toggle test":{}}']),t.strictEqual(JSON.stringify(i.getCall(0).args),o,"section, whose store time is manually changed to an older date,has been removed from storage correctly")}),QUnit.test("Expanding already expanded section does not toggle it.",function(t){var n,i,a=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),o=this.$container.find("h2"),r=s._getExpandedSections(this.page);t.strictEqual($.isEmptyObject(r[this.title]),!0,"no expanded sections are stored in localStorage yet"),t.strictEqual(o.hasClass("open-block"),!1,"section does not have open-block class"),n=e.spy(mw.storage,"set"),a.toggle(o),t.strictEqual(o.hasClass("open-block"),!0,"revealed section has open-block class"),r=s._getExpandedSections(this.page),i=JSON.parse(n.getCall(0).args[1]),t.strictEqual(typeof i[this.title][this.headline],"number","manually revealed section state has been correctly saved in localStorage"),s._expandStoredSections(a,this.$container,this.page),t.strictEqual(o.hasClass("open-block"),!0,"already revealed section still has open-block class after expanding sections")}),QUnit.test("MobileFrontend toggle.js - Expand stored sections.",function(t){var n,i=this.$container.find("h2").eq(0),a=s._getExpandedSections(this.page);this.$container.find("h2").addClass("section-heading"),t.strictEqual(i.hasClass("open-block"),!1,"Section is collapsed."),t.strictEqual($.isEmptyObject(a[this.title]),!0,"no user setting about an expanded section exists already"),a[this.title][this.headline]=(new Date).getTime(),e.stub(mw.storage,"get",function(){return JSON.stringify(a)}),n=s._getExpandedSections(this.page),t.strictEqual(typeof n[this.title][this.headline],"number","manually created section state has been saved correctly"),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),a=s._getExpandedSections(this.page),t.strictEqual(typeof a[this.title][this.headline],"number","manually created section state is still active after toggle.init()"),t.strictEqual(i.hasClass("open-block"),!0,"Saved section has been auto expanded.")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/View.test.js":function(t,e,n){(function(t){var e,i,s=n("./node_modules/hogan.js/lib/hogan.js"),a=n("./tests/node-qunit/utils/mw.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/dom.js"),l=n("./src/mobile.startup/mfExtend.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("sinon");QUnit.module("MobileFrontend mobile.startup/View",{beforeEach:function(){i=u.sandbox.create(),r.setUp(i,t),o.setUp(i,t),c.setUp(i,t),a.setUp(i,t),e=n("./src/mobile.startup/View.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("View",function(t){var n=new e({el:"body"});t.ok(n.$el instanceof $,"assign jQuery object to $el"),t.strictEqual(n.$el[0].tagName.toUpperCase(),"BODY","assign proper jQuery object to $el")}),QUnit.test("View, jQuery proxy functions",function(t){var n=new e({el:"body"});["append","prepend","appendTo","prependTo","after","before","insertAfter","insertBefore","remove","detach"].forEach(function(e){var s=i.stub(n.$el,e);n[e]("test",1),t.ok(s.calledWith("test",1)),s.restore()})}),QUnit.test("View#preRender",function(t){var n;function i(){e.apply(this,arguments)}l(i,e,{template:s.compile("<p>{{text}}</p>"),preRender:function(){this.options.text="hello"}}),n=new i,t.strictEqual(n.$el.html(),"<p>hello</p>","manipulate template data")}),QUnit.test("View#postRender",function(t){var n=i.spy();function s(){e.apply(this,arguments)}l(s,e,{postRender:function(){n()}}),new s,t.strictEqual(n.callCount,1,"invoke postRender")}),QUnit.test("View#delegateEvents",function(t){var n;function i(){e.apply(this,arguments)}l(i,e,{template:s.compile("<p><span>test</span></p>"),events:{"click p span":function(e){e.preventDefault(),t.ok(!0,"Span was clicked and handled")},"click p":"onParagraphClick",click:"onClick"},onParagraphClick:function(e){e.preventDefault(),t.ok(!0,"Paragraph was clicked and handled")},onClick:function(e){e.preventDefault(),t.ok(!0,"View was clicked and handled")}}),(n=new i).appendTo("body"),n.$el.find("span").trigger("click"),n.$el.find("p").trigger("click"),n.$el.trigger("click"),n.undelegateEvents(),n.$el.find("span").trigger("click"),n.$el.find("p").trigger("click"),n.$el.trigger("click")}),QUnit.test("View#render (with isTemplateMode)",function(t){var n,i,a,o=$("<div>");function r(){e.apply(this,arguments)}function c(){e.call(this,{className:"bar"})}l(r,e,{template:s.compile('<p class="foo"><span>{{text}}</span></p>'),isTemplateMode:!0}),l(c,e,{template:s.compile('<p class="foo"><span>test</span></p>')}),a=(n=new r).$el.text(),i=new c,n.render(),i.render(),n.$el.appendTo(o),n.render({text:"hello"}),t.ok(n.$el.hasClass("foo")),t.ok(i.$el.hasClass("bar")),t.strictEqual(a,"","first run, no text defined"),t.strictEqual(n.$el.text(),"hello","second run, text has been defined"),t.strictEqual(n.$el.parent(o).length,1,"A re-rendered view thats attached to the DOM remains attached to the DOM")}),QUnit.test("View#render events (with isTemplateMode)",function(t){var n;function i(){e.apply(this,arguments)}l(i,e,{events:{"click span":"onClick"},onClick:function(){this.$el.empty().text("hello world")},template:s.compile('<p class="foo"><span>test</span></p>'),isTemplateMode:!0}),(n=new i).$("span").trigger("click"),t.strictEqual(n.$el.text(),"hello world","event was called"),t.strictEqual(n.$("span").length,0,"span disappeared"),(n=new i).render(),n.$("span").trigger("click"),t.strictEqual(n.$el.text(),"hello world","event was called"),t.strictEqual(n.$("span").length,0,"span disappeared")}),QUnit.test("View with className option",function(t){[[new e,"view-border-box","className not defined on a normal View without options and isBorderBox is default"],[new e({}),"view-border-box","className not defined on a normal View with empty options and isBorderBox is default"],[new e({className:"banana"}),"banana view-border-box","option is passed to View (along with default isBorderBox property)"],[new e({isBorderBox:!1}),void 0,"Passing isBorderBox option removes default view-border-box class"],[new e({isBorderBox:!0}),"view-border-box","Passing isBorderBox option as true retains default view-border-box class"]].forEach(function(e){t.strictEqual(e[0].$el.attr("class"),e[1],e[2])})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/cache.test.js":function(t,e,n){var i=new(0,n("./src/mobile.startup/cache.js").MemoryCache);QUnit.module("MobileFrontend cache.js"),QUnit.test("cache set() and get()",function(t){i.set("key","value"),t.strictEqual(i.get("key"),"value")})},"./tests/node-qunit/mobile.startup/context.test.js":function(t,e,n){(function(t){var e,i=n("sinon"),s=n("./tests/node-qunit/utils/mw.js"),a=n("./src/mobile.startup/context.js");QUnit.module("MobileFrontend context.js",{beforeEach:function(){e=i.sandbox.create(),s.setUp(e,t)},afterEach:function(){e.restore()}}),QUnit.test("getMode()",function(t){e.stub(mw.config,"get").withArgs("wgMFMode").returns("stable"),t.strictEqual(a.getMode(),"stable","Value comes straight from config")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/extendSearchParams.test.js":function(t,e,n){(function(t){var e,i,s=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/mw.js"),o=n("./tests/node-qunit/utils/dom.js"),r=n("sinon");QUnit.module("MobileFrontend extendSearchParams.js",{beforeEach:function(){e=r.sandbox.create(),a.setUp(e,t),o.setUp(e,t),s.setUp(e,t),e.stub(mw.config,"get").withArgs("wgMFSearchAPIParams").returns({foo:"bar"}).withArgs("wgMFDisplayWikibaseDescriptions").returns({search:!0,nearby:!1}).withArgs("wgMFQueryPropModules").returns(["baz"]),i=n("./src/mobile.startup/extendSearchParams.js")},afterEach:function(){s.tearDown(),e.restore()}}),QUnit.test("it throws if the feature is invalid",function(t){var e=new Error('"foo" isn\'t a feature that shows Wikibase descriptions.');t.throws(function(){i("foo",{})},e)}),QUnit.test("it extends the parameters",function(t){var e=i("search",{qux:"quux",prop:["corge"]});t.deepEqual(e,{action:"query",formatversion:2,qux:"quux",foo:"bar",prop:["corge","baz","description"]})}),QUnit.test("it doesn't include Wikibase-specific parameters if the feature is disabled",function(t){var e=i("nearby",{qux:"quux"});t.strictEqual(e.prop.indexOf("description"),-1),t.strictEqual(e.wbptterms,void 0)}),QUnit.test("it adds the MobileFrontend configuration to given terms types",function(t){var e=i("search",{wbptterms:"grault"});t.strictEqual(e.wbptterms,"grault",'The given "wbptterms" is added to the default.')}),QUnit.test("it prioritizes MobileFrontend configuration",function(t){var e=i("search",{foo:"quux"});t.deepEqual(e,{action:"query",formatversion:2,foo:"bar",prop:["baz","description"]},'The value of "foo" is overridden by the configuration.')}),QUnit.test("it is variadic",function(t){var e=i("search",{baz:"qux"},{quux:"corge"});t.deepEqual(e,{action:"query",formatversion:2,foo:"bar",baz:"qux",quux:"corge",prop:["baz","description"]})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/icons.test.js":function(t,e,n){(function(t){var e,i,s,a=n("sinon"),o=n("./tests/node-qunit/utils/dom.js"),r=n("./tests/node-qunit/utils/jQuery.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend icons.js",{beforeEach:function(){e=a.sandbox.create(),o.setUp(e,t),r.setUp(e,t),c.setUp(e,t),l.setUp(e,t),i=n("./src/mobile.startup/icons.js"),s=e.spy(i,"Icon")},afterEach:function(){e.restore(),r.tearDown()}}),QUnit.test("#cancel()",function(t){i.cancel(),t.deepEqual(s.getCall(0).args[0],{tagName:"button",name:i.CANCEL_GLYPH,additionalClassNames:"cancel",label:mw.msg("mobile-frontend-overlay-close")},"Options are passed down")}),QUnit.test("#cancel(variant)",function(t){i.cancel("gray"),t.deepEqual(s.getCall(0).args[0],{tagName:"button",name:i.CANCEL_GLYPH+"-gray",additionalClassNames:"cancel",label:mw.msg("mobile-frontend-overlay-close")},"Options are passed down")}),QUnit.test("#spinner()",function(t){i.spinner({foo:"will be passed down",additionalClassNames:"will-be-ignored"}),t.deepEqual(s.getCall(0).args[0],{foo:"will be passed down",additionalClassNames:"spinner loading",name:"spinner",label:mw.msg("mobile-frontend-loading-message")},"Options are passed down")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/mfExtend.test.js":function(t,e,n){(function(t){var e,i,s=n("sinon"),a=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend mfExtend.test.js",{beforeEach:function(){i=s.sandbox.create(),a.setUp(i,t),e=n("./src/mobile.startup/mfExtend.js")},afterEach:function(){i.restore()}}),QUnit.test("mfExtend() - extending from constructor",function(t){function n(){}function i(){}e(n,i,{}),t.strictEqual(n.prototype instanceof i,!0)}),QUnit.test("mfExtend() - extending from object",function(t){var n,i=new function(){this.protoMethod=function(){return!0}};function s(){}e(s,i),n=new s,t.strictEqual(n.protoMethod(),!0)}),QUnit.test("mfExtend() - extending from constructor with overrides",function(t){var n;function i(){}e(i,function(){this.protoMethod=function(){return!0}},{protoMethod:function(){return!1}}),n=new i,t.strictEqual(n.protoMethod(),!1)})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/moduleLoader.test.js":function(t,e,n){(function(t){var e,i,s=n("./tests/node-qunit/utils/oo.js"),a=n("sinon");QUnit.module("MobileFrontend ModuleLoader",{beforeEach:function(){i=a.sandbox.create(),s.setUp(i,t),e=n("./src/mobile.startup/moduleLoader.js"),this.loader=new e},afterEach:function(){i.restore()}}),QUnit.test("#require",function(t){this.loader.define("foo",1),this.loader.define("bar",5),t.strictEqual(this.loader.require("foo"),1,"Returns appropriate module"),t.strictEqual(this.loader.require("bar"),5,"Returns appropriate module"),t.throws(function(){this.loader.require("undefinedmodule")},"Cannot require an undefined module."),t.throws(function(){this.loader.require("mobile.modules/Foo")},"Cannot require an undefined export on a known module.")}),QUnit.test("#define",function(t){var e=this.loader;e.define("foo",1),e.define("bar",5),t.throws(function(){e.define("bar",50)},"Cannot define two modules with the same name"),t.strictEqual(this.loader.require("bar"),5,"Returns first definition of module.")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/rlModuleLoader.test.js":function(t,e,n){(function(t){var e,i,s=n("sinon"),a=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/oo.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./src/mobile.startup/util.js");function u(t,n,s,a){var o,r=this;return i.stub(e,"newLoadingOverlay").returns(this.stub),o=e.loadModule(n,s,a),t.strictEqual(this.stub.show.callCount,1,"LoadingOverlay show() called once"),t.strictEqual(this.stub.show.getCall(0).args.length,0,"LoadingOverlay show() called with no args"),t.strictEqual(this.stub.hide.callCount,0,"LoadingOverlay hide not called"),this.deferred.resolve(),o.then(function(e){t.strictEqual(e,r.stub,"Promise resolves to overlay instance"),t.strictEqual(r.stub.show.callCount,1,"LoadingOverlay show() called once"),t.strictEqual(r.stub.hide.callCount,1,"LoadingOverlay hide() called once"),t.strictEqual(r.stub.hide.getCall(0).args.length,0,"LoadingOverlay hide() called with no args")})}QUnit.module("MobileFrontend rlModuleLoader.js",{beforeEach:function(){i=s.sandbox.create(),a.setUp(i,t),o.setUp(i,t),r.setUp(i,t),l.setUp(i,t),e=n("./src/mobile.startup/rlModuleLoader.js"),i.stub(t.window,"scrollTo"),this.stub={appendTo:i.spy(),show:i.spy(),hide:i.spy()},this.deferred=c.Deferred(),i.stub(mw.loader,"using").withArgs("mobile.mediaViewer").returns(this.deferred)},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("#newLoadingOverlay does not blow up",function(t){t.expect(0),e.newLoadingOverlay()}),QUnit.test("#loadModule when instructed to show/hide overlay and successful",function(t){return u.apply(this,[t,"mobile.mediaViewer",!1,!0])}),QUnit.test("#loadModule when instructed to show/hide overlay (default args) and successful",function(t){return u.apply(this,[t,"mobile.mediaViewer",!1])}),QUnit.test("#loadModule when instructed to show/hide overlay and not successful",function(t){var n,s=this;return i.stub(e,"newLoadingOverlay").returns(this.stub),n=e.loadModule("mobile.mediaViewer",!1,!0),this.deferred.reject(),t.rejects(n,"returned promise rejects"),n.catch(function(){t.strictEqual(s.stub.show.callCount,1,"LoadingOverlay show() called once"),t.strictEqual(s.stub.appendTo.callCount,1,"LoadingOverlay appendTo() called once"),t.strictEqual(s.stub.hide.callCount,1,"LoadingOverlay hide() called once"),t.strictEqual(s.stub.hide.getCall(0).args.length,0,"LoadingOverlay hide() called with no args")})}),QUnit.test("#loadModule when instructed to show/not hide overlay and successful",function(t){var n,s=this;return i.stub(e,"newLoadingOverlay").returns(this.stub),n=e.loadModule("mobile.mediaViewer",!0,!0),t.strictEqual(this.stub.show.callCount,1,"LoadingOverlay show() called once"),t.strictEqual(this.stub.show.getCall(0).args.length,0,"LoadingOverlay show() called with no args"),t.strictEqual(this.stub.hide.callCount,0,"LoadingOverlay hide() not called"),this.deferred.resolve(),n.then(function(e){t.strictEqual(e,s.stub,"Promise resolves to overlay instance"),t.strictEqual(s.stub.show.callCount,1,"LoadingOverlay show() called once"),t.strictEqual(s.stub.hide.callCount,0,"LoadingOverlay hide() not called")})}),QUnit.test("#loadModule when instructed to show/not hide overlay and not successful",function(t){var n,s=this;return i.stub(e,"newLoadingOverlay").returns(this.stub),n=e.loadModule("mobile.mediaViewer",!0,!0),this.deferred.reject(),t.rejects(n,"returned promise rejects"),n.catch(function(){t.strictEqual(s.stub.show.callCount,1,"LoadingOverlay show() called once"),t.strictEqual(s.stub.hide.callCount,0,"LoadingOverlay hide() not called")})}),QUnit.test("#loadModule when instructed to not show overlay and successful",function(t){var n,s=this;return i.stub(e,"newLoadingOverlay").returns(this.stub),n=e.loadModule("mobile.mediaViewer",!1,!1),t.strictEqual(this.stub.show.callCount,0,"LoadingOverlay show() not called"),t.strictEqual(this.stub.hide.callCount,0,"LoadingOverlay hide() not called"),this.deferred.resolve(),n.then(function(e){t.strictEqual(e,s.stub,"Promise resolves to overlay instance"),t.strictEqual(s.stub.show.callCount,0,"LoadingOverlay show() not called"),t.strictEqual(s.stub.hide.callCount,0,"LoadingOverlay hide() not called")})}),QUnit.test("#loadModule when instructed to not show overlay and not successful",function(t){var n,s=this;return i.stub(e,"newLoadingOverlay").returns(this.stub),n=e.loadModule("mobile.mediaViewer",!1,!1),this.deferred.reject(),t.rejects(n,"returned promise rejects"),n.catch(function(){t.strictEqual(s.stub.show.callCount,0,"LoadingOverlay show() not called"),t.strictEqual(s.stub.hide.callCount,0,"LoadingOverlay hide() not called")})})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/time.test.js":function(t,e,n){var i=n("./src/mobile.startup/time.js");QUnit.module("MobileFrontend time.js"),QUnit.test("timeAgo()",function(t){t.deepEqual(i.timeAgo(40),{value:40,unit:"seconds"}),t.deepEqual(i.timeAgo(149),{value:2,unit:"minutes"}),t.deepEqual(i.timeAgo(150),{value:3,unit:"minutes"}),t.deepEqual(i.timeAgo(7500),{value:2,unit:"hours"}),t.deepEqual(i.timeAgo(9e4),{value:1,unit:"days"}),t.deepEqual(i.timeAgo(9e6),{value:3,unit:"months"}),t.deepEqual(i.timeAgo(32e6),{value:1,unit:"years"}),t.deepEqual(i.timeAgo(102e6),{value:3,unit:"years"})})},"./tests/node-qunit/mobile.startup/util.test.js":function(t,e,n){(function(t){var e,i,s=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),o=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/oo.js"),l=n("sinon");QUnit.module("MobileFrontend util.js",{beforeEach:function(){i=l.sandbox.create(),s.setUp(i,t),a.setUp(i,t),o.setUp(i,t),r.setUp(i,t),e=n("./src/mobile.startup/util.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("escapeSelector()",function(t){t.strictEqual(e.escapeSelector("#selector-starts-with-hash"),"\\#selector-starts-with-hash")}),QUnit.test("grep()",function(t){t.deepEqual(e.grep([1,2],function(t){return t>1}),[2])}),QUnit.test("docReady()",function(t){var n=e.docReady();t.strictEqual(n instanceof $,!0)}),QUnit.test("when()",function(t){return e.when({resolved:!0}).then(function(e){t.strictEqual(e.resolved,!0)})}),QUnit.test("Deferred() - resolve",function(t){var n=new e.Deferred;return n.resolve("response"),n.then(function(e){t.strictEqual(e,"response")})}),QUnit.test("Deferred() - reject",function(t){var n=new e.Deferred;return n.reject("response"),n.catch(function(e){t.strictEqual(e,"response")})}),QUnit.test("getDocument()",function(t){t.strictEqual(e.getDocument().length,1)}),QUnit.test("getWindow()",function(t){t.strictEqual(e.getWindow().length,1)}),QUnit.test("parseHTML()",function(t){var n=e.parseHTML("<p>element content</p>",document);t.strictEqual("object"==typeof n,!0),t.strictEqual(n[0].innerHTML,"element content")}),QUnit.test("isNumeric()",function(t){t.strictEqual(e.isNumeric(123),!0),t.strictEqual(e.isNumeric("123"),!0),t.strictEqual(e.isNumeric("The string 123 is true? I don't like it."),!1),t.strictEqual(e.isNumeric(NaN),!1)}),QUnit.test("extend()",function(t){var n={a:"apple"};e.extend(n,{b:"banana"}),t.strictEqual(JSON.stringify(n),'{"a":"apple","b":"banana"}')}),QUnit.test("escapeHash()",function(t){t.strictEqual(e.escapeHash("#escape:...hash"),"#escape\\:\\.\\.\\.hash")}),QUnit.test("isModifiedEvent() - true",function(t){var n=document.createElement("div");n.addEventListener("click",function(n){t.strictEqual(e.isModifiedEvent(n),!0)}),n.dispatchEvent(new window.MouseEvent("click",{ctrlKey:!0}))}),QUnit.test("isModifiedEvent() - false",function(t){var n=document.createElement("div");n.addEventListener("click",function(n){t.strictEqual(e.isModifiedEvent(n),!1)}),n.dispatchEvent(new window.MouseEvent("click"))}),QUnit.test("repeatEvent",function(t){var n=new OO.EventEmitter,i=new OO.EventEmitter;e.repeatEvent(i,n,"test"),n.on("test",function(e){t.strictEqual(e,"test data","proxy responds to source events correctly")}),i.emit("test","test data")})}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/utils/PageGateway.responses.js":function(t,e){t.exports={getPageHeadings:{input:{mobileview:{id:-1,displaytitle:"Test",revId:42,lastmodifiedby:{name:"bob",gender:"unknown"},protection:[],lastmodified:"2013-10-28T18:49:56Z",languagecount:10,sections:[{id:0,text:""},{level:"1",line:"1",anchor:"1",id:1,text:"<p>Text of 1\n</p>"},{level:"2",line:"<i>1.1</i>",anchor:"1.1",id:2,text:"<p>Text of 1.1\n</p>"},{level:"1",line:"2",anchor:"2",id:3,text:"<p>Text of 2\n</p>"},{level:"2",line:"2.1",anchor:"2.1",id:4,text:"<p>Text of 2.1\n</p>"}]}},output:{historyUrl:"Test:History",lastModifiedUserName:"bob",lastModifiedUserGender:"unknown",lastModifiedTimestamp:1382986196,title:"Test",revId:42,displayTitle:"Test",id:-1,protection:{edit:["*"]},isMainPage:!1,languageCount:10,hasVariants:!1,lead:"",sections:[{level:"1",line:"1",anchor:"1",id:1,text:'<p>Text of 1\n</p><h2 id="1.1"><i>1.1</i></h2>\n<p>Text of 1.1\n</p>\n',subsections:[{level:"2",line:"<i>1.1</i>",anchor:"1.1",id:2,text:"<p>Text of 1.1\n</p>",subsections:[]}]},{level:"1",line:"2",anchor:"2",id:3,text:'<p>Text of 2\n</p><h2 id="2.1">2.1</h2>\n<p>Text of 2.1\n</p>\n',subsections:[{level:"2",line:"2.1",anchor:"2.1",id:4,text:"<p>Text of 2.1\n</p>",subsections:[]}]}]}},getPage:{input:{mobileview:{id:-1,protection:{edit:["sysop"]},lastmodifiedby:{name:"Melissa",gender:"female"},revId:42,displaytitle:"Test",lastmodified:"2013-10-28T18:49:56Z",languagecount:10,sections:[{id:0,text:"lead content"},{level:"2",line:"Aaa section",anchor:"Aaa_section",id:1,text:"aaa content"},{level:"3",line:"Subaaa section",anchor:"Subaaa_section",id:2,text:"subaaa content"},{level:"2",line:"Bbb section",anchor:"Bbb_section",id:3,text:"bbb content"},{level:"2",line:"References",references:"",anchor:"References",id:4,text:"references"}]}},output:{historyUrl:"Test:History",lastModifiedUserName:"Melissa",lastModifiedUserGender:"female",lastModifiedTimestamp:1382986196,protection:{edit:["sysop"]},title:"Test",displayTitle:"Test",id:-1,isMainPage:!1,revId:42,languageCount:10,hasVariants:!1,lead:"lead content",sections:[{level:"2",line:"Aaa section",anchor:"Aaa_section",id:1,text:'aaa content<h3 id="Subaaa_section">Subaaa section</h3>\nsubaaa content\n',subsections:[{level:"3",line:"Subaaa section",anchor:"Subaaa_section",id:2,text:"subaaa content",subsections:[]}]},{level:"2",line:"Bbb section",anchor:"Bbb_section",id:3,text:"bbb content",subsections:[]},{level:"2",line:"References",references:"",anchor:"References",id:4,text:"references",subsections:[]}]}},getPageLanguagesResponse:{input:{query:{pages:[{pageid:94,ns:0,title:"San Francisco",langlinks:[{lang:"es",url:"http://es.wikipedia.org/wiki/San_Francisco_(California)",title:"San Francisco (California)",autonym:"español"},{lang:"pl",url:"http://pl.wikipedia.org/wiki/San_Francisco",title:"San Francisco",autonym:"polski"},{lang:"sr",url:"http://sr.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD_%D0%A4%D1%80%D0%B0%D0%BD%D1%86%D0%B8%D1%81%D0%BA%D0%BE",title:"Сан Франциско",autonym:"српски / srpski"}]}],general:{variants:[{code:"sr",name:"sr"},{code:"sr-ec",name:"Ћирилица"},{code:"sr-el",name:"Latinica"}],variantarticlepath:"/$2/$1"},languages:[{code:"sr",name:"српски / srpski"},{code:"sr-ec",name:"српски (ћирилица)"},{code:"sr-el",name:"srpski (latinica)‎"},{code:"es",name:"español"},{code:"pl",name:"polski"}]},limits:{langlinks:500}},output:{languages:[{lang:"es",url:"http://es.wikipedia.org/wiki/San_Francisco_(California)",title:"San Francisco (California)",autonym:"español"},{lang:"pl",url:"http://pl.wikipedia.org/wiki/San_Francisco",title:"San Francisco",autonym:"polski"},{lang:"sr",url:"http://sr.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD_%D0%A4%D1%80%D0%B0%D0%BD%D1%86%D0%B8%D1%81%D0%BA%D0%BE",title:"Сан Франциско",autonym:"српски / srpski"}],variants:[{lang:"sr",autonym:"sr",url:"/sr/Test"},{lang:"sr-ec",autonym:"Ћирилица",url:"/sr-ec/Test"},{lang:"sr-el",autonym:"Latinica",url:"/sr-el/Test"}]}},getPageLanguagesCall:{output:{action:"query",meta:"siteinfo",siprop:"general",prop:"langlinks",llprop:"url|autonym|langname",llinlanguagecode:"fr",lllimit:"max",titles:"Title",formatversion:2}},getAPIResponseFromHTML:{input:[{line:"A1",level:"1",anchor:"1.0",text:""},{line:"A2.1",level:"2",anchor:"",text:""},{line:"A2.2",level:"2",anchor:"",text:""},{line:"A2",level:"1",anchor:"",text:""},{line:"A2.1",level:"2",anchor:"",text:""}]}}},"./tests/node-qunit/utils/PageInputs.html.js":function(t,e){var n,i,s,a,o;n='<div>\n\t<h1><span class="mw-headline" id="1.0">A1</span></h1>\n\t<h2><span class="mw-headline">A2.1</span></h2>\n\t<h2><span class="mw-headline">A2.2</span></h2>\n\t<h1><span class="mw-headline">A2</span></h1>\n\t<h2><span class="mw-headline">A2.1</span><span>[<a href="#">edit</a>]</span></h2>\n\t<h1>Not to be shown in the TOC<span class="placeholder"></span></h1>\n</div>',i='<div>\n<h2><span class="mw-headline" id="1.0">A1</span></h2>\n<h3><span class="mw-headline">A2.1</span></h3>\n<h2><span class="mw-headline">A2.2</span></h2>\n<h1><span class="mw-headline">A2</span></h1>\n<h2><span class="mw-headline">A2.1</span></h2>\n</div>',s='<div id="mw-content-text">\n\t<h2 class="section-heading collapsible-heading open-block">\n\t\t<span class="mw-headline" id="Notes_and_references">Notes and references</span>\n\t</h2>\n\t<div class="mf-section-2 collapsible-block open-block" data-is-reference-section="1">\n\t\t<p>Text</p>\n\t\t<a class="mf-lazy-references-placeholder"></a>\n\t\t<h3><span class="mw-headline" id="Notes">Notes</span></h3>\n\t\t<a class="mf-lazy-references-placeholder"></a>\n\t\t<h4 class="in-block"><span class="mw-headline" id="Refs">Refs</span></h4>\n\t\t<a class="mf-lazy-references-placeholder"></a>\n\t\t<p>no forget</p>\n\t\t<h5 class="in-block"><span class="mw-headline" id="More_refs">More refs</span></h5>\n\t\t<p>1</p>\n\t\t<a class="mf-lazy-references-placeholder"></a>\n\t\t<p>2</p>\n\t\t<a class="mf-lazy-references-placeholder"></a>\n\t\t<p>3</p>\n\t</div>\n</div>',a='<div id="mfe-test-references">\n<sup id="cite_ref-1" class="reference">\n\t<a href="#cite_note-1">[1]</a>\n</sup>\n<p>\n\tsup with encoded href attribute\n\t<sup id="cite_ref-Obama_1995,_2004,_pp._9–10_11-0" class="reference">\n\t\t<a href="#cite_note-Obama_1995,_2004,_pp._9%E2%80%9310-11">[11]</a>\n\t</sup>\n</p>\n<ol class="references">\n\t<li id="cite_note-1">\n\t\t<span class="mw-cite-backlink">\n\t\t\t<a href="#cite_ref-1">↑</a>\n\t\t</span> <span class="reference-text">hello</span>\n\t</li>\n\t<li id="cite_note-Obama_1995,_2004,_pp._9–10-11">\n\t\t<span class="mw-cite-backlink">\n\t\t\t<a href="#cite_ref-1">↑</a>\n\t\t</span> <span class="reference-text">found</span>\n\t</li>\n</ol>\n</div>',o='<div>\n<h2><span class="mw-headline" id="1.0">A1</span></h1>\n<div>text</div>\n<h2>references</h2>\n<div>\n\t<a class="mf-lazy-references-placeholder">View citations</a>\n</div>\n</div>',t.exports={lazyLoadedReferencesPage:o,referencesPage:a,skinPage:s,page:n,page2:i}},"./tests/node-qunit/utils/blank.json":function(t){t.exports={}},"./tests/node-qunit/utils/dom.js":function(t,e,n){var i="object"!=typeof window,s=i&&n("jsdom");t.exports={setUp:function(t,e){i&&(e.window=e.window||void 0,e.document=e.document||void 0,t.stub(e,"window",(new s.JSDOM).window),t.stub(e,"document",window.document))}}},"./tests/node-qunit/utils/jQuery.js":function(t,e,n){var i="object"!=typeof window;t.exports={setUp:function(t,e){i&&(e.$=e.$||void 0,t.stub(e,"$",n("jquery")))},tearDown:function(){i&&delete n.c.jquery}}},"./tests/node-qunit/utils/mw.js":function(t,e,n){var i="object"!=typeof window,s=n("./tests/node-qunit/utils/blank.json");t.exports={setUp:function(t,e){i&&(e.mw=e.mw||void 0,t.stub(e,"mw",s()))}}},"./tests/node-qunit/utils/oo.js":function(t,e,n){var i="object"!=typeof window;t.exports={setUp:function(t,e){i&&(e.OO=e.OO||void 0,t.stub(e,"OO",n("oojs")))}}},0:function(t,e,n){n("./tests/node-qunit/mobile.languages.structured/LanguageOverlay.test.js"),n("./tests/node-qunit/mobile.languages.structured/util.test.js"),n("./tests/node-qunit/mobile.mediaViewer/ImageGateway.test.js"),n("./tests/node-qunit/mobile.mediaViewer/ImageOverlay.test.js"),n("./tests/node-qunit/mobile.special.watchlist.scripts/WatchList.test.js"),n("./tests/node-qunit/mobile.special.watchlist.scripts/WatchListGateway.test.js"),n("./tests/node-qunit/mobile.startup/Browser.test.js"),n("./tests/node-qunit/mobile.startup/Button.test.js"),n("./tests/node-qunit/mobile.startup/cache.test.js"),n("./tests/node-qunit/mobile.startup/context.test.js"),n("./tests/node-qunit/mobile.startup/CtaDrawer.test.js"),n("./tests/node-qunit/mobile.startup/Drawer.test.js"),n("./tests/node-qunit/mobile.startup/extendSearchParams.test.js"),n("./tests/node-qunit/mobile.startup/icons.test.js"),n("./tests/node-qunit/mobile.startup/mfExtend.test.js"),n("./tests/node-qunit/mobile.startup/moduleLoader.test.js"),n("./tests/node-qunit/mobile.startup/Overlay.test.js"),n("./tests/node-qunit/mobile.startup/OverlayManager.test.js"),n("./tests/node-qunit/mobile.startup/Page.test.js"),n("./tests/node-qunit/mobile.startup/PageGateway.test.js"),n("./tests/node-qunit/mobile.startup/Panel.test.js"),n("./tests/node-qunit/mobile.startup/rlModuleLoader.test.js"),n("./tests/node-qunit/mobile.startup/ScrollEndEventEmitter.test.js"),n("./tests/node-qunit/mobile.startup/Section.test.js"),n("./tests/node-qunit/mobile.startup/Skin.test.js"),n("./tests/node-qunit/mobile.startup/time.test.js"),n("./tests/node-qunit/mobile.startup/Toggler.test.js"),n("./tests/node-qunit/mobile.startup/util.test.js"),t.exports=n("./tests/node-qunit/mobile.startup/View.test.js")},jquery:function(t,e){!function(){t.exports=this.jquery}()},jsdom:function(t,e){!function(){t.exports=this.jsdom}()},oojs:function(t,e){!function(){t.exports=this.oojs}()},sinon:function(t,e){!function(){t.exports=this.sinon}()}},[[0,0]]]);
//# sourceMappingURL=tests.mobilefrontend.js.map.json