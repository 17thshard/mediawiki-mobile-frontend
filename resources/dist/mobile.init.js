this.mfModules=this.mfModules||{},this.mfModules["mobile.init"]=(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"./src/mobile.init/BetaOptInPanel.js":function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=n("./src/mobile.startup/Button.js"),l=n("./src/mobile.startup/util.js"),m=n("./src/mobile.startup/View.js"),u=mw.user,d=function(e){"use strict";function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,a(t).call(this,l.extend({isTemplateMode:!0,events:{"click .optin":"_onOptin","click .cancel":e.onCancel}},e)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,m),function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(t,[{key:"postRender",value:function(){this.$el.find(".message").append(this.options.buttons.map(function(e){return e.$el}))}},{key:"_onOptin",value:function(e){this.$el.find(e.currentTarget).closest("form").trigger("submit")}},{key:"template",get:function(){return l.template('\n\t<div class="beta-opt-in-panel panel panel-inline visible">\n\t\t<form class="message content" action="{{postUrl}}" method="POST">\n\t\t\t<p>{{text}}</p>\n\t\t\t<input type="hidden" name="updateSingleOption" value="enableBeta">\n\t\t\t<input type="hidden" name="enableBeta" value="true">\n\t\t\t<input type="hidden" name="token" value="{{editToken}}">\n\t\t</form>\n\t</div>\n\t')}},{key:"defaults",get:function(){return l.extend({},m.prototype.defaults,{postUrl:void 0,editToken:u.tokens.get("csrfToken"),text:mw.msg("mobile-frontend-panel-betaoptin-msg"),buttons:[new c({progressive:!0,additionalClassNames:"optin",label:mw.msg("mobile-frontend-panel-ok")}),new c({additionalClassNames:"cancel",label:mw.msg("mobile-frontend-panel-cancel")})]})}}]),t}();e.exports=d},"./src/mobile.init/editor.js":function(e,t,n){var i=n("./src/mobile.startup/moduleLoaderSingleton.js"),o=n("./src/mobile.startup/util.js"),r=n("./src/mobile.init/editorLoadingOverlay.js"),a=n("./src/mobile.startup/OverlayManager.js"),s=$("#ca-edit, .mw-editsection a, .edit-link"),c=mw.user,l=n("./src/mobile.startup/toast.js"),m=n("./src/mobile.startup/CtaDrawer.js"),u=/MSIE \d\./.test(navigator.userAgent),d=mw.config.get("wgPageContentModel"),g=mw.config.get("wgVisualEditorConfig"),p=mw.config.get("wgUserEditCount"),f=/^\/editor\/(\d+|all)$/;function w(e,t,n,l){var m,u,d,w=a.getSingleton(),b=0===e.id;s.on("click",function(e){!function(e,t,n){var i=new mw.Uri(e.href).query.section||"all";1===s.length&&(i="all"),n.navigate("#/editor/"+i),t.preventDefault()}(this,e,w.router)}),w.add(f,function(a){var s,l,m,u,f=window.innerWidth-document.documentElement.clientWidth,v=window.pageYOffset,h=$("#mw-content-text"),S={overlayManager:w,currentPageHTMLParser:n,fakeScroll:0,api:new mw.Api,licenseMsg:t.getLicenseMsg(),title:e.title,titleObj:e.titleObj,isAnon:c.isAnon(),isNewPage:b,editCount:p,oldId:mw.util.getParamValue("oldid"),contentLang:h.attr("lang"),contentDir:h.attr("dir"),sessionId:c.generateRandomSessionId()},y=mw.util.getParamValue("redlink")?"new":"click";function E(e){mw.track("mf.schemaEditAttemptStep",{action:"init",type:"section",mechanism:y,editor_interface:e,editing_session_id:S.sessionId})}function k(){var t=!!g,n=function(){var e=mw.storage.get("preferredEditor");if(e)return e;switch(mw.config.get("wgMFDefaultEditor")){case"source":return"SourceEditor";case"visual":return"VisualEditor";case"preference":return"visualeditor"===mw.user.options.get("visualeditor-editor")?"VisualEditor":"SourceEditor"}return"SourceEditor"}(),i=g&&g.namespaces||[];return t&&e.isWikiText()&&-1!==i.indexOf(mw.config.get("wgNamespaceNumber"))&&"translation"!==mw.config.get("wgTranslatePageTranslation")&&("VisualEditor"===n||"VisualEditor"===d)&&"SourceEditor"!==d}function j(){return E("wikitext"),mw.hook("mobileFrontend.editorOpening").fire(),mw.loader.using("mobile.editor.overlay").then(function(){return new(i.require("mobile.editor.overlay/SourceEditorOverlay"))(S)})}return"all"!==a&&(S.sectionId=e.isWikiText()?+a:null),s=o.Deferred(),m=r(function(){var e,t,n,i,o;$(document.body).addClass("ve-loading"),e=$("#mw-mf-page-center"),t=$("#content"),"0"===a||"all"===a?n=$("#bodyContent"):(n=$('[data-section="'+a+'"]').closest("h1, h2, h3, h4, h5, h6")).length||(n=$("#bodyContent")),e.css({"padding-right":"+="+f,"box-sizing":"border-box"}),e.prop("scrollTop",v),i=n[0].getBoundingClientRect().top,i-=48,k()?(o=!0===g.enableVisualSectionEditing||"mobile"===g.enableVisualSectionEditing,("0"===a||"all"===a||o)&&(i-=16)):"0"!==a&&"all"!==a||(i-=16),t.css({transform:"translate( 0, "+-i+"px )","padding-bottom":"+="+i,"margin-bottom":"-="+i}),S.fakeScroll=i,setTimeout(s.resolve,500)},function(){l&&l.abort&&l.abort(),$("#content").css({transform:"","padding-bottom":"","margin-bottom":""}),$("#mw-mf-page-center").css({"padding-right":"","box-sizing":""}),$(document.body).removeClass("ve-loading")}),k()?(E("visualeditor"),mw.hook("mobileFrontend.editorOpening").fire(),S.mode="visual",S.dataPromise=mw.loader.using("ext.visualEditor.targetLoader").then(function(){return l=mw.libs.ve.targetLoader.requestPageData(S.mode,S.titleObj.getPrefixedDb(),{sessionStore:!0,section:void 0===S.sectionId?null:S.sectionId,oldId:S.oldId||void 0,targetName:"mobile"})}),u=mw.loader.using("ext.visualEditor.targetLoader").then(function(){return mw.libs.ve.targetLoader.addPlugin("mobile.editor.ve"),mw.libs.ve.targetLoader.loadModules(S.mode)}).then(function(){var e=i.require("mobile.editor.overlay/VisualEditorOverlay"),t=i.require("mobile.editor.overlay/SourceEditorOverlay");return S.SourceEditorOverlay=t,new e(S)},function(){return j()})):u=j(),o.Promise.all([u,s]).then(function(e){e.getLoadingPromise().then(function(){var t=w.stack[0];t&&t.overlay===m&&w.replaceCurrent(e)},function(e){w.router.back(),e.show?e.show():mw.notify(mw.msg("mobile-frontend-editor-error-loading"))})}),m}),$("#ca-edit a").prop("href",function(e,t){var n=new mw.Uri(t);return n.query.section=0,n.toString()}),l.getPath()||!mw.util.getParamValue("veaction")&&"edit"!==mw.util.getParamValue("action")||("edit"===mw.util.getParamValue("veaction")?d="VisualEditor":"editsource"===mw.util.getParamValue("veaction")&&(d="SourceEditor"),u="#/editor/"+(mw.util.getParamValue("section")||"edit"===mw.util.getParamValue("action")&&"all"||"0"),window.history&&history.pushState?(delete(m=mw.Uri()).query.action,delete m.query.veaction,delete m.query.section,history.replaceState(null,document.title,m.toString()+u)):l.navigate(u))}function b(e,t,n,i){var o,r;!(o=mw.config.get("wgMinervaReadOnly"))&&mw.config.get("wgIsProbablyEditable")?w(e,n,t,i):(function(e){e.$el.find(".mw-editsection").hide()}(t),r=mw.config.get("wgRestrictionEdit"),mw.user.isAnon()&&Array.isArray(r)&&-1!==r.indexOf("*")?function(e){var t=new m({content:mw.msg("mobile-frontend-editor-disabled-anon"),signupQueryParams:{warning:"mobile-frontend-watchlist-signup-action"}});s.on("click",function(e){return t.show(),e.preventDefault(),t}),e.route(f,function(){t.show()}),e.checkRoute()}(i):v(o?mw.msg("apierror-readonly"):mw.msg("mobile-frontend-editor-disabled"),i))}function v(e,t){s.on("click",function(t){l.show(e),t.preventDefault()}),t.route(f,function(){l.show(e)}),t.checkRoute()}e.exports=function(e,t,n){var i=0===e.id,o=mw.loader.require("mediawiki.router"),r=o.isSupported()&&!u;"wikitext"===d&&(mw.util.getParamValue("undo")||r&&(e.inNamespace("file")&&i?v(mw.msg("mobile-frontend-editor-uploadenable"),o):b(e,t,n,o)))}},"./src/mobile.init/editorLoadingOverlay.js":function(e,t,n){var i=n("./src/mobile.init/fakeToolbar.js"),o=n("./src/mobile.startup/Overlay.js");e.exports=function(e,t){var n=i(),r=new o({className:"overlay overlay-loading",noHeader:!0,isBorderBox:!1,onBeforeExit:function(e){e(),t()}});return r.show=function(){o.prototype.show.call(this),e()},n.appendTo(r.$el.find(".overlay-content")),n.addClass("toolbar-hidden"),setTimeout(function(){n.addClass("toolbar-shown"),setTimeout(function(){n.addClass("toolbar-shown-done")},250)}),r}},"./src/mobile.init/eventLogging/schemaEditAttemptStep.js":function(e,t){e.exports=function(){var e=!!mw.util.getParamValue("trackdebug");mw.config.exists("wgWMESchemaEditAttemptStepSamplingRate")&&function(){var t=mw.eventLog.Schema,n=mw.user,i=mw.config.get("wgWMESchemaEditAttemptStepSamplingRate"),o={firstChange:"first_change",saveIntent:"save_intent",saveAttempt:"save_attempt",saveSuccess:"save_success",saveFailure:"save_failure"},r={},a=new t("EditAttemptStep",i,{page_id:mw.config.get("wgArticleId"),revision_id:mw.config.get("wgRevisionId"),page_title:mw.config.get("wgPageName"),page_ns:mw.config.get("wgNamespaceNumber"),user_id:n.getId(),user_class:n.isAnon()?"IP":void 0,user_editcount:mw.config.get("wgUserEditCount",0),mw_version:mw.config.get("wgVersion"),platform:"phone",integration:"page",page_token:n.getPageviewToken(),session_token:n.sessionId(),version:1});mw.config.get("wgMFSchemaEditAttemptStepAnonymousUserId")&&(a.defaults.anonymous_user_token=mw.config.get("wgMFSchemaEditAttemptStepAnonymousUserId")),mw.config.get("wgMFSchemaEditAttemptStepBucket")&&(a.defaults.bucket=mw.config.get("wgMFSchemaEditAttemptStepBucket")),mw.trackSubscribe("mf.schemaEditAttemptStep",function(t,n,s){var c=o[n.action]||n.action,l=0;if(s=s||this.timeStamp,"init"!==n.action&&"abort"!==n.action&&"saveFailure"!==n.action||(n[c+"_type"]=n.type),"init"!==n.action&&"abort"!==n.action||(n[c+"_mechanism"]=n.mechanism),"init"!==n.action&&(l=Math.round(function(e,t,n){if(void 0!==t.timing)return t.timing;switch(e){case"ready":case"loaded":return n-r.init;case"firstChange":case"saveIntent":return n-r.ready;case"saveAttempt":return n-r.saveIntent;case"saveSuccess":case"saveFailure":return mw.log.warn("mf.schemaEditAttemptStep: Do not rely on default timing value for saveSuccess/saveFailure"),-1;case"abort":switch(t.abort_type){case"preinit":return n-r.init;case"nochange":case"switchwith":case"switchwithout":case"switchnochange":case"abandon":return n-r.ready;case"abandonMidsave":return n-r.saveAttempt}return mw.log.warn("mf.schemaEditAttemptStep: Unrecognized abort type",t.type),-1}return mw.log.warn("mf.schemaEditAttemptStep: Unrecognized action",e),-1}(n.action,n,s)),n[c+"_timing"]=l),"saveFailure"===n.action&&(n[c+"_message"]=n.message),delete n.type,delete n.mechanism,delete n.timing,delete n.message,n.is_oversample=!mw.eventLog.inSample(1/i),"abort"===n.action&&"switchnochange"!==n.abort_type?r={}:r[n.action]=s,"switchnochange"!==n.abort_type){if(r.abort){if("ready"===n.action)return;if("loaded"===n.action)return void delete r.abort}e?function(){console.log.apply(console,arguments)}(t+"."+n.action,l+"ms",n,a.defaults):a.log(n,mw.config.get("wgWMESchemaEditAttemptStepOversample")||"all"===mw.config.get("wgMFSchemaEditAttemptStepOversample")||n.editor_interface===mw.config.get("wgMFSchemaEditAttemptStepOversample")?1:i)}})}()}},"./src/mobile.init/eventLogging/schemaMobileWebSearch.js":function(e,t,n){var i=n("./src/mobile.startup/context.js");e.exports=function(){!function(){var e=new(0,mw.eventLog.Schema)("MobileWebSearch",mw.config.get("wgMFSchemaSearchSampleRate",.001),{platform:"mobileweb",platformVersion:i.getMode()});mw.trackSubscribe("mf.schemaMobileWebSearch",function(t,n){e.log(n)})}()}},"./src/mobile.init/eventLogging/schemaVisualEditorFeatureUse.js":function(e,t){e.exports=function(){var e=!!mw.util.getParamValue("trackdebug");mw.config.exists("wgWMESchemaEditAttemptStepSamplingRate")&&function(){var t=mw.eventLog.Schema,n=mw.config.get("wgWMESchemaEditAttemptStepSamplingRate"),i=new t("VisualEditorFeatureUse",n);mw.trackSubscribe("mf.schemaVisualEditorFeatureUse",function(t,o){var r={feature:o.feature,action:o.action,editingSessionId:o.editing_session_id};e?function(){console.log.apply(console,arguments)}(t,r):i.log(r,mw.config.get("wgWMESchemaEditAttemptStepOversample")||"visualeditor"===mw.config.get("wgMFSchemaEditAttemptStepOversample")||"all"===mw.config.get("wgMFSchemaEditAttemptStepOversample")?1:n)})}()}},"./src/mobile.init/mobile.init.js":function(e,t,n){var i,o=mw.storage,r=n("./src/mobile.init/toggling.js"),a=mw.config.get("skin"),s=mw.config.get("wgMFIsPageContentModelEditable"),c=n("./src/mobile.init/editor.js"),l=n("./src/mobile.startup/currentPage.js")(),m=n("./src/mobile.startup/currentPageHTMLParser.js")(),u=n("./src/mobile.init/BetaOptInPanel.js"),d=mw.util,g=n("./src/mobile.startup/util.js"),p=g.getWindow(),f=g.getDocument(),w=mw.user,b=n("./src/mobile.startup/context.js"),v=mw.experiments,h=mw.config.get("wgMFExperiments")||{},S=n("./src/mobile.startup/Skin.js"),y=n("./src/mobile.startup/eventBusSingleton.js"),E=n("./src/mobile.init/eventLogging/schemaMobileWebSearch.js"),k=n("./src/mobile.init/eventLogging/schemaEditAttemptStep.js"),j=n("./src/mobile.init/eventLogging/schemaVisualEditorFeatureUse.js");function M(e,t){return function(){return[e.apply(this,arguments),t.apply(this,arguments)]}}function P(){var e=o.get("userFontSize","regular");f.addClass("mf-font-size-"+e)}i=S.getSingleton(),p.on("resize",M($.debounce(100,function(){y.emit("resize")}),$.throttle(200,function(){y.emit("resize:throttled")}))).on("scroll",M($.debounce(100,function(){y.emit("scroll")}),$.throttle(200,function(){y.emit("scroll:throttled")}))),p.on("pageshow",function(){P()}),P(),h.betaoptin&&function(e,t,n){var i,r,a,s=o.get("mobile-betaoptin-token");!1===s||"~"===s||t.isMainPage()||t.inNamespace("special")||(s||(s=w.generateRandomSessionId(),o.set("mobile-betaoptin-token",s)),r="stable"===b.getMode(),a="A"===v.getBucket(e,s),r&&(a||d.getParamValue("debug"))&&(i=new u({postUrl:d.getUrl("Special:MobileOptions",{returnto:t.title}),onCancel:function(e){e.preventDefault(),o.set("mobile-betaoptin-token","~"),this.remove()}})).appendTo(n.getLeadSectionElement()),mw.track("mobile.betaoptin",{isPanelShown:void 0!==i}))}(h.betaoptin,l,m),window.console&&window.console.log&&window.console.log.apply&&mw.config.get("wgMFEnableJSConsoleRecruitment")&&console.log(mw.msg("mobile-frontend-console-recruit")),!l.inNamespace("special")&&s&&"minerva"===a&&null!==b.getMode()&&c(l,m,i),r(),mw.mobileFrontend.deprecate("mobile.init/skin",i,"instance of mobile.startup/Skin. Minerva should have no dependencies on mobile.init"),mw.loader.using("ext.eventLogging").then(function(){E(),k(),j()})},"./src/mobile.init/toggling.js":function(e,t,n){e.exports=function(){var e=$("#mw-content-text > .mw-parser-output"),t=n("./src/mobile.startup/currentPage.js")(),i=n("./src/mobile.startup/Toggler.js"),o=n("./src/mobile.startup/eventBusSingleton.js");0===e.length&&(e=$("#mw-content-text")),t.inNamespace("special")||"view"!==mw.config.get("wgAction")||function(e,t,n){e.find("> h1,> h2,> h3,> h4,> h5,> h6").addClass("section-heading").removeAttr("onclick"),void 0!==window.mfTempOpenSection&&delete window.mfTempOpenSection,new i({$container:e,prefix:t,page:n,eventBus:o})}(e,"content-",t)}}},[["./src/mobile.init/mobile.init.js",0,1]]]);
//# sourceMappingURL=mobile.init.js.map.json