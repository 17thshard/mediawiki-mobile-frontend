this.mfModules=this.mfModules||{},this.mfModules["mobile.init"]=(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./src/mobile.init/editor.js":function(e,t,i){var n=i("./src/mobile.startup/moduleLoaderSingleton.js"),o=i("./src/mobile.startup/util.js"),a=i("./src/mobile.init/editorLoadingOverlay.js"),r=i("./src/mobile.startup/OverlayManager.js"),s=$("#ca-edit, .mw-editsection a, .edit-link"),c=mw.user,m=i("./src/mobile.startup/toast.js"),l=i("./src/mobile.startup/CtaDrawer.js"),g=/MSIE \d\./.test(navigator.userAgent),u=mw.config.get("wgPageContentModel"),d=mw.config.get("wgVisualEditorConfig"),w=mw.config.get("wgUserEditCount"),p=/^\/editor\/(\d+|all)$/;function f(e,t,i,m){var l,g,u,f=r.getSingleton(),h=0===e.id;s.on("click",function(e){!function(e,t,i){var n;n=1===s.length?"all":mw.util.getParamValue("section",e.href)||"all",i.navigate("#/editor/"+n),t.preventDefault()}(this,e,f.router)}),f.add(p,function(r){var s,m,l,g,p=window.innerWidth-document.documentElement.clientWidth,v=window.pageYOffset,b=$("#mw-content-text"),S={overlayManager:f,currentPageHTMLParser:i,fakeScroll:0,api:new mw.Api,licenseMsg:t.getLicenseMsg(),title:e.title,titleObj:e.titleObj,isAnon:c.isAnon(),isNewPage:h,editCount:w,oldId:mw.util.getParamValue("oldid"),contentLang:b.attr("lang"),contentDir:b.attr("dir"),sessionId:mw.config.get("wgWMESchemaEditAttemptStepSessionId")||mw.Uri().query.editingStatsId||c.generateRandomSessionId()},E=mw.util.getParamValue("redlink")?"new":"click";function y(e){mw.track("mf.schemaEditAttemptStep",{action:"init",type:"section",mechanism:E,editor_interface:e,editing_session_id:S.sessionId})}function M(){var t=!!d,i=function(){var e,t,i=mw.storage.get("preferredEditor");if(i)return i;switch(e=mw.config.get("wgMFDefaultEditor"),(t=mw.storage.getObject("MFDefaultEditorABToken"))&&t.expires<Date.now()&&(mw.storage.remove("MFDefaultEditorABToken"),t=null),"abtest"===e&&(mw.user.isAnon()?(t||(t={token:mw.user.generateRandomSessionId(),expires:Date.now()+7776e6},mw.storage.setObject("MFDefaultEditorABToken",t)),mw.config.set("wgMFSchemaEditAttemptStepAnonymousUserId",t.token),e=parseInt(t.token.slice(0,8),16)%2==0?"source":"visual",mw.config.set("wgMFSchemaEditAttemptStepBucket","default-"+e)):mw.config.get("wgUserEditCount")<=100?(e=mw.user.getId()%2==0?"source":"visual",mw.config.set("wgMFSchemaEditAttemptStepBucket","default-"+e)):e="source"),e){case"source":return"SourceEditor";case"visual":return"VisualEditor";case"preference":return"visualeditor"===mw.user.options.get("visualeditor-editor")?"VisualEditor":"SourceEditor"}return"SourceEditor"}(),n=d&&d.namespaces||[];return t&&e.isWikiText()&&-1!==n.indexOf(mw.config.get("wgNamespaceNumber"))&&"translation"!==mw.config.get("wgTranslatePageTranslation")&&("VisualEditor"===i||"VisualEditor"===u)&&"SourceEditor"!==u}function k(){return y("wikitext"),mw.hook("mobileFrontend.editorOpening").fire(),mw.loader.using("mobile.editor.overlay").then(function(){return new(n.require("mobile.editor.overlay/SourceEditorOverlay"))(S)})}return"all"!==r&&(S.sectionId=e.isWikiText()?+r:null),s=o.Deferred(),l=a(function(){var e,t,i,n,o;$(document.body).addClass("ve-loading"),e=$("#mw-mf-page-center"),t=$("#content"),"0"===r||"all"===r?i=$("#bodyContent"):(i=$('[data-section="'+r+'"]').closest("h1, h2, h3, h4, h5, h6")).length||(i=$("#bodyContent")),e.css({"padding-right":"+="+p,"box-sizing":"border-box"}),e.prop("scrollTop",v),n=i[0].getBoundingClientRect().top,n-=48,M()?(o=!0===d.enableVisualSectionEditing||"mobile"===d.enableVisualSectionEditing,("0"===r||"all"===r||o)&&(n-=16)):"0"!==r&&"all"!==r||(n-=16),t.css({transform:"translate( 0, "+-n+"px )","padding-bottom":"+="+n,"margin-bottom":"-="+n}),S.fakeScroll=n,setTimeout(s.resolve,500)},function(){m&&m.abort&&m.abort(),$("#content").css({transform:"","padding-bottom":"","margin-bottom":""}),$("#mw-mf-page-center").css({"padding-right":"","box-sizing":""}),$(document.body).removeClass("ve-loading")}),M()?(y("visualeditor"),mw.hook("mobileFrontend.editorOpening").fire(),S.mode="visual",S.dataPromise=mw.loader.using("ext.visualEditor.targetLoader").then(function(){return m=mw.libs.ve.targetLoader.requestPageData(S.mode,S.titleObj.getPrefixedDb(),{sessionStore:!0,section:void 0===S.sectionId?null:S.sectionId,oldId:S.oldId||void 0,targetName:"mobile"})}),g=mw.loader.using("ext.visualEditor.targetLoader").then(function(){return mw.libs.ve.targetLoader.addPlugin("mobile.editor.ve"),mw.libs.ve.targetLoader.loadModules(S.mode)}).then(function(){var e=n.require("mobile.editor.overlay/VisualEditorOverlay"),t=n.require("mobile.editor.overlay/SourceEditorOverlay");return S.SourceEditorOverlay=t,new e(S)},function(){return k()})):g=k(),o.Promise.all([g,s]).then(function(e){e.getLoadingPromise().then(function(){var t=f.stack[0];t&&t.overlay===l&&f.replaceCurrent(e)},function(e){f.router.back(),e.show?e.show():mw.notify(mw.msg("mobile-frontend-editor-error-loading"))})}),l}),$("#ca-edit a").prop("href",function(e,t){var i=new mw.Uri(t);return i.query.section=0,i.toString()}),m.getPath()||!mw.util.getParamValue("veaction")&&"edit"!==mw.util.getParamValue("action")||("edit"===mw.util.getParamValue("veaction")?u="VisualEditor":"editsource"===mw.util.getParamValue("veaction")&&(u="SourceEditor"),g="#/editor/"+(mw.util.getParamValue("section")||"edit"===mw.util.getParamValue("action")&&"all"||"0"),window.history&&history.pushState?(delete(l=mw.Uri()).query.action,delete l.query.veaction,delete l.query.section,history.replaceState(null,document.title,l.toString()+g)):m.navigate(g))}function h(e,t,i,n){var o,a;!(o=mw.config.get("wgMinervaReadOnly"))&&mw.config.get("wgIsProbablyEditable")?f(e,i,t,n):(function(e){e.$el.find(".mw-editsection").hide()}(t),a=mw.config.get("wgRestrictionEdit"),mw.user.isAnon()&&Array.isArray(a)&&-1!==a.indexOf("*")?function(e){var t=new l({content:mw.msg("mobile-frontend-editor-disabled-anon"),signupQueryParams:{warning:"mobile-frontend-watchlist-signup-action"}});s.on("click",function(e){return t.show(),e.preventDefault(),t}),e.route(p,function(){t.show()}),e.checkRoute()}(n):v(o?mw.msg("apierror-readonly"):mw.msg("mobile-frontend-editor-disabled"),n))}function v(e,t){s.on("click",function(t){m.show(e),t.preventDefault()}),t.route(p,function(){m.show(e)}),t.checkRoute()}e.exports=function(e,t,i){var n=0===e.id,o=mw.loader.require("mediawiki.router"),a=o.isSupported()&&!g;"wikitext"===u&&(mw.util.getParamValue("undo")||a&&(e.inNamespace("file")&&n?v(mw.msg("mobile-frontend-editor-uploadenable"),o):h(e,t,i,o)))}},"./src/mobile.init/editorLoadingOverlay.js":function(e,t,i){var n=i("./src/mobile.init/fakeToolbar.js"),o=i("./src/mobile.startup/Overlay.js");e.exports=function(e,t){var i=n(),a=new o({className:"overlay overlay-loading",noHeader:!0,isBorderBox:!1,onBeforeExit:function(e){e(),t()}});return a.show=function(){o.prototype.show.call(this),e()},i.appendTo(a.$el.find(".overlay-content")),i.addClass("toolbar-hidden"),setTimeout(function(){i.addClass("toolbar-shown"),setTimeout(function(){i.addClass("toolbar-shown-done")},250)}),a}},"./src/mobile.init/eventLogging/schemaEditAttemptStep.js":function(e,t){e.exports=function(){var e=!!mw.util.getParamValue("trackdebug");mw.config.exists("wgWMESchemaEditAttemptStepSamplingRate")&&function(){var t=mw.eventLog.Schema,i=mw.user,n=mw.config.get("wgWMESchemaEditAttemptStepSamplingRate"),o={firstChange:"first_change",saveIntent:"save_intent",saveAttempt:"save_attempt",saveSuccess:"save_success",saveFailure:"save_failure"},a={},r=new t("EditAttemptStep",n,{page_id:mw.config.get("wgArticleId"),revision_id:mw.config.get("wgRevisionId"),page_title:mw.config.get("wgPageName"),page_ns:mw.config.get("wgNamespaceNumber"),user_id:i.getId(),user_class:i.isAnon()?"IP":void 0,user_editcount:mw.config.get("wgUserEditCount",0),mw_version:mw.config.get("wgVersion"),platform:"phone",integration:"page",page_token:i.getPageviewToken(),session_token:i.sessionId(),version:1});mw.trackSubscribe("mf.schemaEditAttemptStep",function(t,i,s){var c=o[i.action]||i.action,m=0;if(mw.storage.get("preferredEditor")||(mw.config.get("wgMFSchemaEditAttemptStepAnonymousUserId")&&(i.anonymous_user_token=mw.config.get("wgMFSchemaEditAttemptStepAnonymousUserId")),mw.config.get("wgMFSchemaEditAttemptStepBucket")&&(i.bucket=mw.config.get("wgMFSchemaEditAttemptStepBucket"))),s=s||this.timeStamp,"init"!==i.action&&"abort"!==i.action&&"saveFailure"!==i.action||(i[c+"_type"]=i.type),"init"!==i.action&&"abort"!==i.action||(i[c+"_mechanism"]=i.mechanism),"init"!==i.action&&(m=Math.round(function(e,t,i){if(void 0!==t.timing)return t.timing;switch(e){case"ready":case"loaded":return i-a.init;case"firstChange":case"saveIntent":return i-a.ready;case"saveAttempt":return i-a.saveIntent;case"saveSuccess":case"saveFailure":return mw.log.warn("mf.schemaEditAttemptStep: Do not rely on default timing value for saveSuccess/saveFailure"),-1;case"abort":switch(t.abort_type){case"preinit":return i-a.init;case"nochange":case"switchwith":case"switchwithout":case"switchnochange":case"abandon":return i-a.ready;case"abandonMidsave":return i-a.saveAttempt}return mw.log.warn("mf.schemaEditAttemptStep: Unrecognized abort type",t.type),-1}return mw.log.warn("mf.schemaEditAttemptStep: Unrecognized action",e),-1}(i.action,i,s)),i[c+"_timing"]=m),"saveFailure"===i.action&&(i[c+"_message"]=i.message),delete i.type,delete i.mechanism,delete i.timing,delete i.message,i.is_oversample=!mw.eventLog.inSample(1/n),"abort"===i.action&&"switchnochange"!==i.abort_type?a={}:a[i.action]=s,"switchnochange"!==i.abort_type){if(a.abort){if("ready"===i.action)return;if("loaded"===i.action)return void delete a.abort}e?function(){console.log.apply(console,arguments)}(t+"."+i.action,m+"ms",i,r.defaults):r.log(i,mw.config.get("wgWMESchemaEditAttemptStepOversample")||"all"===mw.config.get("wgMFSchemaEditAttemptStepOversample")||i.editor_interface===mw.config.get("wgMFSchemaEditAttemptStepOversample")?1:n)}})}()}},"./src/mobile.init/eventLogging/schemaMobileWebSearch.js":function(e,t){e.exports=function(){!function(){var e=new(0,mw.eventLog.Schema)("MobileWebSearch",mw.config.get("wgMFSchemaSearchSampleRate",.001),{platform:"mobileweb",platformVersion:mw.config.get("wgMFMode")});mw.trackSubscribe("mf.schemaMobileWebSearch",function(t,i){e.log(i)})}()}},"./src/mobile.init/eventLogging/schemaVisualEditorFeatureUse.js":function(e,t){e.exports=function(){var e=!!mw.util.getParamValue("trackdebug");mw.config.exists("wgWMESchemaEditAttemptStepSamplingRate")&&function(){var t=mw.eventLog.Schema,i=mw.config.get("wgWMESchemaEditAttemptStepSamplingRate"),n=new t("VisualEditorFeatureUse",i);mw.trackSubscribe("mf.schemaVisualEditorFeatureUse",function(t,o){var a={feature:o.feature,action:o.action,editingSessionId:o.editing_session_id};e?function(){console.log.apply(console,arguments)}(t,a):n.log(a,mw.config.get("wgWMESchemaEditAttemptStepOversample")||"visualeditor"===mw.config.get("wgMFSchemaEditAttemptStepOversample")||"all"===mw.config.get("wgMFSchemaEditAttemptStepOversample")?1:i)})}()}},"./src/mobile.init/mobile.init.js":function(e,t,i){var n,o=mw.storage,a=i("./src/mobile.init/toggling.js"),r=mw.config.get("skin"),s=mw.config.get("wgMFIsPageContentModelEditable"),c=i("./src/mobile.init/editor.js"),m=i("./src/mobile.startup/currentPage.js")(),l=i("./src/mobile.startup/currentPageHTMLParser.js")(),g=i("./src/mobile.startup/util.js"),u=g.getWindow(),d=g.getDocument(),w=i("./src/mobile.startup/Skin.js"),p=i("./src/mobile.startup/eventBusSingleton.js"),f=i("./src/mobile.init/eventLogging/schemaMobileWebSearch.js"),h=i("./src/mobile.init/eventLogging/schemaEditAttemptStep.js"),v=i("./src/mobile.init/eventLogging/schemaVisualEditorFeatureUse.js");function b(e,t){return function(){return[e.apply(this,arguments),t.apply(this,arguments)]}}function S(){var e=o.get("userFontSize","regular");d.addClass("mf-font-size-"+e)}n=w.getSingleton(),u.on("resize",b(mw.util.debounce(100,function(){p.emit("resize")}),$.throttle(200,function(){p.emit("resize:throttled")}))).on("scroll",b(mw.util.debounce(100,function(){p.emit("scroll")}),$.throttle(200,function(){p.emit("scroll:throttled")}))),u.on("pageshow",function(){S()}),S(),window.console&&window.console.log&&window.console.log.apply&&mw.config.get("wgMFEnableJSConsoleRecruitment")&&console.log(mw.msg("mobile-frontend-console-recruit")),!m.inNamespace("special")&&s&&"minerva"===r&&null!==mw.config.get("wgMFMode")&&c(m,l,n),a(),mw.mobileFrontend.deprecate("mobile.init/skin",n,"instance of mobile.startup/Skin. Minerva should have no dependencies on mobile.init"),mw.loader.using("ext.eventLogging").then(function(){f(),h(),v()})},"./src/mobile.init/toggling.js":function(e,t,i){e.exports=function(){var e=$("#mw-content-text > .mw-parser-output"),t=i("./src/mobile.startup/currentPage.js")(),n=i("./src/mobile.startup/Toggler.js"),o=i("./src/mobile.startup/eventBusSingleton.js");0===e.length&&(e=$("#mw-content-text")),t.inNamespace("special")||"view"!==mw.config.get("wgAction")||function(e,t,i){e.find("> h1,> h2,> h3,> h4,> h5,> h6").addClass("section-heading").removeAttr("onclick"),void 0!==window.mfTempOpenSection&&delete window.mfTempOpenSection,new n({$container:e,prefix:t,page:i,eventBus:o})}(e,"content-",t)}}},[["./src/mobile.init/mobile.init.js",0,1]]]);
//# sourceMappingURL=mobile.init.js.map.json