this.mfModules=this.mfModules||{},this.mfModules["mobile.categories.overlays"]=(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"./src/mobile.categories.overlays/CategoryAddOverlay.js":function(e,t,i){var s=i("./src/mobile.startup/Overlay.js"),a=i("./src/mobile.editor.overlay/EditorOverlayBase.js"),n=i("./src/mobile.startup/mfExtend.js"),o=i("./src/mobile.startup/util.js"),r=i("./src/mobile.categories.overlays/CategoryGateway.js"),l=i("./src/mobile.categories.overlays/CategoryLookupInputWidget.js"),c=i("./src/mobile.startup/icons.js"),d=i("./src/mobile.startup/toast.js"),g=mw.loader.require("mediawiki.router");function u(e){e.heading=mw.msg("mobile-frontend-categories-add-heading",e.title),this.eventBus=e.eventBus,s.call(this,o.extend(!0,{className:"category-overlay overlay",events:{"click .save":"onSaveClick","click .suggestion":"onCategoryClick"}},e))}n(u,s,{defaults:o.extend({},s.prototype.defaults,{waitMsg:mw.msg("mobile-frontend-categories-add-wait"),waitIcon:c.spinner().toHtmlString()}),template:o.template('\n<div class="overlay-header-container header-container position-fixed">\n\t{{>header}}\n\t{{>saveHeader}}\n</div>\n\n<div class="content-header panel add-panel">\n\t<div class="category-add-input"></div>\n</div>\n<p class="overlay-content category-suggestions panel"></p>\n\t'),templatePartials:o.extend({},s.prototype.templatePartials,{header:o.template('\n<div class="overlay-header initial-header hideable">\n\t<ul>\n\t\t<li>{{{backButton}}}</li>\n\t</ul>\n\t<div class="overlay-title">\n\t\t{{{heading}}}\n\t</div>\n\t<div class="header-action"><button class="save submit" disabled>{{saveMsg}}</button></div>\n</div>\n\t\t'),saveHeader:a.prototype.templatePartials.saveHeader}),postRender:function(){var e;s.prototype.postRender.apply(this),this.$suggestions=this.$el.find(".category-suggestions"),this.$saveButton=this.$el.find(".save"),this.wgCategories=this.options.categories,this.title=this.options.title,this.gateway=new r(this.options.api),e=new l({gateway:this.gateway,suggestions:this.$suggestions,categories:this.wgCategories,saveButton:this.$saveButton}),this.$el.find(".category-add-input").append(e.$element)},onCategoryClick:function(e){this.$el.find(e.target).closest(".suggestion").detach(),this.$el.find(".suggestion").length>0?this.$saveButton.prop("disabled",!1):this.$saveButton.prop("disabled",!0)},onSaveClick:function(){var e="",t=this;this.showHidden(".saving-header"),this.$el.find(".suggestion").each(function(){var i=t.$el.find(this).data("title");i&&(e+="\n[["+i+"]] ")}),0===e.length?d.show(mw.msg("mobile-frontend-categories-nodata"),{type:"error"}):this.gateway.save(this.title,e).then(function(){g.navigate("#"),mw.notify(mw.msg("mobile-frontend-categories-notification"))},function(){t.showHidden(".initial-header"),t.$safeButton.prop("disabled",!1),d.show(mw.msg("mobile-frontend-categories-nodata"),{type:"error"})})}}),e.exports=u},"./src/mobile.categories.overlays/CategoryGateway.js":function(e,t,i){var s,a=i("./src/mobile.startup/actionParams.js"),n=i("./src/mobile.startup/util.js"),o=i("./src/mobile.startup/search/SearchGateway.js");function r(){r.parent.apply(this,arguments)}s={continueParams:{},canContinue:!0,searchNamespace:14,save:function(e,t){return this.api.postWithToken("csrf",{action:"edit",title:e,appendtext:t,summary:mw.msg("mobile-frontend-categories-summary")})},getCategories:function(e){var t,i=this;return!1!==this.canContinue&&(t=n.extend({},{prop:"categories",titles:e,clprop:"hidden",cllimit:50},this.continueParams),this.api.get(a(t)).then(function(e){return void 0!==e.continue?i.continueParams=e.continue:i.canContinue=!1,e}))}},OO.inheritClass(r,o),n.extend(r.prototype,s),e.exports=r},"./src/mobile.categories.overlays/CategoryLookupInputWidget.js":function(e,t){function i(e){this.gateway=e.gateway,this.$suggestions=e.suggestions,this.categories=e.categories||[],this.$saveButton=e.saveButton,e.placeholder=mw.msg("mobile-frontend-categories-search"),OO.ui.TextInputWidget.call(this,e),OO.ui.mixin.LookupElement.call(this,e)}OO.inheritClass(i,OO.ui.TextInputWidget),OO.mixinClass(i,OO.ui.mixin.LookupElement),i.prototype.onLookupMenuItemChoose=function(e){var t=new OO.ui.ButtonWidget({icon:"check",label:e.label,classes:["suggestion","suggested"],flags:["progressive","primary"]});t.$element.attr("data-title",e.data),this.$suggestions.append(t.$element),this.$saveButton.prop("disabled",!1)},i.prototype.getLookupRequest=function(){return this.gateway.search(this.value)},i.prototype.getLookupCacheDataFromResponse=function(e){var t=new mw.Title(this.value,14);return e.results.unshift({title:t.toString(),displayTitle:t.getMainText()}),e},i.prototype.getLookupMenuOptionsFromData=function(e){var t=[],i=this.$element,s=this;return e.results.forEach(function(e){i.find('div[data-title="'+e.title+'"]').length||-1!==s.categories.indexOf(e.displayTitle)||t.push(new OO.ui.MenuOptionWidget({data:e.title,label:e.displayTitle}))}),t},e.exports=i},"./src/mobile.categories.overlays/CategoryTabs.js":function(e,t,i){var s=i("./src/mobile.startup/mfExtend.js"),a=i("./src/mobile.startup/util.js"),n=i("./src/mobile.startup/View.js"),o=i("./src/mobile.startup/ScrollEndEventEmitter.js"),r=i("./src/mobile.categories.overlays/CategoryGateway.js");function l(e){this.scrollEndEventEmitter=new o(e.eventBus),this.scrollEndEventEmitter.on(o.EVENT_SCROLL_END,this._loadCategories.bind(this)),this.gateway=new r(e.api),n.call(this,a.extend(!0,{events:{"click .catlink":"onCatlinkClick"}},e))}s(l,n,{isTemplateMode:!0,defaults:{normalcatlink:mw.msg("mobile-frontend-categories-normal"),hiddencatlink:mw.msg("mobile-frontend-categories-hidden")},template:a.template('\n<div class="category-list">\n\t<p class="content-header">\n\t\t{{subheading}}\n\t</p>\n\t<ul class="category-header">\n\t\t<li class="selected">\n\t\t\t<a href="#" class="catlink">{{normalcatlink}}</a>\n\t\t</li><li>\n\t\t\t<a href="#" class="catlink">{{hiddencatlink}}</a>\n\t\t</li>\n\t</ul>\n\t<ul class="topic-title-list normal-catlist"></ul>\n\t<ul class="topic-title-list hidden hidden-catlist"></ul>\n</div>\n{{{spinner}}}\n\t'),templatePartials:{item:a.template('\n<li title="{{title}}">\n    <a href="{{url}}">{{title}}</a>\n</li>\n\t\t')},postRender:function(){n.prototype.postRender.apply(this),this._loadCategories()},hideSpinner:function(){this.$el.find(".spinner").hide()},showSpinner:function(){this.$el.find(".spinner").show()},_loadCategories:function(){var e,t=this,i=this.$el.find(".normal-catlist"),s=this.$el.find(".hidden-catlist");this.scrollEndEventEmitter.setElement(this.$el),this.scrollEndEventEmitter.disable(),!1!==(e=this.gateway.getCategories(this.options.title))?e.then(function(e){e.query&&e.query.pages?(e.query.pages.forEach(function(e){e.categories&&e.categories.forEach(function(e){var a=mw.Title.newFromText(e.title,e.ns);e.hidden?s.append(t.templatePartials.item.render({url:a.getUrl(),title:a.getMainText()})):i.append(t.templatePartials.item.render({url:a.getUrl(),title:a.getMainText()}))})}),0===i.length&&0===i.length?t.$el.find(".content-header").text(mw.msg("mobile-frontend-categories-nocat")):0===i.length&&i.length>0&&this._changeView()):t.$el.find(".content-header").text(mw.msg("mobile-frontend-categories-nocat")),t.hideSpinner(),t.scrollEndEventEmitter.enable()}):t.hideSpinner()},onCatlinkClick:function(e){e.preventDefault(),this.$el.find(e.target).parent().hasClass("selected")||this._changeView()},_changeView:function(){this.$el.find(".category-header li").toggleClass("selected"),this.$el.find(".topic-title-list").toggleClass("hidden")}}),e.exports=l},"./src/mobile.categories.overlays/categoryOverlay.js":function(e,t,i){var s=i("./src/mobile.startup/Overlay.js"),a=i("./src/mobile.categories.overlays/CategoryTabs.js");e.exports=function(e){var t,i,n=e.isAnon?[]:[{href:"#/categories/add",className:"add continue",msg:mw.msg("mobile-frontend-categories-add")}];return t=new s({className:"category-overlay overlay",heading:mw.msg("mobile-frontend-categories-heading"),headerButtons:n}),i=new a({eventBus:e.eventBus,api:e.api,title:e.title,subheading:mw.msg("mobile-frontend-categories-subheading")}),t.$el.find(".overlay-content").append(i.$el),t}},"./src/mobile.categories.overlays/mobile.categories.overlays.js":function(e,t,i){var s=i("./src/mobile.startup/moduleLoaderSingleton.js"),a=i("./src/mobile.categories.overlays/CategoryAddOverlay.js"),n=i("./src/mobile.categories.overlays/categoryOverlay.js");s.define("mobile.categories.overlays/CategoryAddOverlay",a),s.define("mobile.categories.overlays/categoryOverlay",n)}},[["./src/mobile.categories.overlays/mobile.categories.overlays.js",0,1]]]);
//# sourceMappingURL=mobile.categories.overlays.js.map.json