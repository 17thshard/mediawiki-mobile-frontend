this.mfModules=this.mfModules||{},this.mfModules["mobile.talk.overlays"]=(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./src/mobile.talk.overlays/AddTopicForm.js":function(e,t,s){var i=s("./src/mobile.startup/mfExtend.js"),o=s("./src/mobile.startup/View.js"),n=s("./src/mobile.startup/util.js");function a(e){var t=new o({className:"panel"});return t.$el.append(e),t}function r(e){o.call(this,n.extend(e,{topicTitlePlaceHolder:mw.msg("mobile-frontend-talk-add-overlay-subject-placeholder"),topicContentPlaceHolder:mw.msg("mobile-frontend-talk-add-overlay-content-placeholder"),className:"add-topic-form",events:{"input .wikitext-editor, input":"onTextInput","change .wikitext-editor, input":"onTextInput"}}))}i(r,o,{postRender:function(){var e=this.options,t=e.disabled,s=n.parseHTML("<input>").attr({class:"mw-ui-input",type:"text",disabled:t,value:e.subject,placeholder:e.topicTitlePlaceHolder}),i=n.parseHTML("<textarea>").attr({class:"wikitext-editor mw-ui-input",cols:40,rows:10,disabled:t,placeholder:e.topicContentPlaceHolder}).val(e.body),r=[a(n.parseHTML("<p>").addClass("license").html(e.licenseMsg)),a(s),a(i)];this.$el.append(r.map(function(e){return e.$el})),this.$subject=s,this.$messageBody=i,o.prototype.postRender.apply(this,arguments)},onTextInput:function(){this.options.onTextInput&&this.options.onTextInput(this.$subject.val().trim(),this.$messageBody.val().trim())}}),r.test={makePanel:a},e.exports=r},"./src/mobile.talk.overlays/TalkSectionAddOverlay.js":function(e,t,s){var i=s("./src/mobile.startup/mfExtend.js"),o=s("./src/mobile.startup/headers.js"),n=s("./src/mobile.startup/Overlay.js"),a=s("./src/mobile.startup/PageGateway.js"),r=s("./src/mobile.startup/util.js"),l=s("./src/mobile.talk.overlays/makeAddTopicForm.js"),c=s("./src/mobile.startup/toast.js");function d(e){this.editorApi=e.api,this.pageGateway=new a(e.api),n.call(this,r.extend(e,{className:"talk-overlay overlay",onBeforeExit:this.onBeforeExit.bind(this),events:{"click .save":"onSaveClick"}})),this.onSaveComplete=e.onSaveComplete,this.title=e.title,this.currentPageTitle=e.currentPageTitle,this.eventBus=e.eventBus,this._saveHit=!1}i(d,n,{preRender:function(){this.options.headers=[o.saveHeader(mw.msg("mobile-frontend-talk-add-overlay-submit"),"initial-header save-header"),o.savingHeader(mw.msg("mobile-frontend-talk-topic-wait"))]},postRender:function(){var e;n.prototype.postRender.call(this),e=l({subject:"",body:"",disabled:!1,licenseMsg:this.options.licenseMsg,onTextInput:this.onTextInput.bind(this)}),this.showHidden(".initial-header"),this.$confirm=this.$el.find("button.save"),this.$el.find(".overlay-content").append(e.$el),this.$subject=e.$el.find("input"),this.$ta=e.$el.find(".wikitext-editor")},onBeforeExit:function(e){var t,s=mw.msg("mobile-frontend-editor-cancel-confirm");t=!this.$subject.val()&&!this.$ta.val(),(this._saveHit||t||window.confirm(s))&&e()},onTextInput:function(e,t){this.subject=e,this.body=t,clearTimeout(this.timer),this.timer=setTimeout(function(){t&&e?this.$confirm.prop("disabled",!1):this.$confirm.prop("disabled",!0)}.bind(this),250)},onSaveClick:function(){var e=this.title===this.currentPageTitle;this.showHidden(".saving-header"),this.save().then(function(t){"ok"===t&&(e?this.eventBus.emit("talk-added-wo-overlay"):this.onSaveComplete())}.bind(this),function(e){var t=mw.msg("mobile-frontend-talk-topic-error");switch(this.$confirm.prop("disabled",!1),e.details){case"protectedpage":t=mw.msg("mobile-frontend-talk-topic-error-protected");break;case"noedit":case"blocked":t=mw.msg("mobile-frontend-talk-topic-error-permission");break;case"spamdetected":t=mw.msg("mobile-frontend-talk-topic-error-spam");break;case"badtoken":t=mw.msg("mobile-frontend-talk-topic-error-badtoken");break;default:t=mw.msg("mobile-frontend-talk-topic-error")}c.show(t,{type:"error"}),this.showHidden(".save-header, .save-panel")}.bind(this))},save:function(){var e=this.subject,t=r.Deferred();return this.$ta.removeClass("error"),this.$subject.removeClass("error"),this._saveHit=!0,this.$el.find(".content").empty().addClass("loading"),this.editorApi.postWithToken("csrf",{action:"edit",section:"new",sectiontitle:e,title:this.title,summary:mw.msg("newsectionsummary",e),text:this.body}).then(function(){return"ok"},function(e){return t.reject({type:"error",details:e})})}}),e.exports=d},"./src/mobile.talk.overlays/TalkSectionOverlay.js":function(e,t,s){var i=mw.user,o=s("./src/mobile.startup/icons.js"),n=o.spinner().$el,a=s("./src/mobile.startup/mfExtend.js"),r=s("./src/mobile.startup/PageGateway.js"),l=s("./src/mobile.startup/Overlay.js"),c=s("./src/mobile.startup/headers.js").header,d=s("./src/mobile.startup/util.js"),p=s("./src/mobile.startup/toast.js"),m=s("./src/mobile.talk.overlays/autosign.js"),u=s("./src/mobile.startup/Page.js"),h=s("./src/mobile.startup/Button.js");function v(e){this.editorApi=e.api,this.pageGateway=new r(e.api),l.call(this,d.extend(!0,e,{className:"talk-overlay overlay",events:{"focus textarea":"onFocusTextarea","click .save-button":"onSaveClick"}}))}a(v,l,{templatePartials:d.extend({},l.prototype.templatePartials,{content:d.template('\n<div class="content talk-section">\n\t{{{section.text}}}\n\t<div class="comment">\n\t\t<div class="list-header">{{reply}}</div>\n\t\t<div class="comment-content">\n\t\t\t<textarea class="wikitext-editor"></textarea>\n\t\t\t<p class="license">\n\t\t\t\t{{info}}\n\t\t\t\t{{{licenseMsg}}}\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</div>\n\t\t')}),defaults:d.extend({},l.prototype.defaults,{saveButton:new h({block:!0,additionalClassNames:"save-button",progressive:!0,label:d.saveButtonMessage()}),title:void 0,section:void 0,reply:mw.msg("mobile-frontend-talk-reply"),info:mw.msg("mobile-frontend-talk-reply-info")}),preRender:function(){var e=this.options;this.options.headers=[c(e.section?e.section.line:"",[],o.back(),"initial-header")]},postRender:function(){l.prototype.postRender.apply(this),this.$el.find(".talk-section").prepend(n),this.$saveButton=this.options.saveButton.$el,this.$el.find(".comment-content").append(this.$saveButton),this.options.section?(this.hideSpinner(),this._enableComments()):this.renderFromApi(this.options)},_enableComments:function(){this.$commentBox=this.$el.find(".comment"),i.isAnon()?this.$commentBox.remove():this.$textarea=this.$commentBox.find("textarea")},renderFromApi:function(e){var t=this;this.pageGateway.getPage(e.title).then(function(s){var i=new u(s);e.section=i.getSection(e.id),t.render(e),t.hideSpinner()})},onFocusTextarea:function(){this.$textarea.removeClass("error")},onSaveClick:function(){var e=this.$textarea.val(),t=this;function s(){t.$saveButton.prop("disabled",!1)}e?(this.showSpinner(),this.$saveButton.prop("disabled",!0),e="\n\n"+m(e),this.editorApi.postWithToken("csrf",{action:"edit",title:this.options.title,section:this.options.id,appendtext:e,redirect:!0}).then(function(){p.show(mw.msg("mobile-frontend-talk-reply-success")),t.pageGateway.invalidatePage(t.options.title),t.renderFromApi(t.options),s()},function(e,i){var o;o=i.error&&["readonly","blocked","autoblocked"].indexOf(i.error.code)>-1?i.error.info:mw.msg("mobile-frontend-editor-error"),t.hideSpinner(),p.show(o,"toast error"),s()})):this.$textarea.addClass("error")}}),e.exports=v},"./src/mobile.talk.overlays/autosign.js":function(e,t){e.exports=function(e){return/~{3,5}/.test(e)?e:e+" ~~~~"}},"./src/mobile.talk.overlays/makeAddTopicForm.js":function(e,t,s){var i=s("./src/mobile.talk.overlays/AddTopicForm.js"),o=s("./src/mobile.talk.overlays/autosign.js");e.exports=function(e){var t=e.licenseMsg,s=e.onTextInput,n=e.subject,a=e.body,r=e.disabled;return new i({licenseMsg:t,disabled:r,subject:n,body:a,onTextInput:s?function(e,t){t&&(t=o(t)),s.call(this,e,t)}:void 0})}},"./src/mobile.talk.overlays/mobile.talk.overlays.js":function(e,t,s){var i=s("./src/mobile.startup/moduleLoaderSingleton.js"),o=s("./src/mobile.talk.overlays/talkBoard.js"),n=s("./src/mobile.talk.overlays/TalkSectionAddOverlay.js"),a=s("./src/mobile.talk.overlays/TalkSectionOverlay.js");i.define("mobile.talk.overlays/talkBoard",o),i.define("mobile.talk.overlays/TalkSectionAddOverlay",n),i.define("mobile.talk.overlays/TalkSectionOverlay",a)},"./src/mobile.talk.overlays/talkBoard.js":function(e,t,s){var i=s("./src/mobile.startup/util.js"),o=s("./src/mobile.startup/View.js");e.exports=function(e){var t,s=e.length>0?mw.msg("mobile-frontend-talk-explained"):mw.msg("mobile-frontend-talk-explained-empty");return(t=new o({className:"talk-board"})).append([i.parseHTML('<p class="content-header">').text(s),i.parseHTML('<ul class="topic-title-list">').append(e.map(function(e){return i.parseHTML("<li>").append(i.parseHTML("<a>").attr("href","#/talk/"+e.id).text(e.line))}))]),t}}},[["./src/mobile.talk.overlays/mobile.talk.overlays.js",0,1]]]);
//# sourceMappingURL=mobile.talk.overlays.js.map.json