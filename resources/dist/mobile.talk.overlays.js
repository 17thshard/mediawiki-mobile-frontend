this.mfModules=this.mfModules||{},this.mfModules["mobile.talk.overlays"]=(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"./src/mobile.talk.overlays/TalkSectionAddOverlay.js":function(e,t,o){var a=o("./src/mobile.startup/mfExtend.js"),i=o("./src/mobile.startup/Overlay.js"),s=o("./src/mobile.startup/PageGateway.js"),r=o("./src/mobile.startup/util.js"),n=o("./src/mobile.talk.overlays/autosign.js"),l=o("./src/mobile.startup/toast.js"),d=o("./src/mobile.startup/Icon.js");function m(e){this.editorApi=e.api,this.pageGateway=new s(e.api),i.call(this,r.extend(e,{className:"talk-overlay overlay",events:{"input .wikitext-editor, input":"onTextInput","change .wikitext-editor, input":"onTextInput","click .confirm-save":"onSaveClick"}})),this.title=e.title,this.currentPageTitle=e.currentPageTitle,this.eventBus=e.eventBus,this._saveHit=!1}a(m,i,{defaults:r.extend({},i.prototype.defaults,{cancelMsg:mw.msg("mobile-frontend-editor-cancel"),topicTitlePlaceHolder:mw.msg("mobile-frontend-talk-add-overlay-subject-placeholder"),topicContentPlaceHolder:mw.msg("mobile-frontend-talk-add-overlay-content-placeholder"),editingMsg:mw.msg("mobile-frontend-talk-add-overlay-submit"),waitMsg:mw.msg("mobile-frontend-talk-topic-wait"),waitIcon:new d({name:"spinner",additionalClassNames:"savespinner loading"}).toHtmlString()}),template:mw.template.get("mobile.talk.overlays","SectionAddOverlay.hogan"),templatePartials:r.extend({},i.prototype.templatePartials,{contentHeader:mw.template.get("mobile.talk.overlays","SectionAddOverlay/contentHeader.hogan"),saveHeader:mw.template.get("mobile.editor.overlay","saveHeader.hogan")}),postRender:function(){i.prototype.postRender.call(this),this.showHidden(".initial-header"),this.$confirm=this.$el.find("button.confirm-save"),this.$subject=this.$el.find("input"),this.$ta=this.$el.find(".wikitext-editor")},hide:function(){var e,t=mw.msg("mobile-frontend-editor-cancel-confirm");return e=!this.$subject.val()&&!this.$ta.val(),!!(this._saveHit||e||window.confirm(t))&&i.prototype.hide.apply(this,arguments)},onTextInput:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout(function(){e.$ta.val().trim()&&e.$subject.val().trim()?e.$confirm.prop("disabled",!1):e.$confirm.prop("disabled",!0)},250)},onSaveClick:function(){var e=this,t=e.title===e.currentPageTitle;this.showHidden(".saving-header"),this.save().then(function(o){"ok"===o&&(t?e.eventBus.emit("talk-added-wo-overlay"):(e.pageGateway.invalidatePage(e.title),l.show(mw.msg("mobile-frontend-talk-topic-feedback")),e.eventBus.emit("talk-discussion-added"),e.hide()))},function(t){var o=mw.msg("mobile-frontend-talk-topic-error");switch(e.$confirm.prop("disabled",!1),t.details){case"protectedpage":o=mw.msg("mobile-frontend-talk-topic-error-protected");break;case"noedit":case"blocked":o=mw.msg("mobile-frontend-talk-topic-error-permission");break;case"spamdetected":o=mw.msg("mobile-frontend-talk-topic-error-spam");break;case"badtoken":o=mw.msg("mobile-frontend-talk-topic-error-badtoken");break;default:o=mw.msg("mobile-frontend-talk-topic-error")}l.show(o,{type:"error"}),e.showHidden(".save-header, .save-panel")})},save:function(){var e=this.$subject.val(),t=r.Deferred(),o=this.$ta.val();return this.$ta.removeClass("error"),this.$subject.removeClass("error"),this._saveHit=!0,this.$el.find(".content").empty().addClass("loading"),this.editorApi.postWithToken("csrf",{action:"edit",section:"new",sectiontitle:e,title:this.title,summary:mw.msg("newsectionsummary",e),text:n(o)}).then(function(){return"ok"},function(e){return t.reject({type:"error",details:e})})}}),e.exports=m},"./src/mobile.talk.overlays/TalkSectionOverlay.js":function(e,t,o){var a=mw.user,i=o("./src/mobile.startup/mfExtend.js"),s=o("./src/mobile.startup/PageGateway.js"),r=o("./src/mobile.startup/Overlay.js"),n=o("./src/mobile.startup/util.js"),l=o("./src/mobile.startup/toast.js"),d=o("./src/mobile.talk.overlays/autosign.js"),m=o("./src/mobile.startup/Page.js"),c=o("./src/mobile.startup/Button.js");function p(e){this.editorApi=e.api,this.pageGateway=new s(e.api),r.call(this,n.extend(e,{className:"talk-overlay overlay",events:{"focus textarea":"onFocusTextarea","click .save-button":"onSaveClick"}}))}i(p,r,{templatePartials:n.extend({},r.prototype.templatePartials,{header:mw.template.get("mobile.talk.overlays","Section/header.hogan"),content:mw.template.get("mobile.talk.overlays","Section/content.hogan")}),defaults:n.extend({},r.prototype.defaults,{saveButton:new c({block:!0,additionalClassNames:"save-button",progressive:!0,label:mw.msg("mobile-frontend-editor-save")}).options,title:void 0,section:void 0,reply:mw.msg("mobile-frontend-talk-reply"),info:mw.msg("mobile-frontend-talk-reply-info")}),postRender:function(){r.prototype.postRender.apply(this),this.$saveButton=this.$el.find(".save-button"),this.options.section?(this.hideSpinner(),this._enableComments()):this.renderFromApi(this.options)},_enableComments:function(){this.$commentBox=this.$el.find(".comment"),a.isAnon()?this.$commentBox.remove():this.$textarea=this.$commentBox.find("textarea")},renderFromApi:function(e){var t=this;this.pageGateway.getPage(e.title).then(function(o){var a=new m(o);e.section=a.getSection(e.id),t.render(e),t.hideSpinner()})},onFocusTextarea:function(){this.$textarea.removeClass("error")},onSaveClick:function(){var e=this.$textarea.val(),t=this;function o(){t.$saveButton.prop("disabled",!1)}e?(this.showSpinner(),this.$saveButton.prop("disabled",!0),e="\n\n"+d(e),this.editorApi.postWithToken("csrf",{action:"edit",title:this.options.title,section:this.options.id,appendtext:e,redirect:!0}).then(function(){l.show(mw.msg("mobile-frontend-talk-reply-success")),t.pageGateway.invalidatePage(t.options.title),t.renderFromApi(t.options),o()},function(e,a){var i;i=a.error&&["readonly","blocked","autoblocked"].indexOf(a.error.code)>-1?a.error.info:mw.msg("mobile-frontend-editor-error"),t.hideSpinner(),l.show(i,"toast error"),o()})):this.$textarea.addClass("error")}}),e.exports=p},"./src/mobile.talk.overlays/autosign.js":function(e,t){e.exports=function(e){return/~{3,5}/.test(e)?e:e+" ~~~~"}},"./src/mobile.talk.overlays/mobile.talk.overlays.js":function(e,t,o){var a=o("./src/mobile.startup/moduleLoaderSingleton.js"),i=o("./src/mobile.talk.overlays/talkBoard.js"),s=o("./src/mobile.startup/talk/overlay.js"),r=o("./src/mobile.startup/PageGateway.js"),n=o("./src/mobile.talk.overlays/TalkSectionAddOverlay.js"),l=o("./src/mobile.talk.overlays/TalkSectionOverlay.js");a.deprecate("mobile.talk.overlays/talkOverlay",function(e){return s(e.title,new r(e.api))},"Use `mobile.startup` (talk.overlay)"),a.define("mobile.talk.overlays/talkBoard",i),a.define("mobile.talk.overlays/TalkSectionAddOverlay",n),a.define("mobile.talk.overlays/TalkSectionOverlay",l)},"./src/mobile.talk.overlays/talkBoard.js":function(e,t,o){var a=o("./src/mobile.startup/util.js"),i=o("./src/mobile.startup/View.js");e.exports=function(e){var t,o=e.length>0?mw.msg("mobile-frontend-talk-explained"):mw.msg("mobile-frontend-talk-explained-empty");return(t=new i({className:"talk-board"})).append([a.parseHTML('<p class="content-header">').text(o),a.parseHTML('<ul class="topic-title-list">').append(e.map(function(e){return a.parseHTML("<li>").append(a.parseHTML("<a>").attr("href","#/talk/"+e.id).text(e.line))}))]),t}}},[["./src/mobile.talk.overlays/mobile.talk.overlays.js",0,1]]]);
//# sourceMappingURL=mobile.talk.overlays.js.map.json